---
title: graph demo
output:
  xaringan::moon_reader:
    seal: false
    lib_dir: libs
    css:
      - ../mycss/my-theme.css 
      - ../mycss/my-font.css
      - ../mycss/my-custom-for-video-roomy.css
      - ../mycss/notes-tips.css
      - default
      - duke-blue
      - hygge-duke
    nature:
      highlightStyle: tango
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"

---
background-image: url("../pic/slide-front-page.jpg")
class: center,middle

# 统计学原理(Statistic)

<!---    chakra: libs/remark-latest.min.js --->

### 胡华平

### 西北农林科技大学

### 经济管理学院数量经济教研室

### huhuaping01@hotmail.com

### `r Sys.Date()`

```{r global_options, echo=F,message=FALSE,warning=F}
source("../R/set-global.R")
options(width = 70)
global_size <- 18 # for ggplot2 font size
```


```{r ex-math-eq, eval=FALSE}
source("../R/external-math-equation.R")
```

```{r xaringan-logo, echo=FALSE}
require('xaringanExtra')

xaringanExtra::use_tachyons()

xaringanExtra::use_panelset()

xaringanExtra::use_logo(
  image_url = "../pic/logo/nwafu-logo-circle-wb.png",
  height = '70px',
  position = xaringanExtra::css_position(top='0.2em',left="1em")
)
```

---
class:  center, middle, duke-orange,hide_logo

# 第三章 数据的图表展示


### [3.1 数据的预处理](#prepare)

### [3.2 品质数据的整理与显示](#quality)

### [3.3 数值型数据的整理与显示](#quantity)

### [3.4 合理使用图表](#nice)


---
layout: false
class: center, middle, duke-softblue ,hide_logo
name: nice

# 3.4 合理使用图表


### 鉴别图形优劣的准则

---
layout: true

<div class="my-header-h2"></div>

<div class="watermark1"></div>

<div class="watermark2"></div>

<div class="watermark3"></div>

<div class="my-footer"><span>huhuaping@  &emsp;&emsp; <a href="#chapter02"> 第03章 数据的图表展示 </a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
<a href="#nice"> 3.4 合理使用图表 </a> </span></div> 

---

## 制图体系和要素


---
exclude: true

## 准备：字体

准备字体库

```{r, eval=T}
library("showtext")
#showtext_auto(FALSE)
font_install(source_han_serif())
font_families()
#font_families()
# https://fonts.google.com/featured/Superfamilies
font_add_google("Noto Serif SC", "Noto Serif SC")
font_add_google("Ma Shan Zheng", "Ma Shan Zheng")
showtext_auto()

font_love <- "Ma Shan Zheng"
```

```{r, eval = F}
#install.packages("extrafont")
library("extrafont")
#font_import() # run once, just import fonts families locally
# windowsFonts()
# load all fonts families
loadfonts(device = "win", quiet = TRUE) 

# Vector of font family names
#fonts_abeled<- as_tibble(fonts())

# Show entire table
#fonttable()

```


---
exclude: true

## 准备：数据

准备数据

```{r}
df <- data.frame(
  xval = c(1,3,6,8 ),
  yval=c(3, 5, 6, 9),
  group=c("A","B","A","B")
)

# par colors
color_demo <- "red"
margin_demo<- c(2,2,2,2)
```

---
exclude: true

## 准备：画图模板

```{r}

theme_demo <- function(){
  theme(text = element_text(family = font_love),
    axis.text = element_text(size = 14),
    axis.text.x = element_text(size = 16,
                               margin = margin(t = 10, r = 0, 
                                                b = 0, l = 0)),
    axis.text.y = element_text(size = 16,
                                margin = margin(t = 0, r = 10, 
                                                b = 0, l = 0)),
    axis.title.x = element_text(size = 16,
                                margin = margin(t = 15, r = 0, 
                                                b = 0, l = 0)),
    axis.title.y = element_text(size = 16,
                                margin = margin(t = 0, r = 15, 
                                                b = 0, l = 0)),
    # color system
    # see http://sape.inf.usi.ch/quick-reference/ggplot2/colour
    plot.background = element_rect(fill = "cornsilk"),
    panel.background = element_rect(fill = "lightblue",
                            colour = "lightblue",
                            size = 0.5, linetype = "solid"),
    panel.grid.major = element_line(size = 0.5, 
                                    linetype = 'solid',
                                    colour = "white"), 
    panel.grid.minor = element_line(size = 0.25, 
                                    linetype = 'solid',
                                    colour = "pink"),
    plot.title = element_text(hjust =0.5, face = "bold", size = 18),
    # margin
    plot.margin = unit(margin_demo, "cm")
    )
}

theme_clean <- function(){
  theme(
    panel.grid.major =  element_blank(),
    panel.grid.minor = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.ticks = element_blank()
  )
}


```



---

### 制图体系：绘图区 panel


.panelset[

.panel[.panel-name[a.画布区]

```{r}

bg_1 <- df %>%
  ggplot(aes(x = xval, y=yval)) +
  #geom_point() +
  lims(x = c(0,10), y = c(0, 10)) +
  geom_text(aes(5,y=Inf, label = "画布区background"), 
            family = "Ma Shan Zheng", size =8, 
            vjust =-1, color = color_demo) +
  theme_demo() +
  theme_clean()  +
  theme(panel.background = element_blank(),
        plot.background = element_rect(color = color_demo, linetype = "dashed")
        )  +
  coord_cartesian(clip = "off")

bg_1
```

]



.panel[.panel-name[b.绘图区]

```{r}

panel_1 <-  df %>%
  ggplot(aes(x = xval, y=yval)) +
  #geom_point() +
  lims(x = c(0,10), y = c(0, 10)) +
  geom_text(aes(5,y=Inf, label = "画布区background"), 
            family = "Ma Shan Zheng", 
            size =8, 
            vjust =-1) +
  geom_text(aes(5,y=5, label = "绘图区panel"), 
            family = "Ma Shan Zheng",size =8, 
            vjust =-1, color = color_demo) +
  theme_demo() +
  theme_clean() +
  theme(panel.background = element_rect(color = color_demo,linetype = "dashed")
        )  +
  coord_cartesian(clip = "off")


panel_1
```
]

.panel[.panel-name[c.主网格]

```{r}
panel_2 <-  df %>%
  ggplot(aes(x = xval, y=yval)) +
  #lims(x = c(0,10), y = c(0, 10)) +
  theme_demo() +
  scale_x_continuous(breaks = seq(0,10,2),minor_breaks = NULL,
                     limits = c(0,10), expand = c(0, 0)) +
  scale_y_continuous(breaks = seq(0,10,2),minor_breaks = NULL,
                     limits = c(0,10), expand = c(0, 0)) +
  labs(x ="", y = "",title = "主网格线major grid") +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        plot.title = element_text(color = color_demo))
  
panel_2

```

]

.panel[.panel-name[d.次网格]

```{r}
panel_3 <- panel_2 +
  scale_x_continuous(breaks = seq(0,10,2), minor_breaks = seq(0,10,0.5),
                     limits = c(0,10), expand = c(0, 0)) +
  scale_y_continuous(breaks = seq(0,10,2), minor_breaks = seq(0,10,0.5),
                     limits = c(0,10), expand = c(0, 0)) +
  labs(x ="", y = "",title = "次网格线 minor grid")

panel_3
```

]

]

---

### 制图体系：坐标轴1 axis

.panelset[
.panel[.panel-name[a.下横轴X]

```{r}
axis_px1 <-  panel_2 +
  labs(title = "主轴 axis x bottom") +
  theme(axis.line.x.bottom =  element_line(color = color_demo),
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        panel.grid.major =   element_blank(),
        plot.title = element_text(color = color_demo)) 
axis_px1
```

]

.panel[.panel-name[b.上横轴x]

```{r}
axis_px2 <-  panel_2 +
  labs(title = "上横轴 axis x top") +
  guides(x.sec = "axis", y.sec = "axis") +
  theme(axis.line.x.top =  element_line(color = color_demo),
        panel.grid.major =   element_blank(),
        plot.title = element_text(color = color_demo)) 
axis_px2
```

]

.panel[.panel-name[c.左纵轴Y]

```{r}
axis_py1 <-  panel_2 +
  labs(title = "左纵轴 axis Y left") +
  theme(axis.line.y.left = element_line(color = color_demo),
        panel.grid.major =   element_blank(),
        plot.title = element_text(color = color_demo)) 
axis_py1  
```

]

.panel[.panel-name[d.右纵轴Y]

```{r}
axis_py1 <-  panel_2 +
  labs(title = "右纵轴 axis Y right") +
  guides(x.sec = "axis", y.sec = "axis") +
  theme(axis.line.y.right =  element_line(color = color_demo),
        panel.grid.major =   element_blank(),
        plot.title = element_text(color = color_demo)) 
axis_py1  
```

]

]

---

### 制图体系：坐标轴2 axis

.panelset[

.panel[.panel-name[d.轴主标记]

```{r}
axis_1 <-  panel_2 +
  labs(title = "轴主标记 major ticks") +
  theme(axis.ticks = element_line(color = color_demo),
        panel.grid.major =   element_blank(),
        plot.title = element_text(color = color_demo)) 
axis_1  
```



]

.panel[.panel-name[e.轴次标记]


```{r}
# Adding minor tick marks to the x axis in ggplot2 (with no labels)
# https://stackoverflow.com/questions/14490071/adding-minor-tick-marks-to-the-x-axis-in-ggplot2-with-no-labels
insert_minor <- function(major_labs, n_minor) {
  labs <- c( sapply( major_labs, function(x) c(x, rep("", n_minor) ) ) )
  labs[1:(length(labs)-n_minor)]
}

axis_2 <-  df %>%
  ggplot(aes(x = xval, y=yval)) + 
  #geom_line() +
  #lims(x = c(0,10), y = c(0, 10)) +
  scale_x_continuous(breaks = seq(0,10,0.5), 
                     #minor_breaks = seq(0,10,2),
                     labels = insert_minor(major_labs =  seq(0, 10, by=2), n_minor = 3), 
                     limits = c(0,10), expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0,10,0.5), 
                     minor_breaks = seq(0,10,2),
                     labels = insert_minor( seq(0, 10, by=2), 3 ), 
                     limits = c(0,10), expand = c(0,0)) +
  theme_demo() +
  labs(title = "轴次标记 minor ticks") +
  theme(axis.ticks = element_line(color = color_demo),
        plot.title = element_text(color = color_demo),
        panel.grid.major =  element_blank(), 
        panel.grid.minor =  element_blank(),
        axis.title.x =  element_blank(),
        axis.title.y =  element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_blank())

axis_2
```
]


.panel[.panel-name[f.轴标签值1]

```{r}
axis_3 <-  axis_1 +
  labs(title = "轴标签值 axis label") +
  theme(axis.text = element_text(size = 14,color = color_demo),
        axis.text.x = element_text(size = 16,
                                   margin = margin(t = 10, r = 0, 
                                                    b = 0, l = 0)),
        axis.text.y = element_text(size = 16,
                                    margin = margin(t = 0, r = 10, 
                                                    b = 0, l = 0)),
        axis.ticks = element_line(color = "black"),
        panel.grid.major =   element_blank(),
        plot.title = element_text(color = color_demo),
        plot.margin = unit(margin_demo, "cm")
        ) 
axis_3 
```

]

.panel[.panel-name[g.轴标签值2]

```{r}
axis_4 <-  df %>%
  ggplot(aes(x = xval, y=yval)) + 
  #geom_line() +
  #lims(x = c(0,10), y = c(0, 10)) +
  scale_x_continuous(breaks = seq(0,10,0.5), 
                     #minor_breaks = seq(0,10,2),
                     labels = insert_minor(major_labs =  seq(0, 10, by=2), n_minor = 3), 
                     limits = c(0,10), expand = c(0,0)) +
  scale_y_continuous(breaks = seq(0,10,0.5), 
                     minor_breaks = seq(0,10,2),
                     labels = insert_minor( seq(0, 10, by=2), 3 ), 
                     limits = c(0,10), expand = c(0,0)) +
  theme_demo() +
  labs(title = "轴标签值 axis label") +
  theme(axis.ticks = element_line(color = "black"),
        plot.title = element_text(color = color_demo),
        panel.grid.major =  element_blank(), 
        panel.grid.minor =  element_blank(),
        axis.title.x =  element_blank(),
        axis.title.y =  element_blank(),
        axis.text.x = element_text(color = color_demo),
        axis.text.y = element_text(color = color_demo),
        plot.margin = unit(margin_demo, "cm")
        )

axis_4
```

]


]

---

### 制图体系：坐标轴3 axis

.panelset[

.panel[.panel-name[h.横标题]

```{r}
xtitle_px <- axis_4 +
  labs(x = "横轴X标题 axis X title",
       title = "下横轴X标题 axis X bottom title") +
  theme(axis.title.x = element_text(color = color_demo),
        axis.text.x = element_text(color = "black"),
        axis.text.y = element_text(color = "black"))

xtitle_px
```


]


.panel[.panel-name[h.左纵轴标题]

```{r}

xtitle_py1 <- xtitle_px +
  labs(y = "左纵轴Y标题", x = "", title = "左纵轴Y标题 axis Y left title") +
  theme(axis.title.y = element_text(color = color_demo, 
                                    angle = -90))

xtitle_py1
```

]


.panel[.panel-name[h.右纵轴标题]


```{r}
xtitle_py2 <- xtitle_py1 +
  scale_y_continuous( sec.axis = sec_axis( trans=~.*0.5, 
                                           name="右纵轴Y标题")) +
  labs(title = "右纵轴Y标题 axis Y right title") +
  theme(axis.title.y.right =  element_text(color = color_demo),
        axis.title.y.left =  element_text(color = "black"))

xtitle_py2
```

]


]


---

### 制图体系：图形类型 geom_xx

.panelset[
.panel[.panel-name[a.点图1]

```{r}
geom_p1 <- axis_4 +
  geom_point(color = color_demo, size = 4)  +
  labs(title = "图形类型 geom_point") +
  #theme_demo()+
  theme(plot.title = element_text(color = color_demo),
        panel.grid.major =  element_blank(), 
        panel.grid.minor =  element_blank(),
        axis.title.x =  element_blank(),
        axis.title.y =  element_blank(),
        axis.text.x = element_text(color = "black"),
        axis.text.y = element_text(color = "black"),
        axis.ticks.x = element_line(color = "black"),
        axis.ticks.y  = element_line(color = "black"),
        plot.margin = unit(margin_demo, "cm")
        )
geom_p1
```

]

.panel[.panel-name[b.点图2]

```{r}
geom_p2 <- axis_4 +
  geom_point(aes(pch = as.character(xval)),
             color = color_demo, 
             size = 4,
             show.legend = FALSE)  +
  labs(title = "图形类型 geom_point (point type)") +
  #theme_demo()+
  theme(plot.title = element_text(color = color_demo),
        panel.grid.major =  element_blank(), 
        panel.grid.minor =  element_blank(),
        axis.title.x =  element_blank(),
        axis.title.y =  element_blank(),
        axis.text.x = element_text(color = "black"),
        axis.text.y = element_text(color = "black"),
        axis.ticks.x = element_line(color = "black"),
        axis.ticks.y  = element_line(color = "black"),
        plot.margin = unit(margin_demo, "cm")
        )
geom_p2
```

]

.panel[.panel-name[c.线图1]

```{r}
geom_p3 <- axis_4 +
  geom_line(color = color_demo)  +
  labs(title = "图形类型 geom_line") +
  #theme_demo()+
  theme(plot.title = element_text(color = color_demo),
        panel.grid.major =  element_blank(), 
        panel.grid.minor =  element_blank(),
        axis.title.x =  element_blank(),
        axis.title.y =  element_blank(),
        axis.text.x = element_text(color = "black"),
        axis.text.y = element_text(color = "black"),
        axis.ticks.x = element_line(color = "black"),
        axis.ticks.y  = element_line(color = "black"),
        plot.margin = unit(margin_demo, "cm")
        )
geom_p3
```
]

.panel[.panel-name[d.线图2]

```{r}
geom_p4 <- axis_4 +
  geom_line(color = color_demo, linetype = "dashed")  +
  labs(title = "图形类型 geom_line") +
  #theme_demo()+
  theme(plot.title = element_text(color = color_demo),
        panel.grid.major =  element_blank(), 
        panel.grid.minor =  element_blank(),
        axis.title.x =  element_blank(),
        axis.title.y =  element_blank(),
        axis.text.x = element_text(color = "black"),
        axis.text.y = element_text(color = "black"),
        axis.ticks.x = element_line(color = "black"),
        axis.ticks.y  = element_line(color = "black"),
        plot.margin = unit(margin_demo, "cm")
        )
geom_p4
```

]

]


---

### 制图体系：变量数值 data value

```{r}
value_p1 <- axis_4 +
  geom_point(size = 3,
             show.legend = FALSE) +
  geom_text(aes(label = yval), color = color_demo,
            size = 5, hjust = -1)  +
  labs(title = "变量数值 data value") +
  #theme_demo()+
  theme(plot.title = element_text(color = color_demo),
        panel.grid.major =  element_blank(), 
        panel.grid.minor =  element_blank(),
        axis.title.x =  element_blank(),
        axis.title.y =  element_blank(),
        axis.text.x = element_text(color = "black"),
        axis.text.y = element_text(color = "black"),
        axis.ticks.x = element_line(color = "black"),
        axis.ticks.y  = element_line(color = "black"),
        plot.margin = unit(margin_demo, "cm")
        )
value_p1
```

---

### 制图体系：图例 legend

.panelset[
.panel[.panel-name[a.图例靠右]

```{r}
legend_p1 <- axis_4 +
  geom_point(aes(pch = as.character(xval)),
             #color = color_demo, 
             size = 4)  +
  labs(title = "图例靠右 legend right",
       pch = "点类型") +
  #theme_demo()+
  theme(plot.title = element_text(color = color_demo),
        panel.grid.major =  element_blank(), 
        panel.grid.minor =  element_blank(),
        axis.title.x =  element_blank(),
        axis.title.y =  element_blank(),
        axis.text.x = element_text(color = "black"),
        axis.text.y = element_text(color = "black"),
        axis.ticks.x = element_line(color = "black"),
        axis.ticks.y  = element_line(color = "black"),
        #plot.margin = unit(margin_demo, "cm"),
        legend.background = element_rect(color = color_demo) 
        )
legend_p1
```

]


.panel[.panel-name[b.图例靠下]

```{r}
legend_p2  <- legend_p1 +
  labs(title = "图例靠下 legend bottom") +
  theme(legend.position = "bottom")

legend_p2
```


]

]

---

### 制图体系：图注 footnote和图题 caption

.panelset[
.panel[.panel-name[a.图注]

```{r}
cap_p1 <- legend_p1 +
  labs(title = "图注 plot footnote",
       caption = "数据来源：@hhp") +
  theme(plot.caption = element_text(color = color_demo, 
                                    hjust = 0, size = 14),
        legend.background = element_rect(color = "white")) +
  coord_cartesian(clip = "off")

cap_p1
```

]

.panel[.panel-name[b.图题]

```{r, fig.cap="图3-1:plot caption演示"}
cap_p2 <- cap_p1 +
  labs(title = "") +
  theme(plot.title = element_text(color = color_demo, 
                                    hjust = 0.5),
        plot.caption = element_text(color = "black", 
                                    hjust = 0)) 
cap_p2
```

]

]

---

class: flextable

### 制表体系

表格要素包括：表序号（numbering）、表题（title）、表头（header）、主体（body）和表注（footer）等部分构成。


```{r,tab.cap='表3-2：iris dataset数据集', message=FALSE, warning=FALSE}
library("flextable")

flextable::set_flextable_defaults(font.size = 16,
                                  font.family =font_love)

ft <- flextable(head(iris))
ft <- flextable::footnote( ft, i = 1, j = 1:3,
            value = as_paragraph(
              c("This is footnote one",
                "This is footnote two",
                "This is footnote three")
            ),
            ref_symbols = c("a", "b", "c"),
            part = "header",inline=T)
ft <- valign(ft, valign = "bottom", part = "header")

library(officer)
def_par <- officer::fp_par(text.align = "center")

ft <- style(x = ft, pr_p = def_par,  part ="body") 
ft <- style(x = ft, pr_p = def_par,  part ="header") 

ft <-padding(ft, padding.bottom = 1, padding.top = 1,part = "footer")

ft <- color(ft, color = "red", part = "footer")
  
autofit(ft)

```

---
layout:false
background-image: url("../pic/thank-you-gif-funny-fan.gif")
class: inverse,center
# 本章结束

