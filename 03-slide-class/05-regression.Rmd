---
output:
  xaringan::moon_reader:
    seal: false
    lib_dir: libs
    css:
      - default
      - ../mycss/my-theme.css 
      - ../mycss/my-font.css
      - ../mycss/my-custom-for-video-roomy.css
      - ../mycss/text-box.css
      - duke-blue
      - hygge-duke
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
---
background-image: url("../pic/slide-front-page.jpg")
class: center,middle

# ç»Ÿè®¡å­¦åŸç†(Statistic)

<!---    chakra: libs/remark-latest.min.js --->

### èƒ¡åå¹³

### è¥¿åŒ—å†œæ—ç§‘æŠ€å¤§å­¦

### ç»æµç®¡ç†å­¦é™¢æ•°é‡ç»æµæ•™ç ”å®¤

### huhuaping01@hotmail.com

### `r Sys.Date()`

```{r global_options, echo=F,message=FALSE,warning=F}
source("../R/set-global.R")
source("../R/external-math-equation.R")
options(width = 70)
#source("../R/xaringan-chromote-print.R")
```


```{r ex-math-eq}
source("../R/external-math-equation.R")
```


```{r xaringan-logo, echo=FALSE}
require('xaringanExtra')

xaringanExtra::use_tachyons()

xaringanExtra::use_panelset()

xaringanExtra::use_logo(
  image_url = "../pic/logo/nwafu-logo-circle-wb.png",
  height = '70px',
  position = xaringanExtra::css_position(top='0.2em',left="1em")
)
```

---
class: center, middle, duke-orange,hide_logo
name:chapter

# ç¬¬äº”ç«  ç›¸å…³å’Œå›å½’åˆ†æ


### [5.1 å˜é‡é—´å…³ç³»çš„åº¦é‡](#corl)

### [5.2 å›å½’åˆ†æçš„åŸºæœ¬æ€æƒ³](#oncept)

### [5.3 OLSæ–¹æ³•ä¸å‚æ•°ä¼°è®¡](#ols)

### [5.4 å‡è®¾æ£€éªŒ](#hypthesis)

### [5.5 æ‹Ÿåˆä¼˜åº¦ä¸æ®‹å·®åˆ†æ](#goodness)

### [5.6 å›å½’é¢„æµ‹åˆ†æ](#forecast)

### [5.7 å›å½’æŠ¥å‘Šè§£è¯»](#report)

---
layout: false
class: center, middle, duke-softblue,hide_logo
name: corl

# 5.1 å˜é‡é—´å…³ç³»çš„åº¦é‡

### å˜é‡é—´çš„å…³ç³»

### ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦

### ç›¸å…³ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒ

---
layout: true

<div class="my-header-h2"></div>

<div class="watermark1"></div>

<div class="watermark2"></div>

<div class="watermark3"></div>

<div class="my-footer"><span>huhuaping@  &emsp;&emsp; <a href="#chapter"> ç¬¬05ç«  ç›¸å…³å’Œå›å½’åˆ†æ </a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
<a href="#corl"> 5.1 å˜é‡é—´å…³ç³»çš„åº¦é‡ </a> </span></div> 

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šç»æµå­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-1-econ.png")
```

> â€œæˆ‘ä»¬æ•°æ®ä¸å°‘ï¼Œåšäº†å¾ˆä¸¥æ ¼çš„å›å½’ï¼Œä½†å¼‚å¸¸å€¼ç•¥å¤šç•¥å¤šï¼Œç¬¦åˆç†è®ºçš„æ•°å€¼åè€Œéš¾æ‰¾â€¦â€¦â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šé‡‘èå­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-2-fin.png")
```

> â€œæˆ‘ä»¬çš„æ•°æ®å¤šå¦‚ç‰›æ¯›ï¼Œæ— å­”ä¸å…¥ã€‚å³ä½¿åšå®Œå›å½’ï¼Œä¹Ÿä¼šå‘ç°å¼‚å¸¸å€¼å’Œç¬¦åˆç†è®ºçš„æ•°å€¼å¤šå¾—ä¸å¿ç›´è§†ã€‚â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šåœŸæœ¨å·¥ç¨‹ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-3-engine.png")
```

> â€œæˆ‘ä»¬å¾—è¦è®¾è®¡ä½™é‡ï¼Œæ‰€ä»¥ç†è®ºè®¾è®¡å¾—è¿œé«˜äºå®é™…æ‰¿å—â€¦â€¦â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šç‰©ç†å­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-4-physics.png")
```

> â€œæˆ‘ä»¬çš„ç†è®ºå’Œæ•°æ®ä¸¥ä¸åˆç¼ï¼Œbingoï¼â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šç¯å¢ƒç§‘å­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-5-eniron.png")
```

> â€œæˆ‘ä»¬çš„ç†è®ºå’Œæ•°æ®å¤§è‡´å»åˆï¼Œå°±æ˜¯â€¦â€¦åº”ç”¨èŒƒå›´æœ‰ç‚¹è›‹ç–¼ã€‚â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šå†å²å­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-6-history.png")
```

> â€œæ•°æ®è™½ç„¶å¾ˆå¤šï¼Œå¯æˆ‘ä»¬èƒ½ç”¨ç†è®ºæŠŠä»–ä»¬ç»Ÿç»Ÿè¿èµ·æ¥ï¼â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šæ”¿æ²»å­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-7-politics.png")
```

> â€œä¸–ç•Œå¤§åŠ¿ä¸€æ—¥ä¸‰å˜ï¼Œå°½ç®¡æˆ‘ä»¬æ•°æ®ä¸å°‘ï¼Œå¯â€¦â€¦æˆ‘ä»¬çš„ç†è®ºè·Ÿæ•°æ®è¶‹åŠ¿æ˜¯åç€æ¥çš„â€¦â€¦â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šç¤¾ä¼šå­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-8-sociology.png")
```

> â€œå­¦æµ·æ— æ¶¯è‹¦ä½œèˆŸã€‚é‚£ä¹ˆå¤šæ•°æ®ï¼Œé‚£ä¹ˆå¤šç†è®ºï¼Œæ…¢æ…¢å­¦ï¼Œæ©â€¦â€¦â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šæ•°å­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-9-math.png")
```

> â€œæ•°æ®å¾ˆå°‘ï¼Œä½†èƒ½å»ºç«‹ç†è®ºï½â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šæ–°é—»å­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-10-journalism.png")
```

> ï¼ˆç¤ºä¾‹ï¼‰â€œåªæœ‰ä¸€ä¸ªæ•°æ®ï¼Œä¹Ÿèƒ½å»ºç«‹ç†è®ºâ€¦â€¦â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šå“²å­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-11-philosophy.png")
```

> â€œæ²¡æœ‰æ•°æ®ï¼Œä¾ç„¶å»ºç«‹ç†è®ºâ€¦â€¦â€


---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šæ–‡å­¦æ‰¹è¯„ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-12-literary.png")
```

> â€œå¦‚å›¾æ‰€ç¤ºï¼Œä½ æ‡‚çš„â€¦â€¦â€

---

## å˜é‡é—´çš„å…³ç³»ï¼šå‡½æ•°å…³ç³»

ä¸¤ä¸ªå˜é‡è‹¥å­˜åœ¨æ˜¯ä¸€ä¸€å¯¹åº”çš„ç¡®å®šå…³ç³»ï¼Œåˆ™ç§°ä¹‹ä¸ºäºŒè€…å…·æœ‰**å‡½æ•°å…³ç³»**ã€‚

```{block, type = "notes", echo =T}

è®¾æœ‰ä¸¤ä¸ªå˜é‡
$X$å’Œ 
$Y$ï¼Œå˜é‡
$Y$éšå˜é‡
$X$ä¸€èµ·å˜åŒ–ï¼Œå¹¶å®Œå…¨ä¾èµ–äº
$X$ï¼Œå½“å˜é‡
$X$å–æŸä¸ªæ•°å€¼æ—¶ï¼Œ 
$Y$ä¾ç¡®å®šçš„å…³ç³»å–ç›¸åº”çš„å€¼ï¼Œåˆ™ç§°
$Y$æ˜¯
$X$çš„å‡½æ•°ï¼Œè®°ä¸º
$Y = f(X)$ï¼Œå…¶ä¸­
$X$ç§°ä¸ºè‡ªå˜é‡ï¼Œ
$Y$ç§°ä¸ºå› å˜é‡ã€‚

```



> ä»**å‡ ä½•å­¦**è§’åº¦æ¥çœ‹ï¼Œæ•°æ®é›†å„è§‚æµ‹ç‚¹ä¼šè½åœ¨ä¸€æ¡æ›²çº¿ä¸Šã€‚

---

### ï¼ˆç¤ºä¾‹ï¼‰å‡½æ•°å…³ç³»

æŸç§å•†å“çš„é”€å”®é¢
$Y$ä¸é”€å”®é‡
$X$ä¹‹é—´çš„å…³ç³»å¯è¡¨ç¤ºä¸º(
$P$ä¸ºå•ä»·)ï¼š

$$Y_i = P_i\cdot X_i$$

åœ†çš„é¢ç§¯
$S$ä¸åŠå¾„
$R$ä¹‹é—´çš„å…³ç³»å¯è¡¨ç¤ºä¸ºï¼š

$$S = \pi R^2$$

ä¼ä¸šçš„åŸææ–™æ¶ˆè€—é¢
$Y$ä¸äº§é‡
$X1$ ã€å•ä½äº§é‡æ¶ˆè€—
$X2$ ã€åŸææ–™ä»·æ ¼
$X3$ä¹‹é—´çš„å…³ç³»å¯è¡¨ç¤ºä¸ºï¼š

$$Y = X_1 \cdot X_2 \cdot X_3$$

---

## å˜é‡é—´çš„å…³ç³»ï¼šç›¸å…³å…³ç³»(correlation)

```{r, out.width= "90%", fig.cap="ç›¸å…³å…³ç³»çš„ç±»å‹"}
include_graphics("../pic/chpt05-measure-rel.png")
```


---

### ï¼ˆç¤ºä¾‹ï¼‰ç›¸å…³å…³ç³»

```{block, type = "case", echo = T}
- çˆ¶äº²èº«é«˜
$Y$ä¸å­å¥³èº«é«˜
$X$ä¹‹é—´çš„å…³ç³»

- æ”¶å…¥æ°´å¹³
$Y$ä¸å—æ•™è‚²ç¨‹åº¦
$X$ä¹‹é—´çš„å…³ç³»

- ç²®é£Ÿå•ä½é¢ç§¯äº§é‡
$Y$ä¸æ–½è‚¥é‡
$X1$ ã€é™é›¨é‡
$X2$ã€æ¸©åº¦
$X3$ä¹‹é—´çš„å…³ç³»

- å•†å“çš„æ¶ˆè´¹é‡
$Y$ä¸å±…æ°‘æ”¶å…¥
$X$ä¹‹é—´çš„å…³ç³»

- å•†å“é”€å”®é¢
$Y$ä¸å¹¿å‘Šè´¹æ”¯å‡º
$X$ä¹‹é—´çš„å…³ç³»

```


---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šé—®é¢˜ä¸å‡å®š

ç›¸å…³åˆ†æè¦è§£å†³çš„é—®é¢˜ï¼š

- å˜é‡ä¹‹é—´æ˜¯å¦å­˜åœ¨å…³ç³»ï¼Ÿ

- å¦‚æœå­˜åœ¨å…³ç³»ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯ä»€ä¹ˆæ ·çš„å…³ç³»ï¼Ÿ

- å˜é‡ä¹‹é—´çš„å…³ç³»å¼ºåº¦å¦‚ä½•ï¼Ÿ

- æ ·æœ¬æ‰€åæ˜ çš„å˜é‡ä¹‹é—´çš„å…³ç³»èƒ½å¦ä»£è¡¨æ€»ä½“å˜é‡ä¹‹é—´çš„å…³ç³»ï¼Ÿ

ç›¸å…³åˆ†æä¸­çš„æ€»ä½“å‡å®šï¼š

- ä¸¤ä¸ªå˜é‡ä¹‹é—´æ˜¯çº¿æ€§å…³ç³»

- ä¸¤ä¸ªå˜é‡éƒ½æ˜¯éšæœºå˜é‡

---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šæ•£ç‚¹å›¾

.fl.w-50[

```{r}
include_graphics("../pic/chpt05-scatter-p0.png")
```
]

--

.fl.w-50[

```{r}
include_graphics("../pic/chpt05-scatter-p1.png")
```
]

---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šæ•£ç‚¹å›¾


.fl.w-50[

```{r}
include_graphics("../pic/chpt05-scatter-n0.png")
```

]

--

.fl.w-50[

```{r}
include_graphics("../pic/chpt05-scatter-n1.png")
```

]

---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šæ•£ç‚¹å›¾

.fl.w-50[

```{r}
include_graphics("../pic/chpt05-scatter-nonline.png")
```

]

--

.fl.w-50[

```{r}
include_graphics("../pic/chpt05-scatter-independence.png")
```

]

---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šæ•£ç‚¹å›¾

```{r, out.width="90%"}
include_graphics("../pic/chpt05-scatter-all-cases.png")
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ä¸¤ç±»æ²¹ä»·çš„æ•£ç‚¹å›¾

```{r, out.width="90%"}
include_graphics("../pic/chpt05-scatter-oil-price.png")
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ä¼ æŸ“ç—…ä¸è®¤çŸ¥æ°´å¹³çš„æ•£ç‚¹å›¾

```{r, out.width="80%"}
include_graphics("../pic/chpt05-scatter-disease.png")
```

---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šç›¸å…³ç³»æ•°

**ç›¸å…³ç³»æ•°**(correlation coefficient)ï¼šæ˜¯åº¦é‡å˜é‡ä¹‹é—´å…³ç³»å¼ºåº¦çš„ä¸€ä¸ªç»Ÿè®¡é‡ã€‚

- å®ƒæ˜¯å¯¹ä¸¤ä¸ªå˜é‡ä¹‹é—´çº¿æ€§ç›¸å…³å¼ºåº¦çš„ä¸€ç§åº¦é‡ã€‚

- ä¸€èˆ¬ç§°ä¸º**ç®€å•ç›¸å…³ç³»æ•°**ï¼Œä¹Ÿç§°ä¸º**çº¿æ€§ç›¸å…³ç³»æ•°**(linear correlation coefficient) ã€‚

- æˆ–ç§°ä¸º**Pearsonç›¸å…³ç³»æ•°**(Pearsonâ€™s correlation coefficient) ã€‚

ç›¸å…³ç³»æ•°è®°å·è¡¨è¾¾ï¼š

- è‹¥ç›¸å…³ç³»æ•°æ˜¯æ ¹æ®æ€»ä½“å…¨éƒ¨æ•°æ®è®¡ç®—çš„ï¼Œç§°ä¸ºæ€»ä½“ç›¸å…³ç³»æ•°ï¼Œè®°ä¸º
$\rho$ã€‚

- è‹¥æ˜¯æ ¹æ®æ ·æœ¬æ•°æ®è®¡ç®—çš„ï¼Œåˆ™ç§°ä¸ºæ ·æœ¬ç›¸å…³ç³»æ•°ï¼Œç®€ç§°ä¸ºç›¸å…³ç³»æ•°ï¼Œè®°ä¸º
$r$ã€‚


---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šè®¡ç®—å…¬å¼

.mb1.bg-light-blue[
ç®€å•ç›¸å…³ç³»æ•°çš„å¤§FFè®¡ç®—å…¬å¼ï¼š

$$\begin{align}
r & = \frac{n \sum X_i Y_i -\sum X_i \sum Y_i}{\sqrt{n \sum X_i^{2}-\left(\sum X_i\right)^{2}} \cdot \sqrt{n \sum Y_i^{2}-\left(\sum Y_i\right)^{2}}}
\end{align}$$

]

.mb1.bg-light-blue[
ç®€å•ç›¸å…³ç³»æ•°çš„å°ffè®¡ç®—å…¬å¼ï¼š

$$\begin{align}
r & = \frac{ \sum{\left( (X_i - \overline{X})(Y_i - \overline{Y})\right ) } }{\sqrt{\sum{(X_i - \overline{X})^2 }\sum{(Y_i - \overline{Y})^2}}} 
= \frac{S S_{XY}}{\sqrt{S S_{XX}} \sqrt{S S_{YY}}}
= \frac{\sum{x_iy_i}}{\sqrt{\sum{x_i^2}\sum{y_i^2}}}

\end{align}$$

]


.mb1.bg-lightest-blue[

å…¶ä¸­ï¼š

$$\begin{align}
S S_{X X} =\sum_{i=1}^{n}\left(X_{i}-\overline{X}\right)^{2}  ;\quad 
S S_{Y Y} =\sum_{i=1}^{n}\left(Y_{i}-\overline{Y}\right)^{2}  ;\quad 
S S_{X Y}=\sum_{i=1}^{n}\left(X_{i}-\overline{X}\right)\left(Y_{i}-\overline{Y}\right)
\end{align}$$

]


---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šç‰¹å¾

ç®€å•ç›¸å…³ç³»æ•°çš„ç‰¹å¾ï¼š

**æ€§è´¨1**ï¼š
$r$çš„å–å€¼èŒƒå›´æ˜¯
$[-1,1]$ï¼Œ
$|r|$è¶Šè¶‹äº1è¡¨ç¤ºç›¸å…³å…³ç³»è¶Šå¼ºï¼›
$|r|$è¶Šè¶‹äº0è¡¨ç¤ºç›¸å…³å…³ç³»è¶Šå¼±ã€‚


- å¦‚æœ
$|r|=1$ï¼Œä¸ºå®Œå…¨ç›¸å…³ã€‚å…¶ä¸­
$r =1$ï¼Œä¸ºå®Œå…¨æ­£ç›¸å…³ï¼›
$r =-1$ï¼Œä¸ºå®Œå…¨è´Ÿæ­£ç›¸å…³

- å¦‚æœ
$r = 0$ï¼Œä¸å­˜åœ¨çº¿æ€§ç›¸å…³å…³ç³»

- å¦‚æœ
$-1<r<0$ï¼Œä¸ºè´Ÿç›¸å…³ï¼›å¦‚æœ
$0<r<1$ï¼Œä¸ºæ­£ç›¸å…³ã€‚


**æ€§è´¨2**ï¼šrå…·æœ‰å¯¹ç§°æ€§ã€‚å³
$X$ä¸
$Y$ä¹‹é—´çš„ç›¸å…³ç³»æ•°å’Œ
$Y$ä¸
$X$ä¹‹é—´çš„ç›¸å…³ç³»æ•°ç›¸ç­‰ï¼Œå³
$r_{XY}= r_{YX}$ã€‚

---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šç‰¹å¾

ç®€å•ç›¸å…³ç³»æ•°çš„ç‰¹å¾ï¼š

**æ€§è´¨3**ï¼š
$r$æ•°å€¼å¤§å°ä¸
$X$å’Œ
$Y$åŸç‚¹åŠå°ºåº¦æ— å…³ï¼Œå³æ”¹å˜
$X$å’Œ
$Y$çš„æ•°æ®åŸç‚¹åŠè®¡é‡å°ºåº¦ï¼Œå¹¶ä¸æ”¹å˜
$r$æ•°å€¼å¤§å°ã€‚

**æ€§è´¨4**ï¼šä»…ä»…æ˜¯
$X$ä¸
$Y$ä¹‹é—´çº¿æ€§å…³ç³»çš„ä¸€ä¸ªåº¦é‡ï¼Œå®ƒä¸èƒ½ç”¨äºæè¿°éçº¿æ€§å…³ç³»ã€‚è¿™æ„ä¸ºç€ï¼Œ
$r=0$åªè¡¨ç¤ºä¸¤ä¸ªå˜é‡ä¹‹é—´ä¸å­˜åœ¨çº¿æ€§ç›¸å…³å…³ç³»ï¼Œå¹¶ä¸è¯´æ˜å˜é‡ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»

**æ€§è´¨5**ï¼š
$r$è™½ç„¶æ˜¯ä¸¤ä¸ªå˜é‡ä¹‹é—´çº¿æ€§å…³ç³»çš„ä¸€ä¸ªåº¦é‡ï¼Œå´ä¸ä¸€å®šæ„å‘³ç€
$X$ä¸
$Y$ä¸€å®šæœ‰å› æœå…³ç³»ã€‚

---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šè§£é‡Š


```{block, type= "fyi", echo =T}

ä¸‹é¢ç»™å‡ºå®è¯ç ”ç©¶æ—¶ï¼Œå¯¹ç›¸å…³ç³»æ•°çš„ç»éªŒè§£é‡Šï¼š

- å½“
$|r|<0.8$æ—¶ï¼Œå¯è§†ä¸ºä¸¤ä¸ªå˜é‡ä¹‹é—´é«˜åº¦ç›¸å…³ã€‚

- å½“
$0.5<|r|<0.8$æ—¶ï¼Œå¯è§†ä¸ºä¸­åº¦ç›¸å…³ã€‚

- å½“
$0.3<|r|<0.5$æ—¶ï¼Œè§†ä¸ºä½åº¦ç›¸å…³ã€‚

- å½“
$|r|<0.3$æ—¶ï¼Œè¯´æ˜ä¸¤ä¸ªå˜é‡ä¹‹é—´çš„ç›¸å…³ç¨‹åº¦æå¼±ï¼Œå¯è§†ä¸ºä¸ç›¸å…³ã€‚

è€Œä¸”ä¸Šè¿°è§£é‡Šå¿…é¡»å»ºç«‹åœ¨å¯¹ç›¸å…³ç³»æ•°çš„æ˜¾è‘—æ€§è¿›è¡Œæ£€éªŒçš„åŸºç¡€ä¹‹ä¸Šã€‚

```



---

## åç›¸å…³ç³»æ•°


**åç›¸å…³ç³»æ•°**ï¼ˆpartial correlation coefficientï¼‰ï¼š
ä¸€ä¸ªä¸ä¾èµ–äº
$X_{2i}$çš„ï¼Œå¯¹
$X_{3i}$å’Œ
$Y_i$çš„å½±å“çš„ä¸€ç§ç›¸å…³ç³»æ•°ã€‚

- ä¿æŒ
$X_{3i}$ä¸å˜ï¼Œ
$Y_i$å’Œ
$X_{2i}$ä¹‹é—´çš„ç›¸å…³ç³»æ•°ï¼š

$$\begin {align} 
r_{12 \cdot 3}=\frac{r_{12}-r_{13} r_{23}}{\sqrt{\left(1-r_{13}^{2}\right)\left(1-r_{23}^{2}\right)}}
\end {align}$$

- ä¿æŒ
$X_{2i}$ä¸å˜ï¼Œ
$Y_i$å’Œ
$X_{3i}$ä¹‹é—´çš„ç›¸å…³ç³»æ•°ï¼š

$$\begin {align} 
r_{13.2}=\frac{r_{13}-r_{12} r_{23}}{\sqrt{\left(1-r_{12}^{2}\right)\left(1-r_{23}^{2}\right)}}
\end {align}$$

- ä¿æŒ
$Y_i$ä¸å˜ï¼Œ
$X_{2i}$å’Œ
$X_{3i}$ä¹‹é—´çš„ç›¸å…³ç³»æ•°ï¼š

$$\begin {align} 
r_{23.1}=\frac{r_{23}-r_{12} r_{13}}{\sqrt{\left(1-r_{12}^{2}\right)\left(1-r_{13}^{2}\right)}}
\end {align}$$

---

## ç®€å•ç›¸å…³ç³»æ•°


**ç®€å•ç›¸å…³ç³»æ•°**ï¼ˆsimple correlation coefficientï¼‰ï¼š


- 
$Y_i$å’Œ
$X_{2i}$ä¹‹é—´çš„ç›¸å…³ç³»æ•°ï¼š

$$\begin {align} 
r_{12}=\frac{\sum y_{i} x_{2 i}}{\sqrt{\sum y_{i}^{2}} \sqrt{\sum x_{2 i}^{2}}}
\end {align}$$

- 
$Y_i$å’Œ
$X_{3i}$ä¹‹é—´çš„ç›¸å…³ç³»æ•°ï¼š

$$\begin {align} 
r_{13}=\frac{\sum y_{i} x_{3 i}}{\sqrt{\sum y_{i}^{2}} \sqrt{\sum x_{3 i}^{2}}}
\end {align}$$

- 
$X_{2i}$å’Œ
$X_{3i}$ä¹‹é—´çš„ç›¸å…³ç³»æ•°ï¼š

$$\begin {align} 
r_{23}=\frac{\sum x_{2 i} x_{3 i}}{\sqrt{\sum x_{2 i}^{2}} \sqrt{\sum x_{3 i}^{2}}}
\end {align}$$

---

## ç›¸å…³ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒ

**ç›¸å…³ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒ**ï¼Œæ˜¯æŒ‡æ£€éªŒä¸¤ä¸ªå˜é‡ä¹‹é—´æ˜¯å¦å­˜åœ¨çº¿æ€§ç›¸å…³å…³ç³»ã€‚

ç›¸å…³ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒæ–¹æ³•åŒ…æ‹¬ï¼š

- ç­‰ä»·äºå¯¹å›å½’æ–œç‡ç³»æ•°
$\beta_1$çš„æ£€éªŒï¼ˆä»…é’ˆå¯¹ä¸€å…ƒå›å½’ï¼‰

- é‡‡ç”¨R. A. Fisheræå‡ºçš„tæ£€éªŒ

---

## ç›¸å…³ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒ

ç›¸å…³ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒæ­¥éª¤ï¼š

1ï¼‰æå‡ºå‡è®¾ï¼š
$H_0: \rho =0; H_1: \rho \neq 0$

2ï¼‰è®¡ç®—æ ·æœ¬ç»Ÿè®¡é‡

$$T^{\ast} = |r|\sqrt{\frac{n-2}{1-r^2}} \quad \sim t(n-2)$$

3ï¼‰ç»™å®šæ˜¾è‘—æ€§æ°´å¹³
$\alpha$ï¼Œç¡®å®štç†è®ºåˆ†å¸ƒå€¼
$t_{1-\alpha/2}(n-2)$ã€‚

4ï¼‰å¾—åˆ°å‡è®¾æ£€éªŒç»“è®ºï¼š

- è‹¥
$T^{\ast}> t_{1-\alpha/2}(n-2)$ï¼Œåˆ™æ‹’ç»
$H_0$ï¼Œè®¤ä¸ºæ˜¾è‘—å­˜åœ¨ç›¸å…³å…³ç³»ï¼›

- è‹¥
$T^{\ast} < t_{1-\alpha/2}(n-2)$ï¼Œåˆ™æ— æ³•æ‹’ç»
$H_0$ï¼Œè®¤ä¸ºç›¸å…³å…³ç³»ä¸æ˜¾è‘—ã€‚

---

exclude: true

## ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾

```{r}
str_compose <- function(vec1, vec2,
                        decorate = c("ï¼ˆ", "ï¼‰"),
                        clps = "ã€"){
  if (length(vec1) != length(vec2)) {
    "length of the two vectors not equal"
  }
  out <- str_c(str_c(vec1,decorate[1]),
               str_c(vec2,decorate[2]), 
               collapse = clps )
  out
}
```


```{r}
df_loan <- openxlsx::read.xlsx("../data/textbook/example/case-11-6-loan.xlsx",startRow = 2)

names_chn <- c("åˆ†è¡Œç¼–å·",	"ä¸è‰¯è´·æ¬¾",	"å„é¡¹è´·æ¬¾ä½™é¢
"	,"æœ¬å¹´ç´¯è®¡åº”æ”¶è´·æ¬¾"	,"è´·æ¬¾é¡¹ç›®ä¸ªæ•°",	"æœ¬å¹´å›ºå®šèµ„äº§æŠ•èµ„é¢")
names_eng <- names(df_loan)
n <- nrow(df_loan)

```

```{r}
avr_X <- mean(df_loan$loan.surplus)
avr_Y <- mean(df_loan$loan.bad)

df_rel1 <- df_loan %>%
  select(1:3) %>%
  mutate(XY = loan.bad *loan.surplus,
         X_sqr = loan.surplus^2,
         Y_sqr = loan.bad^2,
         x = loan.surplus - avr_X,
         y = loan.bad - avr_Y,
         x_sqr = x^2,
         y_sqr = y^2,
         xy = x*y)


tot_Y <- sum(df_rel1$loan.bad)
tot_X <- sum(df_rel1$loan.surplus)
tot_XX <- sum(df_rel1$X_sqr)
tot_YY <- sum(df_rel1$Y_sqr)
tot_XY <- sum(df_rel1$XY)

sum_x <- sum(df_rel1$x)
sum_y <- sum(df_rel1$y)
sum_xx <- sum(df_rel1$x_sqr)
sum_yy <- sum(df_rel1$y_sqr)
sum_xy <- sum(df_rel1$xy)

r <- round(cor(df_rel1$loan.surplus,df_rel1$loan.bad),4)
t_r <- round(abs(r)*sqrt((n-2)/(1-r^2)),4)

```


---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šæ¡ˆä¾‹æ•°æ®

**æ¡ˆä¾‹è¯´æ˜**ï¼šæŸé“¶è¡Œå…±æœ‰`r n`å®¶åˆ†è¡Œï¼Œåˆ†è¡ŒåŠæ‰€åœ¨åœ°åŒºçš„ç›¸å…³å˜é‡æ•°æ®å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚

```{r}
df_loan %>%
  datatable(options = list(dom = "tip", pageLength = 7,
                           scrollX = TRUE)) 
```

.footnote[**è¯´æ˜**ï¼šä¸Šè¿°å˜é‡çš„å«ä¹‰åˆ†åˆ«æ˜¯`r str_compose(names_eng, names_chn)`ã€‚]

---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šä¸è‰¯è´·æ¬¾VSè´·æ¬¾ä½™é¢çš„æ•£ç‚¹å›¾

```{r, fig.cap="ä¸è‰¯è´·æ¬¾VSè´·æ¬¾ä½™é¢æ•£ç‚¹å›¾"}

df_loan %>%
  ggplot(aes(loan.surplus, loan.bad)) +
  geom_point(size = 4) +
  labs(x = "è´·æ¬¾ä½™é¢ loan.surplusï¼ˆäº¿å…ƒï¼‰",
       y = "ä¸è‰¯è´·æ¬¾ loan.badï¼ˆäº¿å…ƒï¼‰") +
  theme(text = element_text(size = 16))
  
```



---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šä¸è‰¯è´·æ¬¾VSè´·æ¬¾ä½™é¢çš„ç›¸å…³ç³»æ•°ï¼ˆå¤§FFï¼‰

.left-column[

#### 1)å¤§FFè®¡ç®—è¡¨

]

.right-column[

```{r}
df_rel1 %>%
  rename_at(vars(c("loan.bad", "loan.surplus")),
            ~all_of(c("Y" ,"X"))) %>%
  select(1:6) %>%
  janitor::adorn_totals("row") %>%
  datatable(caption = "å¤§FFè®¡ç®—è¡¨",
            options = list(dom = "tip", pageLength = 7,
                           scrollX = TRUE)) %>%
  formatRound(c(4:6), digits = 2)
```

]

---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šä¸è‰¯è´·æ¬¾VSè´·æ¬¾ä½™é¢çš„ç›¸å…³ç³»æ•°ï¼ˆå¤§FFï¼‰

.left-column[

#### 1)å¤§FFè®¡ç®—è¡¨

#### 2)rè®¡ç®—å¼1

]

.right-column[

$$\begin{align}
r & = \frac{n \sum X_i Y_i -\sum X_i \sum Y_i}{\sqrt{n \sum X_i^{2}-\left(\sum X_i\right)^{2}} \cdot \sqrt{n \sum Y_i^{2}-\left(\sum Y_i\right)^{2}}} \\
& = \frac{`r n` \times `r tot_XY` - `r tot_X` \times `r tot_Y`}{\sqrt{`r n` \times `r tot_XX`-\left(`r tot_X`\right)^2} \cdot \sqrt{`r n` \times `r tot_YY`-\left( `r tot_Y`\right)^{2}}}  \\
& = `r formatC(r, format = 'f', digits=4)`
\end{align}$$

]

---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šä¸è‰¯è´·æ¬¾VSè´·æ¬¾ä½™é¢çš„ç›¸å…³ç³»æ•°ï¼ˆå°ffï¼‰

.left-column[

#### 1)å°ffè®¡ç®—è¡¨

]

.right-column[

```{r}
df_rel1 %>%
  rename_at(vars(c("loan.bad", "loan.surplus")),
            ~all_of(c("Y" ,"X"))) %>%
  select(1:3,7:11) %>%
  janitor::adorn_totals("row") %>%
  datatable(caption = "å°ffè®¡ç®—è¡¨",
            options = list(dom = "tip", pageLength = 7,
                           scrollX = TRUE)) %>%
  formatRound(c(4:8), digits = 2)
```

]

---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šä¸è‰¯è´·æ¬¾VSè´·æ¬¾ä½™é¢çš„ç›¸å…³ç³»æ•°

.left-column[

#### 1)å°ffè®¡ç®—è¡¨

#### 2)rè®¡ç®—å¼2

]

.right-column[

$$\begin{align}
r & = \frac{ \sum{\left( (X_i - \overline{X})(Y_i - \overline{Y})\right ) } }{\sqrt{\sum{(X_i - \overline{X})^2 (Y_i - \overline{Y})^2}}} \\
& = \frac{\sum{x_i y_i}}{\sqrt{\sum{x_i^2}\sum{y_i^2}}} \\
& = \frac{`r sum_xy`}{\sqrt{ `r sum_xx` \times `r sum_yy`}} \\
& = `r formatC(r, format = 'f', digits=4)`
\end{align}$$

]

---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šç›¸å…³ç³»æ•°çŸ©é˜µ(Pearson)

```{r, echo=TRUE, comment="#` "}
corl_pearson<- round(cor(df_loan[,-1], method = "pearson"),4) 
corl_pearson[upper.tri(corl_pearson)]<- NA
```


```{r, eval=T, warning=FALSE}
# rowname to column
tbl_flex <- corl_pearson %>%  
  as.data.frame() %>%
  rownames_to_column(var = " ") 

# conditions
colormatrix <- ifelse((tbl_flex[, -1] < 0.7), "black", 
                      ifelse((tbl_flex[, -1] < 0.8), "orange",
                             ifelse((tbl_flex[, -1] < 1),"red", "black")))

tbl_flex %>%
  flextable::flextable() %>%
  align(align ='center', part = 'all') %>% 
  colformat_double(j = 2:6, digits =4)%>%
  fontsize(size = 19, part = "all") %>%
  color(j = 2:6, color=colormatrix) %>%
  flextable::set_caption(caption = "Pearsonç›¸å…³ç³»æ•°çŸ©é˜µ") %>%
  autofit()

```

---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šç›¸å…³ç³»æ•°çŸ©é˜µ(Spearman)

```{r, echo=TRUE, comment="#` "}
corl_spearman<- round(cor(df_loan[,-1], method = "spearman"),4) 
corl_spearman[upper.tri(corl_spearman)] <- NA
```

```{r, eval=T, warning=FALSE}
# rowname to column
tbl_flex <- corl_spearman %>%  
  as.data.frame() %>%
  rownames_to_column(var = " ") 

tbl_flex %>%
  flextable::flextable() %>%
  align(align ='center', part = 'all') %>% 
  colformat_double(j = 2:6, digits =4)%>%
  fontsize(size = 19, part = "all") %>%
  color(j = 2:6, color=colormatrix) %>%
  flextable::set_caption(caption = "Spearmanç›¸å…³ç³»æ•°çŸ©é˜µ") %>%
  autofit()

```

---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šç›¸å…³ç³»æ•°æ˜¾è‘—æ€§æ£€éªŒ(æ‰‹ç®—)

å¯¹äºå‰è¿°`loan.surplus`ä¸`loan.bad`è¿›è¡Œç›¸å…³ç³»æ•°æ˜¾è‘—æ€§æ£€éªŒï¼ˆPearsonï¼‰ï¼š

- 1ï¼‰æå‡ºå‡è®¾ï¼š
$H_0: \rho =0; H_1: \rho \neq 0$

- 2ï¼‰è®¡ç®—æ ·æœ¬ç»Ÿè®¡é‡ï¼š

$$\begin{align}
T^{\ast} = |r|\sqrt{\frac{n-2}{1-r^2}} 
=`r abs(r)` \times \sqrt{\frac{`r n`-2}{1-`r r`^2}}
= `r t_r`
\end{align}$$

- 3ï¼‰ç»™å®šæ˜¾è‘—æ€§æ°´å¹³
$\alpha=0.05$ï¼Œç¡®å®štç†è®ºåˆ†å¸ƒå€¼
$t_{1-\alpha/2}(n-2)=t_{1-0.05/2}(25-2)=t_{0.975}(`r n-2`)=`r round(qt(0.975,23),2)`$ã€‚

- 4ï¼‰å¾—åˆ°å‡è®¾æ£€éªŒç»“è®ºï¼šå› ä¸ºtæ ·æœ¬ç»Ÿè®¡é‡å¤§äºtç†è®ºæŸ¥è¡¨å€¼ï¼Œä¹Ÿå³

$$\left[T^{\ast}= `r t_r`\right] > \left[t_{0.975}(`r n-2`) =`r round(qt(0.975,23),2)`\right]$$

å› æ­¤æ‹’ç»åŸå‡è®¾
$H_0$ï¼Œè®¤ä¸ºå˜é‡`loan.surplus`ï¼ˆè´·æ¬¾ä½™é¢ï¼‰ä¸`loan.bad`ï¼ˆä¸è‰¯è´·æ¬¾ï¼‰æ˜¾è‘—å­˜åœ¨ç›¸å…³å…³ç³»ã€‚


---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šç›¸å…³ç³»æ•°æ˜¾è‘—æ€§æ£€éªŒ(Rè½¯ä»¶)

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Rè½¯ä»¶å‡½æ•°`cor.test()`å¯¹ä¸Šè¿°ä¸¤ä¸ªå˜é‡è¿›è¡Œç›¸å…³ç³»æ•°æ˜¾è‘—æ€§æ£€éªŒï¼š

```{r, echo=TRUE}
cor.test(df_rel1$loan.surplus, df_rel1$loan.bad,
         method = "pearson")
```


---
layout: false
class: center, middle, duke-softblue,hide_logo
name: concept

# 5.2 å›å½’åˆ†æçš„åŸºæœ¬æ€æƒ³

### ç›¸å…³å…³ç³»VSå› æœå…³ç³»

### é‡è¦æ¦‚å¿µ

---
layout: true

<div class="my-header-h2"></div>

<div class="watermark1"></div>

<div class="watermark2"></div>

<div class="watermark3"></div>

<div class="my-footer"><span>huhuaping@  &emsp;&emsp; <a href="#chapter"> ç¬¬05ç«  ç›¸å…³å’Œå›å½’åˆ†æ </a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
<a href="#concept"> 5.2 å›å½’åˆ†æçš„åŸºæœ¬æ€æƒ³ </a> </span></div> 

---

## çº¿æ€§å›å½’åˆ†æ

ä»ä¸€ç»„æ ·æœ¬æ•°æ®å‡ºå‘ï¼Œç¡®å®šå˜é‡ä¹‹é—´çš„æ•°å­¦å…³ç³»å¼ã€‚

å¯¹è¿™äº›å…³ç³»å¼çš„å¯ä¿¡ç¨‹åº¦è¿›è¡Œå„ç§ç»Ÿè®¡æ£€éªŒï¼Œå¹¶ä»å½±å“æŸä¸€ç‰¹å®šå˜é‡çš„è¯¸å¤šå˜é‡ä¸­æ‰¾å‡ºå“ªäº›å˜é‡çš„å½±å“æ˜¾è‘—ï¼Œå“ªäº›ä¸æ˜¾è‘—ã€‚

åˆ©ç”¨æ‰€æ±‚çš„å…³ç³»å¼ï¼Œæ ¹æ®ä¸€ä¸ªæˆ–å‡ ä¸ªå˜é‡çš„å–å€¼æ¥é¢„æµ‹æˆ–æ§åˆ¶å¦ä¸€ä¸ªç‰¹å®šå˜é‡çš„å–å€¼ï¼Œå¹¶ç»™å‡ºè¿™ç§é¢„æµ‹æˆ–æ§åˆ¶çš„ç²¾ç¡®ç¨‹åº¦ã€‚


---

## ç›¸å…³å…³ç³»ï¼šè¾¹é™…ç›¸å…³ä¸æ¡ä»¶ç›¸å…³1

```{r, out.width= "90%", fig.cap="è¾¹é™…ç›¸å…³ä½†æ˜¯æ¡ä»¶ç‹¬ç«‹"}
include_graphics("../pic/chpt05-causality-margin.png")
```

---

## ç›¸å…³å…³ç³»ï¼šè¾¹é™…ç›¸å…³ä¸æ¡ä»¶ç›¸å…³2

```{r, out.width= "90%", fig.cap="è¾¹é™…ç‹¬ç«‹ä½†æ˜¯æ¡ä»¶ç›¸å…³"}
include_graphics("../pic/chpt05-causality-margin-2.png")
```

---

## ç›¸å…³å…³ç³»VSå› æœå…³ç³»


```{r, out.width= "60%", fig.cap="å·§å…‹åŠ›æ¶ˆè´¹é‡ä¸è¯ºè´å°”å¥–æ•°é‡"}
include_graphics("../pic/chpt05-causality-chocolate.png")
```

---

## ç›¸å…³å…³ç³»VSå› æœå…³ç³»ï¼šæ€§åˆ«çš„ä½œç”¨

```{r, out.width= "95%", fig.cap="æ²»ç–—åº·å¤è¡¨"}
include_graphics("../pic/chpt05-causality-drug-gender1.png")
```

```{r, out.width= "60%", fig.cap="å› æœå…³ç³»å›¾"}
include_graphics("../pic/chpt05-causality-drug-gender-graph1.png")
```

---

## ç›¸å…³å…³ç³»VSå› æœå…³ç³»ï¼šè¡€å‹çš„ä½œç”¨

```{r, out.width= "100%", fig.cap="æ²»ç–—åº·å¤è¡¨"}
include_graphics("../pic/chpt05-causality-drug-pressure-tab.png")
```

```{r, out.width= "60%", fig.cap="å› æœå…³ç³»å›¾"}
include_graphics("../pic/chpt05-causality-drug-pressure-graph.png")
```

---

## ï¼ˆæ¡ˆä¾‹ï¼‰å¾®å‹å®¶åº­æ€»ä½“

<!---æ–°æ•°æ®è¡¨--->

```{r}
fams60<- as_tibble(read.xlsx("../data/extra/Table-2-1-60families-new.xlsx",shee = 1))

fams60_long <- as_tibble(read.xlsx("../data/extra/Table-2-1-60families-new.xlsx", sheet =2))

```

---

### ï¼ˆæ¡ˆä¾‹ï¼‰å‡æƒ³æ€»ä½“ï¼š60ä¸ªå®¶åº­çš„æ”¶æ”¯æ•°æ®ï¼ˆç›´è§‚åˆ—è¡¨ï¼‰


```{r, fig.cap="60ä¸ªå®¶åº­çš„æ”¶å…¥å’Œæ”¯å‡ºæƒ…å†µï¼šå‡è®¾çš„æ€»ä½“"}
include_graphics("../pic/extra/chpt2-1-60families-pop.png",dpi=150)
```

???
æé—®ï¼š

- æ€»ä½“æ˜¯ä»€ä¹ˆï¼Ÿ

- æœ‰å¤šå°‘æ€»ä½“å•ä½ï¼Ÿ

---

### ï¼ˆæ¡ˆä¾‹ï¼‰å‡æƒ³æ€»ä½“ï¼š60ä¸ªå®¶åº­çš„æ”¶æ”¯æ•°æ®ï¼ˆæ‰æ•°æ®å½¢æ€ï¼‰


```{r}
datatable(fams60, options = list(pageLength =9, dom ="t"), caption = "60ä¸ªå®¶åº­çš„æ”¶å…¥å’Œæ”¯å‡ºæƒ…å†µï¼šå‡è®¾çš„æ€»ä½“")
```
???
**æ‰æ•°æ®å½¢æ€**ï¼šâ€œéæ ‡å‡†â€æ•°æ®å½¢æ€ï¼ˆä½†å¾ˆç›´è§‚ï¼‰

---

### ï¼ˆæ¡ˆä¾‹ï¼‰å‡æƒ³æ€»ä½“ï¼š60ä¸ªå®¶åº­çš„æ”¶æ”¯æ•°æ®ï¼ˆé•¿æ•°æ®å½¢æ€ï¼‰

```{r}
datatable(fams60_long, options = list(pageLength =8, dom ="tip"), caption = "60ä¸ªå®¶åº­çš„æ”¶å…¥å’Œæ”¯å‡ºæƒ…å†µï¼šå‡è®¾çš„æ€»ä½“")
```
???
**é•¿æ•°æ®å½¢æ€**ï¼šæ ‡å‡†æ•°æ®å½¢æ€ï¼ˆä½†ä¸ç›´è§‚ï¼‰ã€‚

---

## é‡è¦æ¦‚å¿µï¼šæ— æ¡ä»¶æ¦‚ç‡å’Œæ— æ¡ä»¶æœŸæœ›

**æ— æ¡ä»¶æ¦‚ç‡**ï¼š

- å®šä¹‰ï¼šä¸å—
$X_i$å˜é‡å–å€¼å½±å“ä¸‹ï¼Œ
$Y_i$å‡ºç°çš„å¯èƒ½æ€§ã€‚

- è®°å·ï¼šç¦»æ•£å˜é‡
$P(Y_i)$ï¼›è¿ç»­å˜é‡
$g(Y)$

**æ— æ¡ä»¶æœŸæœ›**ï¼š

- å®šä¹‰ï¼šä¸å—
$X_i$å˜é‡å–å€¼å½±å“ä¸‹ï¼Œå˜é‡
$Y_i$çš„æœŸæœ›å€¼ã€‚

- è®°å·ï¼š
$g(Y_i)$è¡¨ç¤ºè¿ç»­å˜é‡çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆcdfï¼‰

$$\begin{align}
E(Y) &= \sum_1^N{Y_i \cdot P(Y_i)} &&\text{(discrete vars)} \\
E(Y) &= \int{Y_i \cdot g(Y_i)dY} &&\text{(continue vars)} 
\end{align}$$

---

### ï¼ˆç¤ºä¾‹ï¼‰æ— æ¡ä»¶æ¦‚ç‡å’Œæ— æ¡ä»¶æœŸæœ›çš„ç¤ºä¾‹è®¡ç®—


```{r, out.width="90%", fig.cap="æ— æ¡ä»¶æ¦‚ç‡å’Œæ— æ¡ä»¶æœŸæœ›"}
include_graphics("../pic/extra/chpt2-1-60fams-unconditional-mean.png")
```

---

### ï¼ˆç¤ºä¾‹ï¼‰æ— æ¡ä»¶æœŸæœ›çš„è®¡ç®—è¿‡ç¨‹

$$\begin{align}
E(Y) &= \sum_1^N{Y_i \cdot P(Y_i)} \\
     &= \sum_1^{60}\left( 55*\frac{1}{60} + 60*\frac{1}{60} + \cdots + 191*\frac{1}{60} \right) \\
     &=\frac{1}{60}\sum_1^{60}Y_i\\
     &=\frac{7272}{60}\\
     &=121.2
\end{align}$$

---

## é‡è¦æ¦‚å¿µï¼šæ¡ä»¶æ¦‚ç‡å’Œæ¡ä»¶æœŸæœ›

**æ¡ä»¶æ¦‚ç‡**ï¼š

- å®šä¹‰ï¼šç»™å®šå˜é‡
$X_i$çš„å–å€¼æ¡ä»¶ä¸‹ï¼Œ
$Y_i$å‡ºç°çš„å¯èƒ½æ€§ã€‚

- è®°å·ï¼šç¦»æ•£å˜é‡
$P(Y_i|X_i)$ï¼›è¿ç»­å˜é‡
$g(Y|X)$


**æ¡ä»¶æœŸæœ›**ï¼š

- åœ¨ç»™å®šå˜é‡
$X_i$çš„å–å€¼æ¡ä»¶ä¸‹ï¼Œ
$Y_i$çš„æœŸæœ›å€¼ã€‚

- è®°å·ï¼š
$g(Y|X)$è¡¨ç¤ºè¿ç»­å˜é‡çš„æ¡ä»¶æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆcdfï¼‰

$$\begin{align}
E(Y|X_i) &= \sum_1^N{(Y_i|X_i) \cdot P(Y_i|X_i)} &&\text{(discrete vars)} \\
E(Y|X_i) &= \int{(Y|X) \cdot g(Y|X)dY} &&\text{(continue vars)} \end{align}$$

---

### ï¼ˆç¤ºä¾‹ï¼‰æ¡ä»¶æ¦‚ç‡å’Œæ¡ä»¶æœŸæœ›çš„è®¡ç®—

```{r, out.width="90%",fig.cap="æ¡ä»¶æ¦‚ç‡å’Œæ¡ä»¶æœŸæœ›"}
include_graphics("../pic/extra/chpt2-1-60fams-conditional-mean.png")
```

---

### ï¼ˆç¤ºä¾‹ï¼‰æ¡ä»¶æœŸæœ›çš„è®¡ç®—è¿‡ç¨‹

$$\begin{align}
E(Y|80) &= \sum_1^N{Y_i \cdot P(Y_i|X=80)} \\
     &= \sum_1^{5}\left( 55*\frac{1}{5} + 60*\frac{1}{5} + \cdots + 75*\frac{1}{5} \right) \\
     &=\frac{1}{5}\sum_1^{5}Y_i\\
     &=\frac{325}{5}\\
     &=65
\end{align}$$

---

### ï¼ˆç¤ºä¾‹ï¼‰å‡æƒ³æ€»ä½“çš„å…¨éƒ¨æ•°æ®å±•ç¤º

```{r, warning=F}
exp_cond <- fams60 %>%
  filter(Mark!="X") %>%
  select(-Mark) %>%
  colMeans(.,na.rm = T) %>%
  rbind(fams60[1,-1], .) %>%
  add_column(var = c("X","E(Y|X)"), .before = "G1")

pivot_exp <- as_tibble(t(exp_cond))[-1,] %>%
  dplyr::rename( X=V1,exp.Y="V2") %>%
  type_convert(cols(X=col_double(),
                    exp.Y= col_double()))
```


```{r, out.width="90%"}
# the population points
p1<- ggplot() +
  geom_point(data = fams60_long,
             aes(x=X,  y=Y,color= "Y", shape="Y"),size=3) +
  scale_colour_manual(name= "",
                      values =c("blue")) +
  scale_shape_manual(name= "",
                      values =c(1)) +
  scale_x_continuous(breaks=seq(80,260, length=10)) +
  labs(x="å®¶åº­æ”¶å…¥X", y="å®¶åº­æ”¯å‡ºY") +
  theme(text = element_text(size=18),
        axis.title.x = element_text(size = 16,
                                margin = margin(t = 15, r = 0, 
                                                b = 0, l = 0)),
        axis.title.y = element_text(size = 16,
                                margin = margin(t = 0, r = 15, 
                                                b = 0, l = 0)))

p1
```


---

### ï¼ˆç¤ºä¾‹ï¼‰ç»™å®šä¸åŒXæ°´å¹³ä¸‹Yæ¡ä»¶æœŸæœ›å€¼

```{r, fig.height= 5.5}
# the expect points
p2 <- p1 +
  geom_point(data = pivot_exp, 
             aes(x=X, y=exp.Y,
                 color= "E(Y|X)",shape= "E(Y|X)"), size=3) +
  scale_colour_manual(name= "",
                      values =c("red","blue")) +
  scale_shape_manual(name= "",values =c(19,1)) 

p2
```


```{r}
kable(exp_cond) %>%
  kable_styling(full_width =T)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ç»™å®šä¸åŒXæ°´å¹³ä¸‹Yæ¡ä»¶æœŸæœ›å€¼

```{r, out.width="90%" , warning=FALSE,message=FALSE}
# the specified point
require("latex2exp")
X_spc <- 120
Y_spc <- pivot_exp$exp.Y[which(pivot_exp$X==X_spc)]
p2_1 <- p2 +
  geom_vline(aes(xintercept = X_spc), lty="dashed")+
  geom_hline(aes(yintercept = Y_spc), lty="dashed")+
  geom_text(aes(x=X_spc-22, y=Y_spc+10), label=TeX("$(X_i,E(Y|X_i))=(120,89)$"),
            color="red",size=5)

p2_1
```

ç»™å®š
$X=120$æ°´å¹³ä¸‹
$Y$æ¡ä»¶æœŸæœ›å€¼
$E(Y|X_i=120)$= `r pivot_exp$exp.Y[which(pivot_exp$X==X_spc)]`

---

### ï¼ˆç¤ºä¾‹ï¼‰Xå‡å€¼å’ŒYçš„æ— æ¡ä»¶æœŸæœ›å€¼

```{r, out.width="90%", warning=FALSE,message=FALSE}
# the center point
X_bar <- mean(fams60_long$X)
Y_bar <- mean(fams60_long$Y)
p3 <- p2 +
  geom_vline(aes(xintercept = X_bar), lty="dashed")+
  geom_hline(aes(yintercept = Y_bar), lty="dashed")+
  geom_text(aes(x=X_bar-20, y=Y_bar+10), label=TeX("$(\\bar{X},\\bar{Y})=(174, 121)$"),color="orange",size=5)+
  #geom_text(aes(x=15, y=mean(fams60_long$Y)+5), label=TeX("$E(Y)=\\bar{Y}$"))+
  geom_point(aes(x=X_bar, y=Y_bar,
                 color="center", shape="center"),size=3) +
  scale_colour_manual(name= "",
                      values =c("E(Y|X)"="red", "Y"="blue", "center" ="orange")) +
  scale_shape_manual(name= "",
                      values =c("E(Y|X)"=19,"Y"=1,"center" =17)) 
p3
```

Xçš„å‡å€¼
$\bar{X}$
=`r formatC(X_bar, format="f", digits =2)`å’ŒYçš„æ— æ¡ä»¶æœŸæœ›å€¼
$E(Y)=$
`r formatC(Y_bar, format ="f", digits = 2)`

---

## é‡è¦æ¦‚å¿µï¼šæ€»ä½“å›å½’çº¿ï¼ˆPRLï¼‰

- å‡ ä½•ï¼šç»™å®šXå€¼æ—¶Yçš„æ¡ä»¶æœŸæœ›å€¼çš„è½¨è¿¹ã€‚

- ç»Ÿè®¡ï¼šå®è´¨ä¸Šå°±æ˜¯Yå¯¹Xçš„å›å½’ã€‚

æ€»ä½“å›å½’æ›²çº¿(Population Regression Curveï¼ŒPRC)ï¼šæ¡ä»¶æœŸæœ›å€¼çš„è½¨è¿¹è¡¨ç°ä¸ºä¸€æ¡æ›²çº¿(Curve)ã€‚

æ€»ä½“å›å½’çº¿(Population Regression Lineï¼ŒPRL)ï¼šæ¡ä»¶æœŸæœ›å€¼çš„è½¨è¿¹è¡¨ç°ä¸ºä¸€æ¡ç›´çº¿(Line)ã€‚

---

## é‡è¦æ¦‚å¿µï¼šæ€»ä½“å›å½’çº¿ï¼ˆPRLï¼‰

```{r, out.width="90%", fig.cap="æ€»ä½“å›å½’çº¿PRL"}
p_PRL <- p2 +
  geom_line(data = pivot_exp,aes(x=X, y=exp.Y),color="purple", size=0.75)
p_PRL
```

---

## é‡è¦æ¦‚å¿µï¼šæ€»ä½“å›å½’å‡½æ•°ï¼ˆPRFï¼‰

æ€»ä½“å›å½’å‡½æ•°ï¼ˆPopulation Regression Functionï¼ŒPRFï¼‰ï¼šå®ƒæ˜¯å¯¹æ€»ä½“å›å½’æ›²çº¿(PRC)çš„æ•°å­¦å‡½æ•°è¡¨ç°å½¢å¼ã€‚

å¦‚æœä¸çŸ¥é“æ€»ä½“å›å½’æ›²çº¿çš„å…·ä½“å½¢å¼ï¼Œåˆ™æ€»ä½“å›å½’å‡½æ•°PRFè¡¨è¾¾ä¸ºå¦‚ä¸‹éšå‡½æ•°å½¢å¼ï¼ˆPRFï¼‰ï¼š

$$\begin{align}
E(Y|X_i) & = f(X_i)  && \text{(PRF)}
\end{align}$$

å¦‚æœæ€»ä½“å›å½’æ›²çº¿æ˜¯ç›´çº¿å½¢å¼ï¼Œåˆ™æ€»ä½“å›å½’å‡½æ•°PRFè¡¨è¾¾ä¸ºå¦‚ä¸‹æ˜¾å‡½æ•°å½¢å¼ï¼ˆPRF_Lï¼‰ï¼š

$$\begin{align}
E(Y|X_i) &= \beta_1 +\beta_2X_i && \text{(PRF_L)}
\end{align}$$

- 
$\beta_1,\beta_2$åˆ†åˆ«ç§°ä¸ºæˆªè·(intercept)å’Œæ–œç‡ç³»æ•°(slope coefficient)ã€‚

- 
$\beta_1,\beta_2$ç§°ä¸ºæ€»ä½“å‚æ•°æˆ–å›å½’ç³»æ•°(regression coefficients)ã€‚

- 
$\beta_1,\beta_2$ä¸ºæœªçŸ¥ä½†å´æ˜¯å›ºå®šçš„å‚æ•°ã€‚

---

## é‡è¦æ¦‚å¿µï¼šæ€»ä½“å›å½’å‡½æ•°ï¼ˆPRFï¼‰

```{r, out.width="90%", fig.cap="æ€»ä½“å›å½’çº¿PRLä¸æ€»ä½“å›å½’å‡½æ•°PRF", warning=FALSE,message=FALSE}
lm_pop<- lm(data = pivot_exp, formula = exp.Y~X)
b1 <- coef(lm_pop)[1]
b0 <- coef(lm_pop)[2]
p_PRF <- p_PRL +
  geom_text(aes(x=120, y=200),
            label=TeX("$PRF:E(Y|X_i)=\\beta_1+\\beta_2X_i$"),
            color="purple", size=5) +
    geom_text(aes(x=120, y=190),
            label=TeX("$E(Y|X_i)=17+0.6X_i$"),
            color="purple", size=5) 
p_PRF
```

---

## é‡è¦æ¦‚å¿µï¼šæ€»ä½“å›å½’æ¨¡å‹ï¼ˆPRMï¼‰

**æ€»ä½“å›å½’æ¨¡å‹**ï¼ˆPopulation Regression model, PRMï¼‰ï¼šæŠŠæ€»ä½“å›å½’å‡½æ•°è¡¨è¾¾æˆ**éšæœºè®¾å®š**å½¢å¼ã€‚

å¦‚æœæ€»ä½“å›å½’å‡½æ•°ä¸ºéšå‡½æ•°ï¼Œåˆ™**æ€»ä½“å›å½’æ¨¡å‹**è®°ä¸ºï¼š

$$\begin{align}
Y_i &=  E(Y|X_i) + u_i \\
    &=  f(X_i) +u_i
\end{align}$$

å¦‚æœæ€»ä½“å›å½’å‡½æ•°ä¸ºçº¿æ€§å‡½æ•°ï¼Œåˆ™**æ€»ä½“å›å½’æ¨¡å‹**è®°ä¸ºï¼š

$$\begin{align}
Y_i &=  E(Y|X_i) + u_i \\
    &= \beta_1 +\beta_2X_i + u_i
\end{align}$$

- æ€»ä½“å›å½’æ¨¡å‹ï¼ˆPRMï¼‰å±äº**è®¡é‡ç»æµå­¦æ¨¡å‹**ï¼Œè€Œæ€»ä½“å›å½’å‡½æ•°ï¼ˆPRFï¼‰æ˜¯**æ•°é‡ç»æµå­¦æ¨¡å‹**ï¼ˆæˆ–æ•°å­¦æ¨¡å‹ï¼‰ã€‚

- æ€»ä½“å›å½’æ¨¡å‹ï¼ˆPRMï¼‰èƒ½å……åˆ†è¡¨è¾¾çš„æ˜¯ç°å®ä¸–ç•Œä¸­
$Y_i$å˜é‡çš„è¡Œä¸ºç‰¹å¾ã€‚


---

## é‡è¦æ¦‚å¿µï¼šéšæœºå¹²æ‰°é¡¹

æ€»ä½“å›å½’æ¨¡å‹ï¼ˆPRMï¼‰è®¾å®šä¸‹ï¼Œ
$Y_i$å°†ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆã€‚

- ç‰¹å®šå®¶åº­çš„æ”¯å‡ºï¼ˆ
$Y_i$ï¼‰ = ç³»ç»Ÿæ€§éƒ¨åˆ†ï¼ˆ
$E(Y|X_i)$ + éšæœºéƒ¨åˆ†ï¼ˆ
$u_i$ï¼‰

- ç‰¹å®šå®¶åº­çš„æ”¯å‡ºï¼ˆ
$Y_i$ï¼‰ = ç³»ç»Ÿæ€§éƒ¨åˆ†ï¼ˆ
$\beta_1+\beta_2X_i$ï¼‰ + éšæœºéƒ¨åˆ†ï¼ˆ
$u_i$ï¼‰


**éšæœºå¹²æ‰°é¡¹**ï¼š

- ä¹Ÿè¢«ç§°ä¸ºéšæœºè¯¯å·®é¡¹(stochastic error term)ï¼šæ€»ä½“å›å½’å‡½æ•°ä¸­å¿½ç•¥æ‰çš„ä½†åˆå½±å“ç€Yçš„å…¨éƒ¨å˜é‡çš„æ›¿ä»£ç‰©ï¼Œå®ƒæ˜¯
$Y_i$ä¸æ¡ä»¶æœŸæœ›ï¼ˆ
$E(Y|X_i)$ï¼‰çš„ç¦»å·®ã€‚

$$\begin{align}
u_i &= Y_i - E(Y|X_i) 
\end{align}$$

---

## é‡è¦æ¦‚å¿µï¼šéšæœºå¹²æ‰°é¡¹

éšæœºå¹²æ‰°é¡¹çš„æ¥æºï¼š

- ç†è®ºçš„å«ç³Šï¼šé™¤äº†ä¸»å˜é‡ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶å®ƒå˜é‡çš„å½±å“ï¼Œä½†ä¸æ¸…æ¥šï¼Œåªèƒ½ç”¨ğœ‡_ğ‘–ä»£æ›¿å®ƒä»¬ã€‚ï¼ˆå®¶åº­æ”¶å…¥ä»¥å¤–ï¼Ÿï¼‰

- æ•°æ®çš„ä¸å……åˆ†ï¼šå¯èƒ½çŸ¥é“è¢«å¿½ç•¥çš„å˜é‡ï¼Œä½†ä¸èƒ½å¾—åˆ°è¿™äº›å˜é‡çš„æ•°é‡ä¿¡æ¯ã€‚ï¼ˆå¦‚å®¶åº­è´¢å¯Œæ•°æ®ä¸å¯å¾—ï¼‰

- æ ¸å¿ƒå˜é‡ä¸å…¶å®ƒå˜é‡ï¼šå…¶å®ƒå˜é‡å…¨éƒ¨æˆ–å…¶ä¸­ä¸€äº›åˆèµ·æ¥å½±å“è¿˜æ˜¯å¾ˆå°çš„ã€‚ï¼ˆå¦‚å­å¥³ã€æ•™è‚²ã€æ€§åˆ«ã€å®—æ•™ç­‰ï¼‰

- äººç±»è¡Œä¸ºçš„å†…åœ¨éšæœºæ€§ã€‚ï¼ˆå®¢è§‚å­˜åœ¨ã€å›ºæœ‰çš„ï¼‰

- å˜é‡è¢«â€œç§»èŠ±æ¥æœ¨â€è€Œäº§ç”Ÿæµ‹é‡è¯¯å·®ï¼ˆå¦‚å¼—é‡Œå¾·æ›¼çš„æŒä¹…æ”¶å…¥å’Œæ¶ˆè´¹ï¼‰

- èŠ‚çœåŸåˆ™ï¼šä¸ºäº†ä¿æŒä¸€ä¸ªå°½å¯èƒ½ç®€å•çš„å›å½’æ¨¡å‹

- é”™è¯¯çš„å‡½æ•°å½¢å¼ï¼šæœ‰æ—¶æ ¹æ®æ•°æ®åŠç»éªŒæ— æ³•ç¡®å®šä¸€ä¸ªæ­£ç¡®çš„å‡½æ•°å½¢å¼ ï¼ˆå¤šå…ƒå›å½’å°¤å…¶å¦‚æ­¤ï¼‰

---

## é‡è¦æ¦‚å¿µï¼šéšæœºå¹²æ‰°é¡¹


.pull-left[
ä¸ºä½•æ˜¯â€œéšæœºçš„â€ï¼Ÿ

- æµ‹ä¸å‡†ï¼Ÿï¼ˆè¯¯å·®ï¼‰

- æµ‹é”™äº†ï¼Ÿï¼ˆè¯¯å¯¼ï¼‰

- å…ä¸äº†!ï¼ˆå†…åœ¨æ€§ï¼‰

]

.pull-right[

æ‹¥æŠ±éšæœºä¸–ç•Œ

- é£ç­ï¼š
$Y_i$

- é£ç­çº¿ï¼š
$E(Y|X_i)$

- é£ï¼š
$u_i$

]


---

## é‡è¦æ¦‚å¿µï¼šç†è§£PRMå’ŒPRFçš„å…³ç³»

```{r, out.width="90%", warning=FALSE,message=FALSE}
Y_spc2 <- min(fams60_long$Y[which(fams60_long$X==X_spc)])

p_PRM_demo<- p_PRF +
  geom_point(aes(x=X_spc,y=Y_spc), shape=2,size=3)+
  geom_point(aes(x=X_spc,y=Y_spc2), shape=1, color="black",size=3)+
  geom_hline(aes(yintercept = Y_spc), lty= "dashed") +
  geom_text(aes(x=X_spc+25,y=Y_spc+4),
             label=paste0("E(Y|",X_spc,")=",Y_spc),size=5) +
  geom_hline(aes(yintercept = Y_spc2), lty= "dashed") +
  geom_text(aes(x=X_spc+25,y=Y_spc2-4),
             label=paste0("(Yi|", X_spc,")=",Y_spc2),size=5) 
  
p_PRM_demo
```

è‹¥ç»™å®šä¸€ä¸ªç‰¹å®šå®¶åº­
$(X_i=120, Y_i=79)$ï¼Œåˆ™æ¡ä»¶æœŸæœ›ä¸º
$E(Y|120)=89$


---

## é‡è¦æ¦‚å¿µï¼šç†è§£PRMå’ŒPRFçš„å…³ç³»

è‹¥ç»™å®š
$X_i=$ `r X_spc` ï¼Œåˆ™5ä¸ªå®¶åº­çš„çœŸå®æ¶ˆè´¹æ”¯å‡ºåˆ†åˆ«ä¸ºï¼š

$$\begin{align}
(Y_1|X=120) = 79 &= \beta_1 + \beta_2 \cdot 120 +u_1\\
(Y_2|X=120) = 84 &= \beta_1 + \beta_2 \cdot 120 +u_2\\
(Y_3|X=120) = 90 &= \beta_1 + \beta_2 \cdot 120 +u_3\\
(Y_4|X=120) = 94 &= \beta_1 + \beta_2 \cdot 120 +u_4\\
(Y_5|X=120) = 98 &= \beta_1 + \beta_2 \cdot 120 +u_5
\end{align}$$


---

## é‡è¦æ¦‚å¿µï¼šç†è§£PRMå’ŒPRFçš„å…³ç³»

ä¸»è¦ç»“è®ºï¼š

- æ€»ä½“æœŸæœ›åˆ»ç”»æ€»ä½“çš„â€œè¶‹åŠ¿â€ï¼Œæ€»ä½“å›å½’çº¿è®©â€œè¶‹åŠ¿â€ç›´è§‚åŒ–ã€‚

- ä¸ªä½“éšæœºæ€§æ˜¯ä¸å¯é¿å…çš„ï¼Œæ€»ä¼šâ€œæ¸¸ç¦»â€äºâ€œè¶‹åŠ¿â€ä¹‹å¤–ã€‚

- éšæœºå¹²æ‰°é¡¹
$u_i$ğ‘–æºå¸¦äº†éšæœºä¸ªä½“çš„â€œæ¸¸ç¦»â€ä¿¡æ¯ã€‚

- æ€»ä½“å›å½’æ¨¡å‹æ—¢â€œæå–â€äº†è¶‹åŠ¿å’Œè§„å¾‹æ€§ï¼Œåˆâ€œç»´ç³»â€ç€ä¸ªä½“éšæœºæ€§ï¼Œä»è€Œæ›´å¥½åœ°è¡¨è¾¾äº†â€œçœŸå®ä¸–ç•Œâ€ã€‚

è¯¾åæ€è€ƒï¼š

- å¦‚æœæ˜¯æ— é™æ€»ä½“ï¼Œæ€»ä½“çš„è§„å¾‹æ€§åœ¨ç†è®ºä¸Šä¹Ÿæ˜¯å¯ä»¥è¢«ä¸¥æ ¼è¡¨è¾¾å‡ºæ¥ä¹ˆï¼Ÿ

- å¦‚æœä¸å‘Šè¯‰ä½ æ€»ä½“ï¼Œä½ æ€ä¹ˆçŸ¥é“â€œè§¦ç¢°â€åˆ°çš„æ˜¯â€œçœŸå®çš„â€è¶‹åŠ¿/è§„å¾‹ï¼Ÿ

- ä»å‡æƒ³çš„60ä¸ªå®¶åº­çš„å¾®å‹æ€»ä½“ä¸­ï¼Œâ€œéšä¾¿â€æŠ½å–10ä¸ªå®¶åº­çš„æ•°æ®ï¼Œä½ è¿˜èƒ½çœ‹åˆ°â€œç›´çº¿â€è¶‹åŠ¿ä¹ˆï¼Ÿ


---

## é‡è¦æ¦‚å¿µï¼šâ€œçº¿æ€§â€çš„å«ä¹‰

â€œçº¿æ€§å›å½’æ¨¡å‹â€ä¸­â€œçº¿æ€§â€ä¸€è¯çš„å«ä¹‰

- **å˜é‡â€œçº¿æ€§â€æ¨¡å‹**ï¼šå› å˜é‡å¯¹äºè‡ªå˜é‡æ˜¯çº¿æ€§çš„ã€‚

- **å‚æ•°â€œçº¿æ€§â€æ¨¡å‹**ï¼šå› å˜é‡å¯¹äºå‚æ•°æ˜¯çº¿æ€§çš„ã€‚

---

### ï¼ˆæµ‹è¯•é¢˜ï¼‰â€œçº¿æ€§â€çš„å«ä¹‰

ä¸‹åˆ—æ¨¡å‹åˆ†åˆ«å±äºå“ªä¸€ç±»ï¼Ÿè¯·æŒ‡å‡ºæ¥ï¼š

$$\begin{align}
Y_i &= \beta_1 + \beta_2 X_i +u_i && \text{(mod1)}
\end{align}$$

$$\begin{align}
Y_i &= \beta_1 + \beta_2 X_i + \beta_3 X_i^2 +u_i && \text{(mod2)}
\end{align}$$

$$\begin{align}
Y_i &= \beta_1 + \beta_2 X_i + \beta_3 X_i^2 + \beta_4 X_i^3 +u_i && \text{(mod3)}
\end{align}$$

$$\begin{align}
Y_i &= \beta_1 + \beta_2 \frac{1}{X_i} +u_i && \text{(mod4)}
\end{align}$$


$$\begin{align}
Y_i &= \beta_1 + \beta_2 ln(X_i) +u_i && \text{(mod5)} \\
\end{align}$$



$$\begin{align}
ln(Y_i) &= \beta_1 + \beta_2 X_i +u_i && \text{(mod6)}
\end{align}$$

---

### ï¼ˆæµ‹è¯•é¢˜ï¼‰â€œçº¿æ€§â€çš„å«ä¹‰

ä¸‹åˆ—æ¨¡å‹åˆ†åˆ«å±äºå“ªä¸€ç±»ï¼Ÿè¯·æŒ‡å‡ºæ¥ï¼š

$$\begin{align}
ln(Y_i) &= \beta_1 - \beta_2 \frac{1}{X_i} +u_i && \text{(mod7)} 
\end{align}$$


$$\begin{align}
ln(Y_i) &= ln(\beta_1) + \beta_2 ln(X_i) +u_i && \text{(mod8)} 
\end{align}$$


$$\begin{align}
Y_i &= \frac{1}{1+e^{(\beta_1 + \beta_2 X_{2i}  +u_i) }} && \text{(mod9)}
\end{align}$$


$$\begin{align}
Y_i &= \beta_1 +(0.75-\beta_1)e^{-\beta_2(X_i-2)} +u_i && \text{(mod10)}
\end{align}$$


$$\begin{align}
Y_i &= \beta_1 + \beta_2^3 X_i +u_i && \text{(mod11)} 
\end{align}$$

---

## é‡è¦æ¦‚å¿µï¼šæ ·æœ¬å›å½’çº¿(SRL)

**æ ·æœ¬(Sample)**ï¼š

- ä»æ€»ä½“ä¸­éšæœºæŠ½å–å¾—åˆ°çš„æ•°æ®ã€‚

**æ ·æœ¬å›å½’çº¿**(Sample Regression Lineï¼ŒSRL)ï¼š

- æ˜¯é€šè¿‡æ‹Ÿåˆ**æ ·æœ¬æ•°æ®**å¾—åˆ°çš„ä¸€æ¡æ›²çº¿ï¼ˆæˆ–ç›´çº¿ï¼‰ã€‚æ¢è¨€ä¹‹ï¼Œè¿™æ¡çº¿ç”±æ‹Ÿåˆå€¼
$\hat{Y}_i$è¿æ¥è€Œæˆã€‚

- 
$\hat{Y}_i$æ˜¯å¯¹æ¡ä»¶æœŸæœ›å€¼
$Y|X_i$çš„æ‹Ÿåˆã€‚

- æ‹Ÿåˆæ–¹æ³•æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚é‡‡ç”¨OLSæ–¹æ³•å¯¹æ ·æœ¬æ•°æ®è¿›è¡Œæ‹Ÿåˆã€‚

    - å°½å¯èƒ½æ‹Ÿåˆæ•°æ®
    - ç”¨ä»€ä¹ˆæ–¹æ³•æ‹Ÿåˆï¼Ÿ
    - æ›²çº¿æ˜¯ä»€ä¹ˆå½¢æ€ï¼Ÿ


---

## é‡è¦æ¦‚å¿µï¼šæ ·æœ¬å›å½’å‡½æ•°(SRF)

**æ ·æœ¬å›å½’å‡½æ•°**(Sample Regression Functionï¼ŒSRF)ï¼šæ˜¯æ ·æœ¬å›å½’æ›²çº¿çš„æ•°å­¦å‡½æ•°å½¢å¼ï¼Œå¯æ˜¯æ˜¯çº¿æ€§çš„æˆ–éçº¿æ€§ã€‚å¦‚æœæ˜¯ç›´çº¿åˆ™å¯ä»¥å†™æˆï¼š

$$\begin{align}
\hat{Y}_i =\hat{\beta}_1 + \hat{\beta}_2X_i
\end{align}$$

å¯¹æ¯”æ€»ä½“å›å½’å‡½æ•°ï¼ˆPRFï¼‰ï¼š

$$\begin{align}
E(Y|X_i) =\beta_1 + \beta_2X_i
\end{align}$$

å¯ä»¥è®¤ä¸ºï¼š

- 
$\hat{Y}_i$æ˜¯å¯¹
$E(Y|X_i)$çš„ä¼°è®¡é‡ã€‚

- 
$\hat{\beta}_1$æ˜¯å¯¹
$\beta_1$çš„ä¼°è®¡é‡ã€‚

- 
$\hat{\beta}_2$æ˜¯å¯¹
$\beta_2$çš„ä¼°è®¡é‡ã€‚

---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬ä¸€ä»½éšæœºæ ·æœ¬ï¼šæŠ½æ ·

```{r}
set.seed("123")
sample1<- fams60_long %>% 
  mutate(group = as.factor(group)) %>%
  group_by(group) %>%
  sample_n(size=1) %>% ungroup() %>% select(-id,-group)

set.seed("124")
sample2<- fams60_long %>% 
  mutate(group = as.factor(group)) %>%
  group_by(group) %>%
  sample_n(size=1) %>% ungroup() %>% select(-id,-group) 

```


```{r, fig.height=6}
p_spl1 <- p1 +
  geom_point(data = sample1, 
         aes(x=X, y=Y, shape="sample1", color="sample1"),
         size=3)+
  scale_colour_manual(name= "",
                      values =c("black","blue")) +
  scale_shape_manual(name= "",
                      values =c(15,1))

p_spl1
```

```{r, warning=FALSE,message=FALSE}
old.names <- str_c("V",1:10)
new.names <- str_c("n",1:10)
sample1_t<- sample1 %>% 
  t(.) %>% as_tibble(.) %>% 
  rename_at(vars(old.names), ~ new.names) %>%
  add_column(var=c("X","Y"), .before = "n1") 

kable(sample1_t)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬ä¸€ä»½éšæœºæ ·æœ¬ï¼šæ•°æ®

```{r, fig.height=6}
p_spl_base<- ggplot(sample1, aes(X, Y)) +
  geom_blank() +
  scale_x_continuous(breaks=seq(80,260, length=10)) +
  scale_y_continuous(breaks=seq(50,150, length=3)) +
  labs(x="å®¶åº­æ”¶å…¥X", y="å®¶åº­æ”¯å‡ºY") +
  theme(text=element_text(size=16))

p_spl1_alone <- p_spl_base +
  geom_point(aes(shape="sample1"), color="black",size=3)+
  scale_y_continuous(breaks=seq(50,150, length=3)) +
  scale_shape_manual(name= "",
                      values =c(15))

p_spl1_alone
```

```{r}
kable(sample1_t)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬ä¸€ä»½éšæœºæ ·æœ¬ï¼šSRL

```{r, warning=F}
mod_spl <- formula("Y~X")
coef_mod1<- fun_lm_coef(lm.mod = mod_spl, lm.dt = sample1)
```


```{r, fig.height=6, warning=F}
p_spl1_SRL<- p_spl1_alone +
  geom_abline( intercept = coef_mod1$coef[1], slope= coef_mod1$coef[2], color="black") +
  geom_text(aes(x=120,y=170),
             label=TeX("$\\hat{Y_i}=\\hat{\\beta}_1+\\hat{\\beta}_2X_i$"),size=5) +
  geom_text(aes(x=120,y=160),
             label=TeX("$\\hat{Y}=17.81+0.62X_i$"),size=5) 
p_spl1_SRL  
```

```{r}
kable(sample1_t)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬ä¸€ä»½éšæœºæ ·æœ¬ï¼šSRF

æ ¹æ®ç¬¬ä¸€ä»½éšæœºæ ·æœ¬æ‹Ÿåˆå¾—åˆ°çš„**æ ·æœ¬å›å½’å‡½æ•°**SRFï¼š

```{r ,results="asis"}
fun_report_eq(lm.mod = mod_spl, lm.dt = sample1,
              lm.simple=TRUE,lm.n = 2)
```

æ ·æœ¬æ•°æ®å¦‚ä¸‹ï¼š

```{r}
kable(sample1_t)
```


---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬äºŒä»½éšæœºæ ·æœ¬ï¼šæŠ½æ ·

```{r, warning=FALSE,message=FALSE}
sample2_t<- sample2 %>% 
  t(.) %>% as_tibble(.) %>% 
  rename_at(vars(old.names), ~ new.names) %>%
  add_column(var=c("X","Y"), .before = "n1")
```

```{r, fig.height=6}
p_spl2 <- p1 +
  geom_point(data = sample2, 
         aes(x=X, y=Y, shape="sample2", color="sample2"),size=3)+
  scale_colour_manual(name= "",
                      values =c("purple","blue")) +
  scale_shape_manual(name= "",
                      values =c(17,1))

p_spl2
```

```{r}
kable(sample2_t)
```


---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬äºŒä»½éšæœºæ ·æœ¬ï¼šæ•°æ®


```{r, fig.height=6}
p_spl2_alone <- p_spl_base +
geom_point(data=sample2,aes(shape="sample2"), color="purple",size=3)+
  scale_y_continuous(breaks=seq(50,150, length=3)) +
  scale_shape_manual(name= "",
                      values =c(17))

p_spl2_alone
```

```{r}
kable(sample2_t)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬äºŒä»½éšæœºæ ·æœ¬ï¼šSRL

```{r, warning=F}
coef_mod2<- fun_lm_coef(lm.mod = mod_spl, lm.dt = sample2)
```


```{r, fig.height=6, warning=F}
p_spl2_SRL<- p_spl2_alone +
  geom_abline( intercept = coef_mod2$coef[1], slope= coef_mod2$coef[2], color="purple") +
  geom_text(aes(x=120,y=170),
             label=TeX("$\\hat{Y_i}=\\hat{\\beta}_1+\\hat{\\beta}_2X_i$"),size=5) +
  geom_text(aes(x=120,y=160),
             label=TeX("$\\hat{Y}=7.12+0.65X_i$"),size=5) 
p_spl2_SRL  
```

```{r}
kable(sample2_t)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬äºŒä»½éšæœºæ ·æœ¬ï¼šSRF

æ ¹æ®ç¬¬äºŒä»½éšæœºæ ·æœ¬æ‹Ÿåˆå¾—åˆ°çš„**æ ·æœ¬å›å½’å‡½æ•°**SRFï¼š


```{r, results="asis"}
fun_report_eq(lm.mod = mod_spl, lm.dt = sample2,
              lm.simple = TRUE)
```


æ ·æœ¬æ•°æ®å¦‚ä¸‹ï¼š

```{r}
kable(sample2_t)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ä¸¤ä»½æ ·æœ¬åŒæ—¶å‡ºç°ï¼š

```{r,warning=FALSE}
sample_all<- rbind(sample1, sample2) %>%
  add_column(cat= rep(c("sample1", "sample2"), c(10,10)),
             .before = "X")
```

```{r, fig.height=6,warning=FALSE}
p_sample_all<- p2 + 
  geom_point(data = sample1, 
             aes(x=X, y=Y),color="black", shape=15)+
  geom_point(data = sample2, 
             aes(x=X, y=Y),color="purple", shape=17)+
  geom_abline( intercept = coef_mod1$coef[1], slope= coef_mod1$coef[2], color="black",lty="dashed") +
  geom_abline( intercept = coef_mod2$coef[1], slope= coef_mod2$coef[2], color="red",lty="dashed") +
  geom_abline( intercept = 17, slope= 0.6, color="purple") +
  geom_text(aes(x=120,y=180),
             label=TeX("$SRL1:\\hat{Y}=17.81+0.62X_i$"), color="black",size=5)+
  geom_text(aes(x=120,y=170),
             label=TeX("$SRL2:\\hat{Y}=7.12+0.65X_i$"), color="purple",size=5) +
  geom_text(aes(x=120,y=160),
             label=TeX("$PRL:\\hat{Y}=17+0.6X_i$"), color="red",size=5) 
  
  
p_sample_all
```


---

## é‡è¦æ¦‚å¿µï¼šæ ·æœ¬å›å½’æ¨¡å‹ï¼ˆSRMï¼‰

æ ·æœ¬å›å½’æ¨¡å‹ï¼ˆSample Regression Modelï¼ŒSRMï¼‰ï¼šæŠŠæ ·æœ¬å›å½’å‡½æ•°è¡¨ç°ä¸º**â€œéšæœºâ€**å½¢å¼ã€‚

- å¦‚æœæ ·æœ¬å›å½’å‡½æ•°ä¸ºéšå‡½æ•°ï¼Œåˆ™æ ·æœ¬å›å½’æ¨¡å‹å¯è®°ä¸ºï¼š

$$\begin{align}
Y_i &= g(X_i) +e_i 
\end{align}$$

- å¦‚æœæ ·æœ¬å›å½’å‡½æ•°è¡¨ç°ä¸ºç›´çº¿ï¼Œåˆ™æ ·æœ¬å›å½’æ¨¡å‹å¯è®°ä¸ºï¼š

$$\begin{align}
Y_i &= \hat{\beta}_1 +\hat{\beta}_2X_i +e_i && \text{(SRM_L)}
\end{align}$$

å…¶ä¸­ï¼Œ
$e_i$è¡¨ç¤ºæ®‹å·®ï¼ˆResidualï¼‰

---

## é‡è¦æ¦‚å¿µï¼šæ®‹å·®

æ®‹å·®ï¼ˆResidualï¼‰ï¼š

- å®šä¹‰ï¼šæ˜¯æ ·æœ¬å›å½’å‡½æ•°ä¸Yçš„æ ·æœ¬è§‚æµ‹å€¼ä¹‹é—´çš„ç¦»å·®ã€‚

- è®°å·ï¼š

$$\begin{align}
e_i  &= Y_i - \hat{Y}_i \\
     &= Y_i - (\hat{\beta}_1 +\hat{\beta}_2X_i) 
\end{align}$$

---

## é‡è¦æ¦‚å¿µï¼šç†è§£SRFå’ŒSRMçš„å…³ç³»

```{r, warning=FALSE, message=FALSE}
x_spc_spl2 <- 240
Y_spc_spl2 <- sample2$Y[which(sample2$X==x_spc_spl2)]
lm.spl2 <- lm(formula = mod_spl, data = sample2)
Y_spc_fit <- round(lm.spl2$fitted.values[which(sample2$X==x_spc_spl2)],1)

p_SRL_SRF <- p_spl2_SRL +
  geom_vline(aes(xintercept = x_spc_spl2), lty="dashed") +
  geom_hline(aes(yintercept = Y_spc_spl2), lty="dashed")+
  geom_hline(aes(yintercept = Y_spc_fit), lty="dashed") +
  geom_point(aes(x=x_spc_spl2, y= Y_spc_fit), shape=1, size=3,color="red") +
  geom_text(aes(x=x_spc_spl2+15, y=Y_spc_spl2-5), 
            label=  paste0("(",x_spc_spl2,"," ,Y_spc_spl2-5,")"),size=5)+
  geom_text(aes(x=x_spc_spl2+15, y=Y_spc_fit, 
            label= paste0("(",x_spc_spl2,"," ,Y_spc_fit,")")),size=5)

p_SRL_SRF 

```

ç»™å®š
$x_i=$ `r x_spc_spl2`ï¼Œæ ·æœ¬2çš„è§‚æµ‹å€¼
$Y_i=$ `r x_spc_spl2`ï¼›æ‹Ÿåˆå€¼
$\hat{Y}_i=$ `r Y_spc_fit`ï¼›æ®‹å·®
$e_i=Y_i- \hat{Y}_i=$ `r Y_spc_spl2 -Y_spc_fit`ã€‚

---

## é‡è¦æ¦‚å¿µï¼šæ ·æœ¬å›å½’ä¸æ€»ä½“å›å½’çš„æ¯”è¾ƒ

```{r}
include_graphics("../pic/extra/chpt2-1-PRL-SRL.png", dpi=120)
```

--

ä¸ºä½•ä¸åŒï¼Ÿç»§æ‰¿æ€§å’Œå˜å¼‚æ€§


---

## é‡è¦æ¦‚å¿µï¼šæ ·æœ¬å›å½’ä¸æ€»ä½“å›å½’çš„æ¯”è¾ƒ

.pull-left[
æ€»ä½“å›å½’å‡½æ•°PRF:

$$\begin{align}
E(Y|X_i) &= \beta_1 +\beta_2X_i && \text{(PRF)}
\end{align}$$

æ€»ä½“å›å½’æ¨¡å‹PRM:

$$\begin{align}
Y_i &=  \beta_1 +\beta_2X_i + u_i && \text{(PRM)}
\end{align}$$

]


.pull-right[
æ ·æœ¬å›å½’å‡½æ•°SRF:

$$\begin{align}
\hat{Y}_i =\hat{\beta}_1 + \hat{\beta}_2X_i && \text{(SRF)}
\end{align}$$

æ ·æœ¬å›å½’æ¨¡å‹SRM:

$$\begin{align}
Y_i &= \hat{\beta}_1 + \hat{\beta}_2X_i +e_i && \text{(SRM)}
\end{align}$$

]

--

æ€è€ƒï¼š

- PRFæ— æ³•ç›´æ¥è§‚æµ‹ï¼Œåªèƒ½ç”¨SRFè¿‘ä¼¼æ›¿ä»£

- ä¼°è®¡å€¼ä¸è§‚æµ‹å€¼ä¹‹é—´å­˜åœ¨åå·®

- SRFåˆæ˜¯æ€æ ·å†³å®šçš„å‘¢?


---

## é‡è¦æ¦‚å¿µï¼šæ ·æœ¬å›å½’ä¸æ€»ä½“å›å½’çš„æ¯”è¾ƒ


æ€»ç»“ï¼š

- éšæœºæŠ½æ ·æ•°æ®ç»§æ‰¿äº†æ€»ä½“çš„ç‰¹å¾ã€‚

- åˆ©ç”¨éšæœºæ ·æœ¬è¿›è¡Œæ•°æ®æ‹Ÿåˆæ˜¯å¯¹æ€»ä½“è§„å¾‹çš„â€œåå‘è¿½è¸ªâ€ã€‚

- æ ·æœ¬å›å½’æ¨¡å‹ä¸­çš„æ®‹å·®æ˜¯æ‹Ÿåˆä¸å®Œå…¨çš„äº§ç‰©ã€‚

--

æ€è€ƒï¼š

- æ€æ ·æ¥åˆ¤å®šå¯¹éšæœºæ ·æœ¬çš„ä¸€æ¬¡æ•°æ®æ‹Ÿåˆæ˜¯æ›´ä¼˜çš„ï¼Ÿ

- å­˜ä¸å­˜åœ¨ä¸€ç§â€œæœ€ä¼˜â€çš„æ‹Ÿåˆæ–¹æ³•ï¼Ÿ

--

è¯¾åä½œä¸šï¼š

- è¯·æŠŠ162ååŒå­¦çš„æ‹Ÿåˆçº¿è¿›è¡Œå¹³å‡åŒ–å¤„ç†ï¼ˆæˆªè·å’Œæ–œç‡å–å‡å€¼ï¼‰ï¼Œç»˜åˆ¶å¾—åˆ°ä¸€æ¡â€œå›å½’çº¿â€ã€‚

- ä½ è®¤ä¸ºæ˜¯è¿™æ ¹å¹³å‡åŒ–çš„â€œå›å½’çº¿â€ä¸çœŸç›¸æ›´é€¼è¿‘ä¹ˆï¼Ÿ

---
layout: false
class: center, middle, duke-softblue,hide_logo
name: ols

# 5.3 OLSæ–¹æ³•ä¸å‚æ•°ä¼°è®¡

### æ™®é€šæœ€å°äºŒä¹˜æ³•ï¼ˆOLSï¼‰

### å‚æ•°ä¼°è®¡

### ä¼°è®¡ç²¾åº¦

### åŒºé—´ä¼°è®¡

---
layout: true

<div class="my-header-h2"></div>

<div class="watermark1"></div>

<div class="watermark2"></div>

<div class="watermark3"></div>

<div class="my-footer"><span>huhuaping@  &emsp;&emsp; <a href="#chapter"> ç¬¬05ç«  ç›¸å…³å’Œå›å½’åˆ†æ </a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
<a href="#ols"> 5.3 OLSæ–¹æ³•ä¸å‚æ•°ä¼°è®¡ </a> </span></div> 

---

## æ™®é€šæœ€å°äºŒä¹˜æ³•ï¼ˆOLSï¼‰ï¼šå¼•å­

æˆ‘ä»¬å¦‚ä½•ä¼°è®¡å›å½’å‡½æ•°ä¸­çš„ç³»æ•°ï¼Ÿ

.pull-left[

æ€»ä½“å›å½’ï¼š
$$\begin{cases}
  \begin{align}
  E(Y|X_i) &= \beta_1 +\beta_2X_i && \text{(PRF)} \\
  Y_i &=  \beta_1 +\beta_2X_i + u_i && \text{(PRM)}
  \end{align}
\end{cases}$$

]

.pull-right[
æ ·æœ¬å›å½’ï¼š
$$\begin{cases}
  \begin{align}
  \hat{Y}_i & =\hat{\beta}_1 + \hat{\beta}_2X_i && \text{(SRF)} \\
  Y_i &= \hat{\beta}_1 + \hat{\beta}_2X_i +e_i && \text{(SRM)}
  \end{align}
\end{cases}$$

]


é¦–å…ˆéœ€è¦å›ç­”çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ä¼°è®¡å¾—å‡ºæ ·æœ¬å›å½’å‡½æ•°ä¸­çš„ç³»æ•°ï¼Ÿäº‹å®ä¸Šï¼Œæ–¹æ³•æœ‰å¤šç§å¤šæ ·ï¼š

- å›¾è§£æ³•ï¼šæ¯”è¾ƒç²—ç³™ï¼Œä½†æä¾›äº†åŸºæœ¬çš„è§†è§‰è®¤çŸ¥

- æœ€å°äºŒä¹˜æ³•(order lease squares, OLS)ï¼šæœ€å¸¸ç”¨çš„æ–¹æ³•

- æœ€å¤§ä¼¼ç„¶æ³•(maximum likelihood, ML)

- çŸ©ä¼°è®¡æ–¹æ³•(Moment method, MM)

---

## æ™®é€šæœ€å°äºŒä¹˜æ³•ï¼ˆOLSï¼‰ï¼šå›é¡¾å’Œæ¯”è¾ƒ

.pull-left[
.pa2.bg-lightest-blue[
æ€»ä½“å›å½’å‡½æ•°PRF:

$$\begin{align}
E(Y|X_i) &= \beta_1 +\beta_2X_i 
\end{align}$$

æ€»ä½“å›å½’æ¨¡å‹PRM:

$$\begin{align}
Y_i &=  \beta_1 +\beta_2X_i + u_i 
\end{align}$$
]

]

.pull-right[

.pa2.bg-light-blue[
æ ·æœ¬å›å½’å‡½æ•°SRF:

$$\begin{align}
\hat{Y}_i =\hat{\beta}_1 + \hat{\beta}_2X_i 
\end{align}$$

æ ·æœ¬å›å½’æ¨¡å‹SRM:

$$\begin{align}
Y_i &= \hat{\beta}_1 + \hat{\beta}_2X_i +e_i 
\end{align}$$

]

]

--

æ€è€ƒï¼š

- PRFæ— æ³•ç›´æ¥è§‚æµ‹ï¼Œåªèƒ½ç”¨SRFè¿‘ä¼¼æ›¿ä»£

- ä¼°è®¡å€¼ä¸è§‚æµ‹å€¼ä¹‹é—´å­˜åœ¨åå·®

- SRFåˆæ˜¯æ€æ ·å†³å®šçš„å‘¢?

---

## æ™®é€šæœ€å°äºŒä¹˜æ³•ï¼ˆOLSï¼‰ï¼šåŸç†

è®¤è¯†æ™®é€šæœ€å°äºŒä¹˜æ³•çš„åŸç†ï¼šä¸€ä¸ªå›¾ç¤º

```{r, fig.cap="æœ€å°äºŒä¹˜æ³•çš„åŸç†"}
include_graphics("../pic/extra/chpt3-OLS-demo.png",dpi=270)
```

---

## æ™®é€šæœ€å°äºŒä¹˜æ³•ï¼ˆOLSï¼‰ï¼šåŸç†

OLSçš„åŸºæœ¬åŸç†ï¼šæ®‹å·®å¹³æ–¹å’Œæœ€å°åŒ–ã€‚

$$\begin{align}
e_i  &= Y_i - \hat{Y}_i \\
     &= Y_i - (\hat{\beta}_1 +\hat{\beta}_2X_i) 
\end{align}$$


$$\begin{align}
Q  &= \sum{e_i^2} \\
   &= \sum{(Y_i - \hat{Y}_i)^2} \\
   &= \sum{\left( Y_i - (\hat{\beta}_1 +\hat{\beta}_2X_i) \right)^2} \\
   &\equiv f(\hat{\beta}_1,\hat{\beta}_2)
\end{align}$$


$$\begin{align}
Min(Q)  &= Min \left ( f(\hat{\beta}_1,\hat{\beta}_2) \right)
\end{align}$$

---

### ï¼ˆç¤ºä¾‹ï¼‰ æ™®é€šæœ€å°äºŒä¹˜æ³•ï¼ˆOLSï¼‰çš„ä¸€ä¸ªæ•°å€¼è¯•éªŒ

å‡è®¾å­˜åœ¨ä¸‹é¢æ‰€ç¤ºçš„4ç»„è§‚æµ‹å€¼
$(X_i, Y_i)$ï¼š

```{r, fig.cap="æ•°å€¼è¯•éªŒï¼šæ•°æ®"}
include_graphics("../pic/extra/chpt3-OLS-compare1.png" )
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ æ™®é€šæœ€å°äºŒä¹˜æ³•ï¼ˆOLSï¼‰çš„ä¸€ä¸ªæ•°å€¼è¯•éªŒ

å‡è®¾éšä¾¿çŒœæƒ³äº†å¦‚ä¸‹ä¸¤ä¸ªSRFï¼Œå®Œæˆä¸‹è¡¨è®¡ç®—ï¼Œå¹¶åˆ†æå“ªä¸ªSRFç»™å‡ºçš„
$(\hat{\beta}_1, \hat{\beta}_2)$è¦æ›´å¥½ï¼Ÿ

$$\begin{align}
SRF1ï¼š\hat{Y}_{1i} & = \hat{\beta}_1 +\hat{\beta}_2X_i = 1.572 + 1.357X_i \\
SRF2ï¼š\hat{Y}_{2i} & = \hat{\beta}_1 +\hat{\beta}_2X_i = 3.0 + 1.0X_i 
\end{align}$$


```{r, fig.cap="æ•°å€¼è¯•éªŒï¼šè®¡ç®—"}
include_graphics("../pic/extra/chpt3-OLS-compare2.png", dpi = 220)
```

---

## å‚æ•°ä¼°è®¡ï¼šå›å½’å‚æ•°çš„OLSç‚¹ä¼°è®¡

æœ€å°åŒ–æ±‚è§£ï¼š

$$\begin{align}
Min(Q)  &= Min \left ( f(\hat{\beta}_1,\hat{\beta}_2) \right)\\
 &= Min\left(\sum{\left( Y_i - (\hat{\beta}_1 +\hat{\beta}_2X_i) \right)^2} \right) \\
  &= Min \sum{\left( Y_i - \hat{\beta}_1 - \hat{\beta}_2X_i \right)^2}
\end{align}$$


æ–¹ç¨‹ç»„å˜å½¢ï¼Œå¾—åˆ°**æ­£è§„æ–¹ç¨‹ç»„**ï¼š

$$\begin{align}
\left \{
  \begin{split}
   \sum{\left[ \hat{\beta}_1 - (Y_i -\hat{\beta}_2X_i) \right]}  &=0 \\
   \sum{\left[ X_i^2\hat{\beta}_2 - (Y_i-\hat{\beta}_1 )X_i \right ] }&=0 
   \end{split}
\right. 
\end{align}$$

$$\begin{align}
\left \{
  \begin{split}
   \sum{Y_i} - n\hat{\beta}_1- (\sum{X_i})\hat{\beta}_2 &=0 \\
   \sum{X_iY_i}-(\sum{X_i})\hat{\beta}_1 -  (\sum{X_i^2})\hat{\beta}_2 &=0 
   \end{split}
\right.
\end{align}$$

---

## å‚æ•°ä¼°è®¡ï¼šå›å½’å‚æ•°çš„OLSç‚¹ä¼°è®¡

è¿›è€Œå¾—åˆ°å›å½’ç³»æ•°çš„è®¡ç®—å…¬å¼1ï¼ˆFavorite Fiveï¼ŒFFï¼‰ï¼š

$$\begin{align}
  \left \{
  \begin{split}
  \hat{\beta}_2 &=\frac{n\sum{X_iY_i}-\sum{X_i}\sum{Y_i}}{n\sum{X_i^2}-\left ( \sum{X_i} \right)^2}\\
  \hat{\beta}_1 &=\frac{n\sum{X_i^2Y_i}-\sum{X_i}\sum{X_iY_i}}{n\sum{X_i^2}-\left ( \sum{X_i} \right)^2}
  \end{split} 
  \right.
  &&\text{(FF solution)}
\end{align}$$

---

## å‚æ•°ä¼°è®¡ï¼šå›å½’å‚æ•°çš„OLSç‚¹ä¼°è®¡

æ­¤å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„ç¦»å·®å…¬å¼(favorite fiveï¼Œff)

$$\begin{align}
\left \{
  \begin{split}
  \hat{\beta}_2 &=\frac{\sum{x_iy_i}}{\sum{x_i^2}}\\
  \hat{\beta}_1 &=\bar{Y}_i-\hat{\beta}_2\bar{X}_i
  \end{split} 
\right.  
  && \text{(ff solution)}
\end{align}$$

å…¶ä¸­ç¦»å·®è®¡ç®—
$x_i=X_i-\bar{X};\  y_i=Y_i - \bar{Y}$ã€‚

---

### ï¼ˆæµ‹è¯•é¢˜ï¼‰

ä»¥ä¸‹å¼å­ä¸ºä»€ä¹ˆæ˜¯ç­‰ä»·çš„ï¼Ÿä½ èƒ½æ¨å¯¼å‡ºæ¥ä¹ˆï¼Ÿ

$$\begin{align}
\left\{
  \begin{split}
    \sum{x_iy_i} &= \sum{\left[ (X_i-\bar{X})(Y_i-\bar{Y})\right]} 
    &&= \sum{X_iY_i} - \frac{1}{n}\sum{X_i}\sum{Y_i} \\
    \sum{x_i^2} &= \sum{(X_i- \bar{X})^2} 
    &&= \sum{X_i^2} -\frac{1}{n} \left( \sum{X_i} \right)^2
  \end{split}
\right.
\end{align}$$

---

## å‚æ•°ä¼°è®¡ï¼šéšæœºå¹²æ‰°é¡¹å‚æ•°çš„OLSç‚¹ä¼°è®¡

PRMå…¬å¼å˜å½¢ï¼š

$$\begin{alignedat}{2}
&\left.
  \begin{split}
   Y_i &&= \beta_1 - &&\beta_2X_i +u_i  \ && \text{(PRM)} \Rightarrow \\
   \hat{Y} &&= \beta_1 - &&\beta_2\bar{X} +\bar{u} && \\   
  \end{split}
\right \} \Rightarrow \\
 & y_i = \beta_2x_i +(u_i- \bar{u})  
\end{alignedat}$$

æ®‹å·®å…¬å¼å˜å½¢ï¼š

$$\begin{alignedat}{2}
 &\left. 
  \begin{split}
    & e_i = y_i - \hat{\beta}_2x_i \\
    & e_i = \beta_2x_i +(u_i- \bar{u}) -\hat{\beta}_2x_i 
  \end{split}
\right \}  \Rightarrow \\
& e_i =-(\hat{\beta}_2- \beta_2)x_i + (u_i- \hat{u})
\end{alignedat}$$

---

## å‚æ•°ä¼°è®¡ï¼šéšæœºå¹²æ‰°é¡¹å‚æ•°çš„OLSç‚¹ä¼°è®¡

æ±‚è§£æ®‹å·®å¹³æ–¹å’Œï¼š

$$\begin{alignedat}{2}
  & \sum{e_i^2} && = (\hat{\beta}_2 - \beta_2)^2\sum{x_i^2} + \sum{(u-\bar{u})^2} - 2(\hat{\beta}_2 - \beta_2)\sum{x_i(u-\bar{u})}  
\end{alignedat}$$

æ±‚æ®‹å·®å¹³æ–¹å’Œçš„æœŸæœ›ï¼š

$$\begin{align}
E(\sum{e_i^2}) &= 
 \sum{x_i^2 E \left[ (\hat{\beta}_2 - \beta_2)^2 \right ]}+ E\left[ \sum{(u-\bar{u})^2} \right ]\\
&+ 2E \left[ (\hat{\beta}_2 - \beta_2)\sum{x_i(u-\bar{u})} \right ] \\
& \equiv   A + B + C \\
& = \sigma^2 + (n-1)\sigma^2 -2\sigma^2 \\
& = (n-2)\sigma^2 
\end{align}$$

---

## å‚æ•°ä¼°è®¡ï¼šéšæœºå¹²æ‰°é¡¹å‚æ•°çš„OLSç‚¹ä¼°è®¡

**å›å½’è¯¯å·®æ–¹å·®**ï¼ˆDeviation of Regression Errorï¼‰ï¼š

- é‡‡ç”¨OLSæ–¹æ³•ä¸‹ï¼Œæ€»ä½“å›å½’æ¨¡å‹PRMä¸­éšæœºå¹²æ‰°é¡¹
$u_i$çš„æ€»ä½“æ–¹å·®çš„æ— åä¼°è®¡é‡ï¼Œè®°ä¸º
$E(\sigma^2) \equiv \hat{\sigma}^2$ï¼Œç®€å•åœ°è®°ä¸º
$\hat{\sigma}^2$ã€‚

$$\begin{align}
\hat{\sigma}^2=\frac{\sum{e_i^2}}{n-2}
\end{align}$$

--

**å›å½’è¯¯å·®æ ‡å‡†å·®**ï¼ˆStandard Deviation of Regression Errorï¼‰ï¼šæœ‰æ—¶å€™ä¹Ÿè®°ä¸º**se**ã€‚

$$\begin{align}
\hat{\sigma}=\sqrt{\frac{\sum{e_i^2}}{n-2}}
\end{align}$$

???
- é‡‡ç”¨OLSæ–¹æ³•ä¸‹ï¼Œæ€»ä½“å›å½’æ¨¡å‹PRMä¸­éšæœºå¹²æ‰°é¡¹
$u_i$çš„æ€»ä½“æ ‡å‡†å·®çš„æ— åä¼°è®¡é‡ï¼Œè®°ä¸º
$E(\sigma) \equiv \hat{\sigma}$ï¼Œä»£æ•°è¡¨è¾¾å¼ä¸€èˆ¬ç®€å•åœ°è®°ä¸º
$\hat{\sigma}$

---

### ï¼ˆé™„å½•ï¼‰Aè¿‡ç¨‹è¯æ˜

$$\begin{align}
A & = \sum{x_i^2 E \left[ (\hat{\beta}_2 - \beta_2)^2 \right ]} \\
  & = \sum{ \left[ x_i^2 \cdot var(\hat{\beta}_2) \right] } \\
  & = var(\hat{\beta}_2) \cdot \sum{x_i^2}  \\
  & = \frac{\sigma^2}{\sum{ x_i^2}} \cdot \sum{ x_i^2}  \\
  & = \sigma^2
\end{align}$$

---

### ï¼ˆé™„å½•ï¼‰Bè¿‡ç¨‹è¯æ˜

$$\begin{align}
B  = E \left[ \sum{(u-\bar{u})^2} \right ] 
  & = E(\sum{u_i^2}) - 2E \left[ \sum{(u_i\bar{u})} \right] +nE(\bar{u}^2) \\
  & = n \cdot Var(u_i) - 2E \left[ \sum{(u_i \cdot \frac{\sum{u_i}}{n} )}  \right]  + nE(\frac{\sum{u_i}}{n})^2 \\
  & = n \sigma^2 - 2E \left[ \frac{\sum{u_i}}{n} \sum{u_i} \right] + E\left[ \frac{(\sum{u_i})^2}{n} \right]\\
  & = n \sigma^2- E\left[ (\sum{u_i})^2/{n} \right] 
  = n \sigma^2  -  \frac{E(u_i^2) + E(u_2^2) + \cdots +  E(u_n^2) )}{n} \\
  & =  n \sigma^2 -  \frac{nVar{u_i}}{n} 
   =  n \sigma^2 -  \sigma^2 =  (n-1) \sigma^2
\end{align}$$

---

### ï¼ˆé™„å½•ï¼‰Cè¿‡ç¨‹è¯æ˜

$$\begin{align}
C &= - 2E \left[ (\hat{\beta}_2 - \beta_2)\sum{x_i(u_i-\bar{u})} \right ] \\
  &= - 2E \left[ \frac{\sum{x_iu_i}}{\sum{x_i^2}} \left( \sum{x_iu_i}-\bar{u}\sum{x_i} \right) \right ] \\
  &= - 2E \left[ \frac{ \left( \sum{x_iu_i} \right)^2}{\sum{x_i^2}}  \right ]  \\
  &= -2E \left[(\hat{\beta}_2 - \beta_2)^2 \right] = -2\sigma^2
\end{align}$$

--

- å…¶ä¸­ï¼š

$$\begin{align}
\hat{\beta}_2 & = \sum{k_iY_i} = \sum{k_i(\beta_1 +\beta_2X_i +u_i)}   = \beta_1\sum{k_i} +\beta_2 \sum{k_iX_i}+\sum{k_iu_i}  
= \beta_2 +\sum{k_iu_i} \\
\hat{\beta}_2 - \beta_2 & = \sum{k_iu_i} = \frac{ \sum{x_iu_i} }{\sum{x_i^2}}
\end{align}$$

---
exclude:true

## ï¼ˆæ¡ˆä¾‹ï¼‰æ•™è‚²ç¨‹åº¦ä¸æ—¶å‡å·¥èµ„

```{r, message=FALSE, warning=FALSE}
data_wage <- as_tibble(read.xlsx("../data/extra/Table-3-2-edu-wage.xlsx", sheet = 1))
n <- dim(data_wage)[1]

lm.wage <- lm(formula = "Y~X", data_wage)



calc_tbl <- data_wage %>%
  mutate(FF_XY = X*Y, FF_X_sqr = X^2, FF_Y_sqr = Y^2,
         ff_x = X-mean(X), ff_y = Y-mean(Y),
         ff_xy=ff_x*ff_y, ff_x_sqr=ff_x^2, ff_y_sqr=ff_y^2, 
         Y_hat= fitted(lm.wage),
         e_i = residuals(lm.wage), 
         e_i_star =e_i/sd(e_i),
         e_i_star_st = MASS::studres(lm.wage),
         e_i_sqr = e_i^2)  %>%
  rbind(colSums(.)) %>%  
  mutate(obs=replace(obs, obs==91, "sum")) 

k <- dim(calc_tbl)[2]

FF_ff <- calc_tbl %>%
  filter(obs=="sum") %>%
  mutate_if(is.numeric, funs(round(., digits = 3)))

b2 <- lm.wage$coefficients[2]
b1 <- lm.wage$coefficients[1]
mean_X <- (FF_ff$X)/n
mean_Y <- (FF_ff$Y)/n
dev <- (FF_ff$e_i_sqr)/(n-2)
dev_b2 <- dev/FF_ff$ff_x_sqr
dev_b1 <- dev_b2*(FF_ff$FF_X_sqr/n)
S_b1 <- sqrt(dev_b1)
S_b2 <- sqrt(dev_b2)
TSS <- sum((data_wage$Y -mean(data_wage$Y))^2)
RSS <- FF_ff$e_i_sqr
ESS <- TSS -RSS
r2  <- ESS/TSS
r <- cor(data_wage$X, data_wage$Y)
cov_XY <- cov(data_wage$X, data_wage$Y)
S_X <- sd(data_wage$X)
S_Y <- sd(data_wage$Y)
t_0.975 <- qt(0.975, n-2)
chisq_0.025 <- qchisq(0.025,n-2)
chisq_0.975 <- qchisq(0.975,n-2)
t_b1 <- b1/S_b1
t_b2 <- b2/S_b2
f_ESS <- 1
f_RSS <- n-2
f_TSS <- n-1
f_0.95 <- qf(0.95,f_ESS,f_RSS)
f_test <- (ESS/f_ESS)/(RSS/f_RSS)
# forecast
X_0 <- 20
Y_0_hat <- b1+b2*X_0
t_0.95 <- qt(0.95,n-2)
S2_Y0h <- dev*(1/n+(X_0-mean_X)^2/(FF_ff$ff_x_sqr))
Y_exp_lft <- Y_0_hat - t_0.95*(sqrt(S2_Y0h))
Y_exp_rht <- Y_0_hat + t_0.95*(sqrt(S2_Y0h))
S2_Y0h_mns <- dev*(1+1/n+(X_0-mean_X)^2/(FF_ff$ff_x_sqr))
Y_ind_lft <- Y_0_hat - t_0.95*(sqrt(S2_Y0h_mns))
Y_ind_rht <- Y_0_hat + t_0.95*(sqrt(S2_Y0h_mns))

```

```{r}
head.name <- c("obs","$X_i$","$Y_i$","$X_iY_i$", "$X_i^2$", "$Y_i^2$", "$x_i$", "$y_i$", "$x_iy_i$","$x_i^2$","$y_i^2$","$\\hat{Y}_i$","$e_i$","$e_{i, sd}^{\\ast}$","$e_{i, st}^{\\ast}$","$e_i^2$")  

show_tbl <- calc_tbl  %>% 
  rename_at(vars(names(.)), ~ head.name)

```


---

### ï¼ˆæ¡ˆä¾‹ï¼‰è®¡ç®—è¡¨FFå’Œff

```{r, warning=F, message=FALSE}
show_tbl %>%
  select(1:11) %>%
  mutate_if(is.numeric, ~formatC(., digits = 2, format = "f")) %>%
  kable(align = "c")  %>%
  kable_styling(full_width = T, font_size= 20)
```

---

### ï¼ˆæ¡ˆä¾‹ï¼‰è®¡ç®—å›å½’ç³»æ•°

å…¬å¼1: ï¼ˆFavorite Fiveï¼ŒFFå½¢å¼ï¼‰

```{r, results= "asis"}
cat(
  "$$\\begin{align}",
  "\\hat{\\beta}_2 &=\\frac{n\\sum{X_iY_i}-\\sum{X_i}\\sum{Y_i}}{n\\sum{X_i^2}-\\left ( \\sum{X_i} \\right)^2}\\\\",
str_c(
  "&=\\frac{",n,"\\ast",FF_ff$FF_XY,"-",FF_ff$X, "\\ast",FF_ff$Y,"}{",n,"\\ast",FF_ff$FF_X_sqr,"-",FF_ff$X,"^2}",
  "=",round(b2,4)
  ),
"\\end{align}$$",
sep="\n"
)
```


```{r, results= "asis"}
cat(
  "$$\\begin{align}",
  "\\hat{\\beta_1} &= \\bar{Y} - \\hat{\\beta}_2 \\bar{X}",
  str_c(
    "=",round(mean_Y,4),"-",round(b2,4),"\\ast",mean_X,
    "=",round(b1,4)),
  "\\end{align}$$",
  sep="\n"
)
```

---

### ï¼ˆæ¡ˆä¾‹ï¼‰è®¡ç®—å›å½’ç³»æ•°

å…¬å¼2ï¼šï¼ˆç¦»å·®å½¢å¼ï¼Œfavorite fiveï¼Œffå½¢å¼ï¼‰


```{r, results= "asis"}
cat(
  "$$\\begin{align}",
  "\\hat{\\beta}_2 =\\frac{\\sum{x_iy_i}}{\\sum{x_i^2}}",
str_c(
  "=\\frac{",FF_ff$ff_xy,
  "}{",FF_ff$ff_x_sqr,"}",
  "=",round(b2,4)
  ),
"\\end{align}$$",
sep="\n"
)
```


```{r, results= "asis"}
cat(
  "$$\\begin{align}",
   
  "\\hat{\\beta_1} = \\bar{Y} - \\hat{\\beta}_2 \\bar{X}",
  str_c(
    "=",round(mean_Y,4),"-",round(b2,4),"\\ast",mean_X,
    "=",round(b1,4)),
  "\\end{align}$$",
  sep="\n"
)
```

---

### ï¼ˆæ¡ˆä¾‹ï¼‰æ ·æœ¬å›å½’æ–¹ç¨‹SRF

```{r, results="asis"}
cat(
  "$$\\begin{align}",
  "\\hat{Y}_i= \\hat{\\beta}_1 + \\hat{\\beta}_2 X_i",
  str_c(
    "=", round(b1,4),"+",round(b2,4),"X_i"
  ),
  "\\end{align}$$",
  sep = "\n"
)
```

---

### ï¼ˆæ¡ˆä¾‹ï¼‰æ ·æœ¬å›å½’çº¿SRL

```{r, warning=FALSE,message=FALSE}

p0 <- ggplot(data=data_wage, aes(X, Y)) +
  geom_point(color= "blue", shape=1, size=3) +
  labs(x= "æ•™è‚²å¹´æ•°X", y = "æ—¶å‡å·¥èµ„Y") +
  scale_x_continuous(breaks=seq(0,20, by=6), limits = c(0,20)) +
  scale_y_continuous(breaks=seq(0,15, by=3), limits = c(0,15)) +
  theme(text = element_text(size=16)) 
  
p0
```

---

### ï¼ˆæ¡ˆä¾‹ï¼‰æ ·æœ¬å›å½’çº¿SRL

```{r,  warning=FALSE,message=FALSE}

text1 <- TeX("$\\hat{Y_i}=\\hat{\\beta}_1+\\hat{\\beta}_2X_i$")
text2 <- TeX(str_c("$\\hat{Y}=", round(b1,4), 
                   "+", round(b2,4),"X_i$"))
p1 <- ggplot(data=data_wage, aes(X, Y)) +
  geom_point(color= "blue", shape=1, size=3) +
  labs(x= "æ•™è‚²å¹´æ•°X", y = "æ—¶å‡å·¥èµ„Y") +
  scale_x_continuous(breaks=seq(0,20, by=6), limits = c(0,20)) +
  scale_y_continuous(breaks=seq(0,15, by=3), limits = c(0,15))  +
  #stat_smooth(method = "lm", se=FALSE)
  geom_abline(intercept = b1, slope = b2,color="green") +
  geom_text(aes(x=5,y=14),label=text1,size=5) +
  geom_text(aes(x=5,y=12),label=text2,size=5) +
  theme(text = element_text(size=16)) 

p1

```


---

### ï¼ˆæ¡ˆä¾‹ï¼‰è®¡ç®—å¾—åˆ°æ‹Ÿåˆå€¼å’Œæ®‹å·®

.pull-left[

```{r}
show_tbl %>%
  select(c(1:3,12:13)) %>%
  #mutate_if(is.numeric, funs(formatC(., digits = 4, format = "f"))) %>%
  kable(digits =c(0,0,4,4,4) ) %>%  
  kable_styling(font_size=20)
```

]

.pull-right[

æ ¹æ®ä»¥ä¸Šæ ·æœ¬å›å½’æ–¹ç¨‹ï¼Œå¯ä»¥è®¡ç®—å¾—åˆ°
$Y_i$çš„å›å½’æ‹Ÿåˆå€¼
$\hat{Y}_i$ï¼Œä»¥åŠå›å½’æ®‹å·®
$e_i$ã€‚

$$\begin{align}
\hat{Y}_i &=\hat{\beta}_1 +\hat{\beta}_2X_i\\
e_i &= Y_i - \hat{Y}_i
\end{align}$$
]


---

### ï¼ˆæ¡ˆä¾‹ï¼‰è®¡ç®—å›å½’è¯¯å·®æ–¹å·®å’Œæ ‡å‡†å·®

å›å½’è¯¯å·®æ–¹å·®
$\hat{\sigma}^2$

```{r, results="asis"}
cat(
  "$$\\begin{align}",
  "\\hat{\\sigma}^2= \\frac{\\sum{e_i^2}} {(n-2)}",
  str_c(
    "=\\frac{", FF_ff$e_i_sqr,"}{",n-2,"}",
    "=", round(dev,4)
  ),
  "\\end{align}$$",
  sep = "\n"
)

```

å›å½’è¯¯å·®æ ‡å‡†å·®
$\hat{\sigma}$ï¼š

```{r, results="asis"}
cat(
  "$$\\begin{align}",
  "\\hat{\\sigma}=\\sqrt{\\frac{\\sum{e_i^2}}{(n-2)}}",
  str_c(
    "=\\sqrt{", round(dev,4),"}",
    "=", round(sqrt(dev),4)
  ),
  "\\end{align}$$",
  sep = "\n"
)

```


---

## OLSå‚æ•°ä¼°è®¡ï¼šâ€œä¼°è®¡å€¼â€ä¸â€œä¼°è®¡é‡â€

ç†è§£OLSæ–¹æ³•ä¸‹çš„â€œä¼°è®¡å€¼â€ä¸â€œä¼°è®¡é‡â€

å›å½’ç³»æ•°çš„è®¡ç®—å…¬å¼1ï¼ˆFavorite Fiveï¼ŒFFï¼‰ï¼š

$$\begin{align}
  \left \{
  \begin{split}
  \hat{\beta}_2 &=\frac{n\sum{X_iY_i}-\sum{X_i}\sum{Y_i}}{n\sum{X_i^2}-\left ( \sum{X_i} \right)^2}\\
  \hat{\beta_1} &=\frac{n\sum{X_i^2Y_i}-\sum{X_i}\sum{X_iY_i}}{n\sum{X_i^2}-\left ( \sum{X_i} \right)^2}
  \end{split} 
  \right.
  &&\text{(FF solution)}
\end{align}$$


- å¦‚æœç»™å‡ºçš„å‚æ•°ä¼°è®¡ç»“æœæ˜¯ç”±ä¸€ä¸ªå…·ä½“æ ·æœ¬èµ„æ–™è®¡ç®—å‡ºæ¥çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªâ€œä¼°è®¡å€¼â€ï¼Œæˆ–è€…â€œç‚¹ä¼°è®¡â€ï¼Œæ˜¯å‚æ•°ä¼°è®¡é‡çš„ä¸€ä¸ªå…·ä½“æ•°å€¼ï¼›

- å¦‚æœæŠŠä¸Šå¼çœ‹æˆå‚æ•°ä¼°è®¡çš„ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œé‚£ä¹ˆï¼Œåˆ™å®ƒæ˜¯
$(X_i,Y_i)$çš„å‡½æ•°ï¼Œè€Œ
$Y_i$æ˜¯éšæœºå˜é‡ï¼Œæ‰€ä»¥å‚æ•°ä¼°è®¡ä¹Ÿæ˜¯éšæœºå˜é‡ï¼Œåœ¨è¿™ä¸ªè§’åº¦ä¸Šï¼Œç§°ä¹‹ä¸ºâ€œä¼°è®¡é‡â€ã€‚

---

## OLSå‚æ•°ä¼°è®¡ï¼šSRFå’ŒSRMçš„ç‰¹å¾

OLSä¼°è®¡é‡æ˜¯çº¯ç²¹ç”±å¯è§‚æµ‹çš„(å³æ ·æœ¬)é‡(æŒ‡Xå’ŒY)è¡¨è¾¾çš„ï¼Œå› æ­¤å®ƒä»¬å¾ˆå®¹æ˜“è®¡ç®—ã€‚

å®ƒä»¬æ˜¯ç‚¹ä¼°è®¡é‡(point estimators)ï¼Œå³å¯¹äºç»™å®šæ ·æœ¬ï¼Œæ¯ä¸ªä¼°è®¡é‡ä»…æä¾›æœ‰å…³æ€»ä½“å‚æ•°çš„ä¸€ä¸ª(ç‚¹)å€¼<sup>*</sup>ã€‚

ä¸€æ—¦ä»æ ·æœ¬æ•°æ®å¾—åˆ°OLSä¼°è®¡å€¼ï¼Œä¾¿å®¹æ˜“ç”»å‡ºæ ·æœ¬å›å½’çº¿ã€‚

.footnote[æ³¨ï¼šæˆ‘ä»¬ä»¥åè¿˜å°†è€ƒè™‘åŒºé—´ä¼°è®¡é‡(interval Estimators)]

---

## OLSå‚æ•°ä¼°è®¡ï¼šSRFå’ŒSRMçš„ç‰¹å¾

- ç‰¹å¾1ï¼šæ ·æœ¬å›å½’çº¿ä¸€å®šä¼šç»è¿‡æ ·æœ¬å‡å€¼ç‚¹
$(\bar{X}, \bar{Y})$ï¼š

$$\begin{align}
\bar{Y} = \hat{\beta}_1 +\hat{\beta}_2\bar{X}
\end{align}$$

- ç‰¹å¾2ï¼š
$Y_i$çš„**ä¼°è®¡å€¼**(
$\hat{Y}_i$)çš„å‡å€¼(
$\bar{\hat{Y_i}}$)ç­‰äºYçš„æ ·æœ¬å‡å€¼(
$\bar{Y}$)

$$\begin{align}
\hat{Y_i} &= \hat{\beta}_1 +\hat{\beta}_2\bar{X} \\
& =(\bar{Y} - \hat{\beta}_2\bar{X}) + \hat{\beta_2}X_i \\
& = \bar{Y} - \hat{\beta}_2(X_i - \bar{X}) 
\end{align}$$

$$\begin{align}
&\Rightarrow  1/n\sum{\hat{Y_i}} =  1/n\sum{\bar{Y} - \hat{\beta}_2(X_i - \bar{X})} \\
&\Rightarrow  \bar{\hat{Y_i}}  = \bar{Y}
\end{align}$$

---

## OLSå‚æ•°ä¼°è®¡ï¼šSRFå’ŒSRMçš„ç‰¹å¾

- ç‰¹å¾3ï¼šæ®‹å·®çš„å‡å€¼(
$\bar{e_i}$)ä¸ºé›¶ï¼š

$$\begin{align}
\sum{\left[ \hat{\beta}_1 - (Y_i -\hat{\beta}_2X_i) \right]}  &=0 \\
\sum{\left[ Y_i- \hat{\beta}_1 - \hat{\beta}_2X_i) \right]}  &=0 \\
\sum{( Y_i- \hat{Y}_i )} &=0 \\
\sum{e_i}  &=0 \\
\bar{e_i} &=0
\end{align}$$

---

## OLSå‚æ•°ä¼°è®¡ï¼šSRFå’ŒSRMçš„ç‰¹å¾

- ç‰¹å¾4ï¼šSRMå’ŒSRFå¯ä»¥å†™æˆç¦»å·®å½¢å¼ï¼š

$$\begin{align}
& \left.
  \begin{split}
  Y_i && = \hat{\beta}_1 + \hat{\beta}_2X_i + e_i \\
  \bar{Y} &&= \hat{\beta}_1 + \hat{\beta}_2\bar{X}
  \end{split}
\right \} \Rightarrow \\
& Y_i - \bar{Y} =\hat{\beta_2}(X_i - \bar{X}) + e_i \Rightarrow  \\
& y_i=\hat{\beta_2}x_i +e_i \  &&\text{(SRM-dev)}
\end{align}$$

$$\begin{align}
& \left.
  \begin{split}
  \hat{Y}_i && = \hat{\beta}_1 + \hat{\beta}_2X_i\\
  \bar{Y} &&= \hat{\beta}_1 + \hat{\beta}_2\bar{X}
  \end{split}
\right \} \Rightarrow \\
& \hat{Y}_i - \bar{Y} =\hat{\beta_2}(X_i - \bar{X})  \Rightarrow  \\
& \hat{y}_i=\hat{\beta_2}x_i \  &&\text{(SRF-dev)} 
\end{align}$$

---

## OLSå‚æ•°ä¼°è®¡ï¼šSRFå’ŒSRMçš„ç‰¹å¾

- ç‰¹å¾5ï¼šæ®‹å·®(
$e_i$)å’Œ
$Y_i$çš„æ‹Ÿåˆå€¼(
$\hat{Y_i}$)ä¸ç›¸å…³

$$\begin{align}
Cov(e_i, \hat{Y_i}) &= E \left[ \left( e_i-E(e_i)\right )\cdot \left( \hat{Y_i}-E(\hat{Y_i})\right ) \right]
= E(e_i \cdot \hat{y_i}) \\
& = \sum(e_i \cdot \hat{\beta_2}x_i) \\
& = \sum{ \left[ (y_i-\hat{\beta_2}x_i) \cdot \hat{\beta_2}x_i \right]} \\
& = \hat{\beta_2}\sum \left[ (y_i-\hat{\beta_2}x_i)\cdot x_i \right]\\
& = \hat{\beta_2}\sum \left[ (y_ix_i-\hat{\beta_2}x_i^2)  \right]\\
& = \hat{\beta_2}\sum{x_iy_i}-\hat{\beta}_2^2\sum{x_i^2}  && \Leftarrow \hat{\beta_2} = \frac{\sum{x_iy_i}}{x_i^2} \\
& = \hat{\beta}_2^2\sum{x_i^2}-  \hat{\beta_2}^2\sum{x_i^2}   = 0
\end{align}$$


- ç‰¹å¾6ï¼šæ®‹å·®(
$e_i$)å’Œè‡ªå˜é‡(
$X_i$)ä¸ç›¸å…³

---

## OLSå‚æ•°ä¼°è®¡ï¼šç¦»å·®å…¬å¼

- ç¦»å·®å®šä¹‰ä¸ç¬¦å·ï¼š

$$\begin{align}
x_i &= X_i - \bar{X} \\
y_i &= Y_i - \bar{Y} \\
\hat{y}_i &= \hat{Y}_i - \bar{\hat{Y}}_i = \hat{Y}_i - \bar{Y}
\end{align}$$

- PRMåŠå…¶ç¦»å·®å½¢å¼ï¼š

$$\begin{align}
& \left.
  \begin{split}
  Y_i && = \beta_1 + \beta_2X_i + u_i \\
  \bar{Y} &&= \beta_1 + \beta_2\bar{X} + \bar{u}
  \end{split}
\right \} \Rightarrow \\
& Y_i - \bar{Y} =\beta_2x_i + (u_i- \bar{u}) \Rightarrow  \\
& y_i=\hat{\beta_2}x_i + (u_i- \bar{u})  \  &&\text{(PRM-dev)}
\end{align}$$

---

## OLSå‚æ•°ä¼°è®¡ï¼šç¦»å·®å…¬å¼

--
.pull-left[
- SRMåŠå…¶ç¦»å·®å½¢å¼ï¼š
$$\begin{align}
& \left.
  \begin{split}
  Y_i && = \hat{\beta}_1 + \hat{\beta}_2X_i + e_i \\
  \bar{Y} &&= \hat{\beta}_1 + \hat{\beta}_2\bar{X}
  \end{split}
\right \} \Rightarrow \\
& Y_i - \bar{Y} =\hat{\beta_2}(X_i - \bar{X}) + e_i \Rightarrow  \\
& y_i=\hat{\beta_2}x_i +e_i 
\end{align}$$
]

--
.pull-right[
- SRFåŠå…¶ç¦»å·®å½¢å¼ï¼š

$$\begin{align}
& \left.
  \begin{split}
  \hat{Y}_i && = \hat{\beta}_1 + \hat{\beta}_2X_i\\
  \bar{Y} &&= \hat{\beta}_1 + \hat{\beta}_2\bar{X}
  \end{split}
\right \} \Rightarrow \\
& \hat{Y}_i - \bar{Y} =\hat{\beta_2}(X_i - \bar{X})  \Rightarrow  \\
& \hat{y}_i=\hat{\beta_2}x_i \   
\end{align}$$
]

--

- æ®‹å·®çš„ç¦»å·®å½¢å¼ï¼š

$$\begin{align}
 y_i=\hat{\beta_2}x_i +e_i  &&\text{(SRM-dev)} \ \Rightarrow  \\
 e_i =y_i - \hat{\beta_2}x_i \  &&\text{(residual-dev)}
\end{align}$$


---

## OLSå‚æ•°ä¼°è®¡ï¼šæ€è€ƒä¸è®¨è®º

**å†…å®¹å°ç»“**ï¼š

- æ™®é€šæœ€å°äºŒä¹˜æ–¹æ³•ï¼ˆOLSï¼‰é‡‡ç”¨â€œé“…å‚çº¿è·ç¦»å¹³æ–¹å’Œæœ€å°åŒ–â€çš„æ€æƒ³ï¼Œæ¥æ‹Ÿåˆä¸€æ¡æ ·æœ¬å›å½’çº¿ï¼Œè¿›è€Œæ±‚è§£å‡ºæ¨¡å‹å‚æ•°ä¼°è®¡é‡ã€‚

- å¤§å®¶éœ€è¦å¾ˆç†Ÿç»ƒåœ°è®°ä½OLSå‚æ•°ä¼°è®¡é‡å…¬å¼ï¼Œä»¥åŠå®ƒä»¬çš„å‡ å¤§é‡è¦ç‰¹å¾ï¼

**æ€è€ƒè®¨è®º**ï¼š

- OLSé‡‡ç”¨çš„â€œé“…å‚çº¿è·ç¦»å¹³æ–¹å’Œæœ€å°åŒ–â€è¿™ä¸€æ–¹æ¡ˆï¼Œå‡­ä»€ä¹ˆå®ƒè¢«å¥‰ä¸ºè®¡é‡åˆ†æçš„ç»å…¸æ–¹æ³•ï¼Ÿä½ è§‰å¾—è¿˜æœ‰å…¶ä»–å¯è¡Œæ›¿ä»£æ–¹æ¡ˆä¹ˆï¼Ÿ

- å›å½’æ ‡å‡†è¯¯å·®
$se$çš„ç°å®å«ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿå›å½’å‚æ•°ä¼°è®¡ä¸éšæœºå¹²æ‰°é¡¹çš„æ–¹å·®ä¼°è®¡æœ‰ä»€ä¹ˆå†…åœ¨è”ç³»ä¹ˆï¼Ÿ

- OLSæ–¹æ³•çš„å‡ ä¸ªç‰¹å¾ï¼Œæ˜¯ä¸æ˜¯ä½¿å®ƒâ€œå¤©ç”Ÿä¸½è´¨â€ã€â€œå¨˜èƒé‡Œç”Ÿä¸‹æ¥å°±å«ç€é‡‘é’¥åŒ™â€ï¼Ÿä¸ºä»€ä¹ˆèƒ½è¿™ä¹ˆè¯´ï¼Ÿ

???
å¯ä»¥æ˜¯â€œå‚çº¿è·ç¦»å¹³æ–¹å’Œæœ€å°åŒ–â€ä¹ˆï¼Ÿå¦‚æœæ˜¯è·ç¦»çš„3æ¬¡æ–¹æˆ–4æ¬¡æ–¹ä¹‹å’Œï¼Œåˆä¼šæ€æ ·ï¼Ÿè·ç¦»çš„ç»å¯¹å€¼ä¹‹å’Œå¯ä»¥ä¹ˆï¼Ÿå¯¹äºè¿™äº›æ–¹æ¡ˆï¼Œä½ æœ‰ä»€ä¹ˆæƒ³æ³•ï¼Ÿ

---

## ä¼°è®¡ç²¾åº¦ï¼šå¼•å­

æˆ‘ä»¬å·²ç»ä½¿ç”¨OLSæ–¹æ³•åˆ†åˆ«å¾—åˆ°æ€»ä½“å›å½’æ¨¡å‹(PRM)çš„3ä¸ªé‡è¦å‚æ•°ï¼ˆå®é™…ä¸æ­¢3ä¸ªï¼‰çš„ç‚¹ä¼°è®¡é‡ï¼š

$$\begin{align}
Y_i &=  \beta_1 +\beta_2X_i + u_i  \\
\hat{\beta}_2 &=\frac{\sum{x_iy_i}}{\sum{x_i^2}} ; \quad
\hat{\beta}_1 =\bar{Y}_i-\hat{\beta}_2\bar{X}_i ; \quad
\hat{\sigma}^2 =\frac{\sum{e_i^2}}{n-2}
\end{align}$$

>é—®é¢˜æ˜¯ï¼šæˆ‘ä»¬å¦‚ä½•çŸ¥é“OLSæ–¹æ³•ç‚¹ä¼°è®¡é‡æ˜¯å¦å¯é ï¼ŸOLSæ–¹æ³•çš„ç‚¹ä¼°è®¡é‡æ˜¯å¦ç¨³å®šï¼Ÿ OLSæ–¹æ³•çš„ç‚¹ä¼°è®¡é‡æ˜¯å¦å¯ä¿¡ï¼Ÿ

å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ç§è¡¨è¾¾OLSæ–¹æ³•ä¼°è®¡ç¨³å®šæ€§æˆ–ä¼°è®¡ç²¾åº¦çš„æŒ‡æ ‡ï¼

- ç‚¹ä¼°è®¡é‡çš„**æ–¹å·®**ï¼ˆvarianceï¼‰å’Œ**æ ‡å‡†å·®**ï¼ˆstandard deviationï¼‰å°±æ˜¯è¡¡é‡ä¼°è®¡ç¨³å®šæ€§æˆ–ä¼°è®¡ç²¾åº¦çš„ä¸€ç±»é‡è¦æŒ‡æ ‡ï¼

---

## ä¼°è®¡ç²¾åº¦ï¼šæ–œç‡ç³»æ•°çš„æ–¹å·®å’Œæ ·æœ¬æ–¹å·®

.pull-left[
æ–œç‡ç³»æ•°ï¼ˆ
$\hat{\beta}_2$ï¼‰çš„**æ€»ä½“æ–¹å·®**ï¼ˆ
$\sigma^2_{\hat{\beta}_2}$ï¼‰å’Œ**æ€»ä½“æ ‡å‡†å·®**ï¼ˆ
$\sigma_{\hat{\beta}_2}$ï¼‰ï¼š

$$\begin{align}
Var(\hat{\beta}_2) \equiv \sigma_{\hat{\beta}_2}^2  & =\frac{\sigma^2}{\sum{x_i^2}} \\
\sigma_{\hat{\beta}_2} &=\sqrt{\frac{\sigma^2}{\sum{x_i^2}}} 
\end{align}$$

- å…¶ä¸­ï¼Œ
$Var(u_i) \equiv \sigma^2$è¡¨ç¤ºéšæœºå¹²æ‰°é¡¹
$u_i$çš„æ€»ä½“æ–¹å·®ã€‚

]

.pull-right[
æ–œç‡ç³»æ•°ï¼ˆ
$\hat{\beta}_2$ï¼‰çš„**æ ·æœ¬æ–¹å·®**ï¼ˆ
$S^2_{\hat{\beta}_2}$ï¼‰å’Œ**æ ·æœ¬æ ‡å‡†å·®**ï¼ˆ
$S_{\hat{\beta}_2}$ï¼‰ï¼š

$$\begin{align}
S_{\hat{\beta}_2}^2 &=\frac{\hat{\sigma}^2}{\sum{x_i^2}} \\
S_{\hat{\beta}_2} &=\sqrt{\frac{\hat{\sigma}^2}{\sum{x_i^2}}}
\end{align}$$

- å…¶ä¸­ï¼Œ
$E(\sigma^2) = \hat{\sigma}^2 = \frac{\sum{e_i^2}}{n-2}$è¡¨ç¤ºå¯¹éšæœºå¹²æ‰°é¡¹ï¼ˆ
$u_i$ï¼‰çš„æ€»ä½“æ–¹å·®çš„**æ— åä¼°è®¡é‡**ã€‚
]

---

### ï¼ˆé™„å½•ï¼‰è¯æ˜è¿‡ç¨‹1

**æ­¥éª¤1**
$\hat{\beta}_2$çš„å˜å½¢ï¼š

$$\begin{align}
\hat{\beta}_2 &=\frac{\sum{x_iy_i}}{\sum{x_i^2}}= \frac{\sum{\left[ x_i (Y_i -\bar{Y}) \right]} }{\sum{x_i^2}}  \\
& = \frac{\sum{ x_iY_i}- \sum{ x_i \bar{Y} } }{\sum{x_i^2}}    \\
& = \frac{\sum{x_iY_i}- \bar{Y}\sum{x_i} }{\sum{x_i^2}}  && \leftarrow \left[ \sum{x_i}=\sum{(X_i -\bar{X})} = 0 \right]  \\
& = \sum{ \left(\frac{x_i}{\sum{x_i^2}} \cdot Y_i \right) }   && \leftarrow  \left[ k_i \equiv \frac{x_i}{\sum{x_i^2}} \right]\\
& = \sum{k_iY_i}
\end{align}$$

> - å…¶ä¸­ï¼Œ
$k_i \equiv \frac{x_i}{\sum{x_i^2}}$ã€‚

---

### ï¼ˆé™„å½•ï¼‰è¯æ˜è¿‡ç¨‹2

**æ­¥éª¤2**ï¼šè®¡ç®—
$\hat{\beta}_2$çš„**æ€»ä½“æ–¹å·®**ï¼ˆ
$\sigma^2_{\hat{\beta}_2}$ï¼‰ï¼š

$$\begin{align}
\sigma^2_{\hat{\beta}_2} & \equiv Var(\hat{\beta}_2) 
 = Var(\sum{k_iY_i} ) \\
& = \sum{\left( k_i^2Var(Y_i) \right)} \\
& = \sum{\left( k_i^2Var(\beta_1 +\beta_2X_i +u_i) \right)} \\
& = \sum{ \left( k_i^2Var(u_i) \right)}  && \leftarrow \left[ k_i  \equiv \frac{x_i}{\sum{x_i^2}} \right]\\
& = \sum{ \left( \left(\frac{x_i}{\sum{x_i^2}} 
                 \right)^2 \cdot \sigma^2 
          \right)} \\
& = \frac{\sigma^2}{\sum{x_i^2}}
\end{align}$$

> å…¶ä¸­ï¼Œ
$Var(u_i) \equiv \sigma^2$è¡¨ç¤ºéšæœºå¹²æ‰°é¡¹
$u_i$çš„æ€»ä½“æ–¹å·®ã€‚

---

## ä¼°è®¡ç²¾åº¦ï¼šæˆªè·ç³»æ•°çš„æ–¹å·®å’Œæ ·æœ¬æ–¹å·®

.pull-left[
æˆªè·ç³»æ•°ï¼ˆ
$\hat{\beta}_1$ï¼‰çš„**æ€»ä½“æ–¹å·®**ï¼ˆ
$\sigma^2_{\hat{\beta}_1}$ï¼‰å’Œ**æ€»ä½“æ ‡å‡†å·®**ï¼ˆ
$\sigma_{\hat{\beta}_1}$ï¼‰ï¼š


$$\begin{align}
Var(\hat{\beta}_1) \equiv \sigma_{\hat{\beta}_1}^2  &=\frac{\sum{X_i^2}}{n} \cdot \frac{\sigma^2}{\sum{x_i^2}} \\
\sigma_{\hat{\beta}_1} & =\sqrt{\frac{\sum{X_i^2}}{n} \cdot \frac{\sigma^2}{\sum{x_i^2}}}
\end{align}$$


> - å…¶ä¸­ï¼Œ
$Var(u_i) \equiv \sigma^2$è¡¨ç¤ºéšæœºå¹²æ‰°é¡¹
$u_i$çš„æ€»ä½“æ–¹å·®ã€‚

]

.pull-right[
æˆªè·ç³»æ•°ï¼ˆ
$\hat{\beta}_1$ï¼‰çš„**æ ·æœ¬æ–¹å·®**ï¼ˆ
$S^2_{\hat{\beta}_1}$ï¼‰å’Œ**æ ·æœ¬æ ‡å‡†å·®**ï¼ˆ
$S_{\hat{\beta}_1}$ï¼‰ï¼š

$$\begin{align}
S_{\hat{\beta}_1}^2 &=\frac{\sum{X^2_i}}{n} \cdot \frac{\hat{\sigma}^2}{\sum{x_i^2}} \\
S_{\hat{\beta}_1} &=\sqrt{\frac{\sum{X^2_i}}{n} \cdot \frac{\hat{\sigma}^2}{\sum{x_i^2}}}
\end{align}$$

> - å…¶ä¸­ï¼Œ
$E(\sigma^2) = \hat{\sigma}^2 = \frac{\sum{e_i^2}}{n-2}$è¡¨ç¤ºå¯¹éšæœºå¹²æ‰°é¡¹ï¼ˆ
$u_i$ï¼‰çš„æ€»ä½“æ–¹å·®çš„**æ— åä¼°è®¡é‡**ã€‚

]

---

### ï¼ˆé™„å½•ï¼‰è¯æ˜è¿‡ç¨‹1

**æ­¥éª¤1**
$\hat{\beta}_1$çš„å˜å½¢ï¼š

$$\begin{align}
\hat{\beta_1} & = \bar{Y}_i-\hat{\beta}_2\bar{X}_i && \leftarrow \left[ \hat{\beta}_2= \sum{k_iY_i} \right] \\
& = \frac{1}{n} \sum{Y_i} - \sum{\left( k_iY_i \cdot \bar{X} \right)} \\
& = \sum{\left( (\frac{1}{n} - k_i\bar{X}) \cdot Y_i  \right)}   && \leftarrow \left[ w_i \equiv \frac{1}{n} - k_i\bar{X} \right]\\     
& = \sum{w_iY_i}
\end{align}$$

> - å…¶ä¸­ï¼šä»¤
$w_i \equiv \frac{1}{n} - k_i\bar{X}$

---

### ï¼ˆé™„å½•ï¼‰è¯æ˜è¿‡ç¨‹2

**æ­¥éª¤2**è®¡ç®—
$\hat{\beta}_1$çš„**æ€»ä½“æ–¹å·®**ï¼ˆ
$\sigma^2_{\hat{\beta}_1}$ï¼‰ï¼š

$$\begin{align}
\sigma^2_{\hat{\beta}_1} & \equiv  Var(\hat{\beta_1})  = Var(\sum{w_iY_i}) \\
& = \sum{\left( w_i^2Var(\beta_1 +\beta_2X_i + u_i) \right)} && \leftarrow \left[w_i \equiv \frac{1}{n} - k_i\bar{X} \right]\\
& = \sum{\left( 
            \left( \frac{1}{n} - k_i\bar{X} \right)^2Var(u_i) 
         \right)} \\
& = \sigma^2 \cdot \sum{ \left( \frac{1}{n^2} - \frac{2 \bar{X} k_i}{n} + k_i^2 \bar{X}^2 \right) }  && \leftarrow \left[ \sum{k_i} = \sum{\left( \frac{x_i}{\sum{x_i^2}} \right)= \frac{\sum{x_i}} {\sum{x_i^2}}}=0 \right] \\
& = \sigma^2 \cdot \left( \frac{1}{n} + \bar{X}^2\sum{k_i^2} \right)  && \leftarrow \left[ k_i \equiv \frac{x_i}{\sum{x_i^2}} \right]\\
& = \sigma^2 \cdot \left( \frac{1}{n} + \bar{X}^2\sum{ \left( \frac{x_i}{\sum{x_i^2}} \right) ^2} \right) 
\end{align}$$

---

### ï¼ˆé™„å½•ï¼‰è¯æ˜è¿‡ç¨‹2ï¼ˆç»­ï¼‰


**æ­¥éª¤2**è®¡ç®—
$\hat{\beta}_1$çš„**æ€»ä½“æ–¹å·®**ï¼ˆ
$\sigma^2_{\hat{\beta}_1}$ï¼‰ï¼ˆç»­å‰ï¼‰ï¼š

$$\begin{align}
& = \sigma^2 \cdot \left( \frac{1}{n} + \bar{X}^2  \frac{\sum{x_i^2}}{\left( \sum{x_i^2} \right)^2}  \right) \\
& = \sigma^2 \cdot \left( \frac{1}{n} +   \frac{ \bar{X}^2 } { \sum{x_i^2} }  \right) \\
& =  \frac{\sum{x_i^2} + n\bar{X}^2} {n\sum{x_i^2}} \cdot \sigma^2 && \leftarrow  \left[ \sum{x_i^2} + n\bar{X}^2 = \sum{(X_i-\bar{X})^2} + n\bar{X}^2 = \sum{X_i^2}\right]\\
& = \frac{\sum{X_i^2}}{n} \cdot \frac{\sigma^2}{\sum{x_i^2}}
\end{align}$$

---

## ä¼°è®¡ç²¾åº¦ï¼šå°ç»“ä¸æ€è€ƒ

ç°åœ¨åšä¸€ä¸ª**å†…å®¹å°ç»“**ï¼š

- ä¸ºäº†è¡¡é‡OLSæ–¹æ³•çš„ç‚¹ä¼°è®¡é‡æ˜¯å¦ç¨³å®šæˆ–æ˜¯å¦å¯ä¿¡ï¼Œæˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨æ–¹å·®å’Œæ ‡å‡†å·®æŒ‡æ ‡æ¥è¡¨è¾¾ã€‚

- å¤§å®¶åº”ç†Ÿè®°**æ–œç‡**å’Œ**æˆªè·**ä¼°è®¡é‡çš„**æ€»ä½“æ–¹å·®**å’Œ**æ ·æœ¬æ–¹å·®**æœ€ç»ˆå…¬å¼ã€‚

è¯·å¤§å®¶**æ€è€ƒ**å¦‚ä¸‹é—®é¢˜ï¼š


- æ€»ä½“æ–¹å·®å’Œæ ·æœ¬æ–¹å·®éƒ½æ˜¯ç¡®å®šçš„æ•°ä¹ˆï¼Ÿ

- äºŒè€…åˆ†åˆ«å—é‚£äº›å› ç´ çš„å½±å“ï¼ŸäºŒè€…åˆæœ‰ä»€ä¹ˆè”ç³»ï¼Ÿ

- è¯æ˜è¿‡ç¨‹ä¸­ï¼Œçº¦å®šçš„
$k_i$å’Œ
$w_i$ï¼Œæœ‰ä»€ä¹ˆç‰¹å¾ï¼Ÿ

--

.pull-left[

$$\begin{cases}
  \begin{align}
  \sum{k_i}  & =0 \\
   \sum{k_iX_i} & = 1
  \end{align}
\end{cases}$$

]

.pull-right[

$$\begin{cases}
  \begin{align}
  \sum{w_i}  & =1 \\
   \sum{w_iX_i} & = 0
  \end{align}
\end{cases}$$

]

---

###ï¼ˆæ¡ˆä¾‹ï¼‰è®¡ç®—å›å½’ç³»æ•°çš„æ ·æœ¬æ–¹å·®

å¯¹äºâ€œæ•™è‚²ç¨‹åº¦æ¡ˆä¾‹â€ï¼Œåˆ©ç”¨FF-ffè®¡ç®—è¡¨ï¼Œä»¥åŠæˆ‘ä»¬å·²ç®—å‡ºçš„å¦‚ä¸‹è®¡ç®—é‡ï¼š

- å›å½’è¯¯å·®æ–¹å·®ï¼š
$\hat{\sigma}^2=$ `r formatC(dev,4, format="f")`ã€‚

åˆ™å¯ä»¥è¿›ä¸€æ­¥è®¡ç®—å‡ºï¼Œå›å½’ç³»æ•°çš„æ ·æœ¬æ–¹å·®çš„æ ‡å‡†å·®åˆ†åˆ«ä¸ºï¼š

```{r, results="asis"}
cat(
  "$$\\begin{align}",
  "S^2_{\\hat{\\beta}_2} &= \\frac{\\hat{\\sigma}^2} {\\sum{x_i^2}}",
  str_c(
    "=\\frac{", round(dev,4),"}{",FF_ff$ff_x_sqr,"}",
    "=", round(dev_b2,4),"\\\\"),
  "S_{\\hat{\\beta}_2} &= \\sqrt{\\frac{\\hat{\\sigma}^2} {\\sum{x_i^2}}}", 
  str_c("=","\\sqrt{",round(dev_b2,4),"}",
  "=", round(sqrt(dev_b2),4)
  ),
  "\\end{align}$$",
  sep = "\n"
)
```

```{r, results="asis"}
cat(
  "$$\\begin{align}",
  "S^2_{\\hat{\\beta}_1} &= \\frac{\\sum{X_i^2}} {n} \\frac{\\hat{\\sigma}^2} {\\sum{x_i^2}}",
  str_c(
    "=\\frac{",FF_ff$FF_X_sqr, "}{", n,"}",
    "\\frac{", round(dev,4),"}{",FF_ff$ff_x_sqr,"}",
    "=", round(dev_b1,4),"\\\\"),
  "S_{\\hat{\\beta}_1} &= \\sqrt{\\frac{\\sum{X_i^2}}{n}\\frac{\\hat{\\sigma}^2} {\\sum{x_i^2}}}", 
  str_c("=","\\sqrt{",round(dev_b1,4),"}",
  "=", round(sqrt(dev_b1),4)
  ),
  "\\end{align}$$",
  sep = "\n"
)
```


---

## åŒºé—´ä¼°è®¡ï¼šæ–œç‡ç³»æ•°

$$\begin{align}
\hat{\beta}_2 & \sim N(\mu_{\hat{\beta}_2}, \sigma^2_{\hat{\beta}_2})
&& \leftarrow \left[ \mu_{\hat{\beta}_2}= \beta_2; \quad
\sigma^2_{\hat{\beta}_2} = \frac{\sigma^{2}}{\sum x_{i}^{2}} \right]
\end{align}$$

$$\begin {align} 
&Z=\frac{\left(\hat{\beta}_{2}-\beta_{2}\right)}{\sqrt{\operatorname{var}\left(\hat{\beta}_{2}\right)}}
=\frac{\left(\hat{\beta}_{2}-\beta_{2}\right)}{\sqrt{\sigma_{\beta_{2}}^{2}}}
=\frac{\hat{\beta}_{2}-\beta_{2}}{\sigma_{\hat{\beta}_{2}}}
=\frac{\left(\hat{\beta}_{2}-\beta_{2}\right)}{\sqrt{\frac{\sigma^{2}}{\sum x_{i}^{2}}}} && \leftarrow Z \sim N(0, 1)
\end {align}$$


$$\begin{align} 
T&=\frac{\left(\hat{\beta}_{2}-\beta_{2}\right)}{\sqrt{S_{\beta_{2}}^{2}}}
=\frac{\hat{\beta}_{2}-\beta_{2}}{\sqrt{S_{\beta_{2}}^{2}}}
=\frac{\hat{\beta}_{2}-\beta_{2}}{S_{\hat{\beta}_{2}}}
&& \leftarrow T \sim t(n-2)
 \end{align}$$

$$\begin{align} 
S^2_{\hat{\beta}_2} =\frac{\hat{\sigma}^{2}}{\sum x_{i}^{2}}
; \quad
\hat{\sigma}^{2}=\frac{\sum e_{i}^{2}}{n-2}
 \end{align}$$
 
$$\begin{align} 
\operatorname{Pr}\left[-t_{\alpha / 2,(n-2)} \leq \mathrm{T} \leq t_{\alpha / 2,(n-2)}\right]=1-\alpha
 \end{align}$$
 

---

## åŒºé—´ä¼°è®¡ï¼šæ–œç‡ç³»æ•°


$$\begin {align} 
\operatorname{Pr}\left[-t_{\alpha / 2,(n-2)} \leq \frac{\hat{\beta}_{2}-\beta_{2}}{S_{\hat{\beta}_{2}}} \leq t_{\alpha / 2 ,(n-2)}\right]=1-\alpha
 \end {align}$$
 
$$\begin {align} 
\operatorname{Pr}\left[\hat{\beta}_{2}-t_{\alpha / 2,(n-2)} \cdot S_{\hat{\beta}_{2}} \leq \beta_{2} \leq \hat{\beta}_{2}+t_{\alpha / 2,(n-2)} \cdot S_{\hat{\beta}_{2}}\right]=1-\alpha
 \end {align}$$

å› æ­¤ï¼Œ
$\beta_2$çš„
$100(1-\alpha)\%$ç½®ä¿¡ä¸Šé™å’Œä¸‹é™åˆ†åˆ«ä¸ºï¼š

$$\hat{\beta}_{2} \pm t_{\alpha / 2} \cdot S_{\hat{\beta}_{2}}$$

$\beta_2$çš„
$100(1-\alpha)\%$ç½®ä¿¡åŒºé—´ä¸ºï¼š

$$\left[ \hat{\beta}_{2} - t_{\alpha / 2} \cdot S_{\hat{\beta}_{2}}, \quad \hat{\beta}_{2} + t_{\alpha / 2} \cdot S_{\hat{\beta}_{2}} \right]$$


---

## åŒºé—´ä¼°è®¡ï¼šæˆªè·ç³»æ•°

$$\begin{align}
\hat{\beta}_1 & \sim N(\mu_{\hat{\beta}_1}, \sigma^2_{\hat{\beta}_1})
&& \leftarrow \left[ \mu_{\hat{\beta}_1}= \beta_1; \quad
\sigma^2_{\hat{\beta}_1} = \frac{\sum{X_i^2}}{n} \frac{\sigma^{2}}{\sum x_{i}^{2}} \right]
\end{align}$$

$$\begin {align} 
&Z=\frac{\left(\hat{\beta}_{1}-\beta_{1}\right)}{\sqrt{\operatorname{var}\left(\hat{\beta}_{1}\right)}}
=\frac{\left(\hat{\beta}_{1}-\beta_{1}\right)}{\sqrt{\sigma_{\beta_{1}}^{2}}}
=\frac{\hat{\beta}_{1}-\beta_{1}}{\sigma_{\hat{\beta}_{1}}}
=\frac{\left(\hat{\beta}_{1}-\beta_{1}\right)}{\sqrt{\frac{\sum{X^2_i}}{n} \cdot \frac{\sigma^{2}}{\sum x_{i}^{2}}}} && \leftarrow Z \sim N(0, 1)
\end {align}$$

$$\begin{align} 
T&=\frac{\left(\hat{\beta}_{1}-\beta_{1}\right)}{S^2_{\hat{\beta}_1}}
=\frac{\hat{\beta}_{1}-\beta_{1}}{\sqrt{S_{\beta_{1}}^{2}}}
=\frac{\hat{\beta}_{1}-\beta_{1}}{S_{\hat{\beta}_{1}}}
&& \leftarrow T \sim t(n-2)
 \end{align}$$
 
$$\begin{align} 
S^2_{\hat{\beta}_1} =\frac{\sum{X_i^2}}{n} \cdot \frac{\hat{\sigma}^{2}}{\sum x_{i}^{2}}
; \quad 
\hat{\sigma}^{2}=\frac{\sum e_{i}^{2}}{n-2}
 \end{align}$$
 
$$\begin{align} 
\operatorname{Pr}\left[-t_{\alpha / 2,(n-2)} \leq \mathrm{T} \leq t_{\alpha / 2,(n-2)}\right]=1-\alpha
 \end{align}$$
 

---

## åŒºé—´ä¼°è®¡ï¼šæˆªè·ç³»æ•°

$$\begin {align} 
\operatorname{Pr}\left[-t_{\alpha / 2,(n-2)} \leq \frac{\hat{\beta}_{1}-\beta_{1}}{S_{\hat{\beta}_{1}}} \leq t_{\alpha / 2 ,(n-2)}\right]=1-\alpha
 \end {align}$$
 
$$\begin {align} 
\operatorname{Pr}\left[\hat{\beta}_{1}-t_{\alpha / 2,(n-2)} \cdot S_{\hat{\beta}_{1}} \leq \beta_{1} \leq \hat{\beta}_{1}+t_{\alpha / 2,(n-2)} \cdot S_{\hat{\beta}_{1}}\right]=1-\alpha
 \end {align}$$

å› æ­¤ï¼Œ
$\beta_1$çš„
$100(1-\alpha)\%$ç½®ä¿¡ä¸Šé™å’Œä¸‹é™åˆ†åˆ«ä¸ºï¼š

$$\hat{\beta}_{1} \pm t_{\alpha / 2} \cdot S_{\hat{\beta}_{1}}$$

$\beta_1$çš„
$100(1-\alpha)\%$ç½®ä¿¡åŒºé—´ä¸ºï¼š

$$\left[ \hat{\beta}_{1} - t_{\alpha / 2} \cdot S_{\hat{\beta}_{1}}, \quad \hat{\beta}_{1} + t_{\alpha / 2} \cdot S_{\hat{\beta}_{1}} \right]$$

---

## åŒºé—´ä¼°è®¡ï¼šéšæœºå¹²æ‰°é¡¹çš„æ–¹å·®

$$\begin {align} 
\chi^{2} & =(n-2) \frac{\hat{\sigma}^{2}}{\sigma^{2}}
&&\leftarrow \quad \chi^{2} \sim \chi^{2}(n-2)
 \end {align}$$

$$\begin {align} 
\operatorname{Pr}\left(\chi_{\alpha / 2}^{2} \leq \chi^{2} \leq \chi_{\alpha / 2}^{2}\right)=1-\alpha
\end {align}$$

$$\begin {align} 
\operatorname{Pr}\left(\chi_{\alpha / 2}^{2} \leq 
(n-2) \frac{\hat{\sigma}^{2}}{\sigma^{2}} \leq \chi_{1-\alpha / 2}^{2}\right)=1-\alpha
\end {align}$$


$$\begin {align} 
\operatorname{Pr}\left[(n-2) \frac{\hat{\sigma}^{2}}{\chi_{1-\alpha/2}^{2}} \leq \sigma^{2} \leq (n-2) \frac{\hat{\sigma}^{2}}{\chi_{\alpha / 2}^{2}}\right]=1-\alpha
 \end {align}$$
 
å› æ­¤ï¼Œ
$\sigma^2$çš„
$100(1-\alpha)\%$ä¸ºï¼š

$$\left[ (n-2) \frac{\hat{\sigma}^{2}}{\chi_{1-\alpha/2}^{2}}, \quad (n-2) \frac{\hat{\sigma}^{2}}{\chi_{\alpha / 2}^{2}}\right]$$

---

### ï¼ˆæ¡ˆä¾‹ï¼‰ä¸»æ¨¡å‹

æˆ‘ä»¬ç»§ç»­åˆ©ç”¨æ ·æœ¬æ•°æ®å¯¹**æ•™è‚²å’Œå·¥èµ„æ¡ˆä¾‹**è¿›è¡Œåˆ†æã€‚

> **æ•™è‚²å’Œå·¥èµ„æ¡ˆä¾‹**çš„æ€»ä½“å›å½’æ¨¡å‹ï¼ˆPRMï¼‰å¦‚ä¸‹ï¼š

$$\begin{align}
Wage_i & = \beta_1 + \beta_2 Edu_i +u_i \\
Y_i & = \beta_1 + \beta_2 X_i +u_i \\
\end{align}$$

> **æ•™è‚²å’Œå·¥èµ„æ¡ˆä¾‹**çš„æ€»ä½“å›å½’æ¨¡å‹ï¼ˆSRMï¼‰å¦‚ä¸‹ï¼š

$$\begin{align}
\widehat{Wage}_i & = \hat{\beta}_1 + \hat{\beta}_2 Edu_i +e_i \\
\hat{Y}_i & = \hat{\beta}_1 + \hat{\beta}_2 X_i + e_i \\
\end{align}$$

---

### ï¼ˆæ¡ˆä¾‹ï¼‰ç›¸å…³è®¡ç®—é‡


æˆ‘ä»¬ä¹‹å‰å·²ç®—å‡ºâ€œæ•™è‚²ç¨‹åº¦æ¡ˆä¾‹â€ä¸­çš„å¦‚ä¸‹è®¡ç®—é‡ï¼š

- å›å½’ç³»æ•°ï¼š
$\hat{\beta}_1 =$ `r formatC(b1,4, format="f")`ï¼›
$\hat{\beta}_2 =$ `r formatC(b2,4, format="f")`ï¼›
$\hat{\sigma}^2=$ `r formatC(dev,4, format="f")` ã€‚

- å›å½’è¯¯å·®æ–¹å·®ï¼š
$\hat{\sigma}^2=$ `r formatC(dev,4, format="f")`ã€‚


- å›å½’ç³»æ•°çš„æ ·æœ¬æ–¹å·®:
$S^2_{\hat{\beta}_1} = \frac{\sum{X_i^2}}{n} \cdot \frac{\hat{\sigma}^2} {\sum{x_i^2}}=$ `r formatC(dev_b1, 4, format="f")`ï¼›
$S^2_{\hat{\beta}_2} = \frac{\hat{\sigma}^2} {\sum{x_i^2}}=$ `r formatC(dev_b2, 4, format="f")`;

- å›å½’ç³»æ•°çš„æ ·æœ¬æ ‡å‡†å·®:
$S_{\hat{\beta}_1} =$ `r formatC(S_b1, 4, format="f")`ï¼›
$S_{\hat{\beta}_2} =$ `r formatC(S_b2, 4, format="f")`ã€‚


ç»™å®š
$\alpha=0.05,\quad (1-\alpha) 100 \%=95 \%$ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥tåˆ†å¸ƒè¡¨å¾—åˆ°ç†è®ºå‚ç…§å€¼ï¼š
$t_{\alpha / 2}(n-2)=t_{0.05 / 2}(11)=$ `r formatC(t_0.975,4, format="f")`



---

### ï¼ˆæ¡ˆä¾‹ï¼‰å›å½’ç³»æ•°çš„åŒºé—´ä¼°è®¡

ä¸‹é¢æˆ‘ä»¬è¿›ä¸€æ­¥è®¡ç®—å›å½’ç³»æ•°çš„ç½®ä¿¡åŒºé—´ï¼š

é‚£ä¹ˆï¼Œæˆªè·å‚æ•°
$\beta_1$çš„95%ç½®ä¿¡åŒºé—´ä¸ºï¼š

```{r, results= "asis"}
cat(
"$$\\begin{align}",
"\\hat{\\beta}_{1} - t_{\\alpha / 2} \\cdot S_{\\hat{\\beta}_{1}} \\quad \\leq & \\beta_1 \\leq \\quad \\hat{\\beta}_{1} + t_{\\alpha / 2} \\cdot S_{\\hat{\\beta}_{1}} \\\\",
str_c(round(b1, 4), "-", round(t_0.975,4), "\\ast", round(S_b1,4),
      "\\quad \\leq & \\beta_1 \\quad \\leq",
      round(b1, 4), "+", round(t_0.975,4), "\\ast", round(S_b1,4),
      "\\\\"),
str_c(round(b1 - t_0.975*S_b1,4),
      "\\quad \\leq & \\beta_1 \\quad \\leq",
      round(b1 + t_0.975*S_b1, 4), "\\\\"),
"\\end{align}$$",
sep="\n"
)
```

é‚£ä¹ˆï¼Œæ–œç‡å‚æ•°
$\beta_2$çš„95%ç½®ä¿¡åŒºé—´ä¸ºï¼š

```{r, results= "asis"}
cat(
"$$\\begin{align}",
"\\hat{\\beta}_{2} - t_{\\alpha / 2} \\cdot S_{\\hat{\\beta}_{2}} \\quad \\leq & \\beta_2 \\leq \\quad \\hat{\\beta}_{2} + t_{\\alpha / 2} \\cdot S_{\\hat{\\beta}_{2}} \\\\",
str_c(round(b2, 4), "-", round(t_0.975,4), "\\ast", round(S_b2,4),
      "\\quad \\leq & \\beta_2 \\quad \\leq",
      round(b2, 4), "+", round(t_0.975,4), "\\ast", round(S_b2,4),
      "\\\\"),
str_c(round(b2 - t_0.975*S_b2,4),
      "\\quad \\leq & \\beta_2 \\quad \\leq",
      round(b2 + t_0.975*S_b2, 4), "\\\\"),
"\\end{align}$$",
sep="\n"
)
```


 
---

### ï¼ˆæ¡ˆä¾‹ï¼‰éšæœºå¹²æ‰°é¡¹æ–¹å·®çš„åŒºé—´ä¼°è®¡

- ç»™å®š
$\alpha=0.05,\quad (1-\alpha) 100 \%=95 \%$

- æŸ¥å¡æ–¹åˆ†å¸ƒè¡¨å¯çŸ¥ï¼š

    - $\chi^2_{\alpha / 2}(n-2)=\chi^2_{0.05 / 2}(11)=\chi^2_{0.025}(11)=$ `r formatC(chisq_0.025,4, format="f")`

    - $\chi^2_{1-\alpha / 2}(n-2)=\chi^2_{1-0.05 / 2}(11)=\chi^2_{0.975}(11)=$ `r formatC(chisq_0.975,4, format="f")`


ä»¬ä¹‹å‰å·²ç®—å‡ºå›å½’è¯¯å·®æ–¹å·®
$\hat{\sigma}^2=\frac{\sum{e_i^2}}{n-2}=$ `r formatC(dev, 4, format="f")`
ã€‚å› æ­¤å¯ä»¥ç®—å‡º
$\sigma^2$çš„95%ç½®ä¿¡åŒºé—´ä¸ºï¼š


```{r, results="asis"}
cat(
  "$$\\begin {align}\\\\", 
"(n-2) \\frac{\\hat{\\sigma}^{2}}{\\chi_{\\alpha}^{2}} \\leq \\sigma^{2} \\leq(n-2) \\frac{\\hat{\\sigma}^{2}}{\\chi_{1-\\alpha / 2}^{2}}\\\\",
  str_c((n-2), "\\ast \\frac{",round(dev,4), "}{",round(chisq_0.975,4), "} \\leq \\sigma^2 \\leq", (n-2), "\\ast \\frac{",round(dev,4), "}{",round(chisq_0.025,4), "}\\\\"),
  str_c(round((n-2)*dev/chisq_0.975,4), "\\leq \\sigma^2 \\leq",round((n-2)*dev/chisq_0.025,4),"\\\\"),
 "\\end {align}$$",
sep="\n"
)
```

---
layout: false
class: center, middle, duke-softblue,hide_logo
name: hypothesis

# 5.4 å‡è®¾æ£€éªŒ

### ä¸¤ç§æ£€éªŒæ–¹æ³•

### å›å½’ç³»æ•°tæ£€éªŒ

### æ–¹å·®åˆ†è§£ï¼ˆANOVAï¼‰

### æ¨¡å‹æ•´ä½“æ˜¾è‘—æ€§Fæ£€éªŒ

---
layout: true

<div class="my-header-h2"></div>

<div class="watermark1"></div>

<div class="watermark2"></div>

<div class="watermark3"></div>

<div class="my-footer"><span>huhuaping@  &emsp;&emsp; <a href="#chapter"> ç¬¬05ç«  ç›¸å…³å’Œå›å½’åˆ†æ </a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
<a href="#hypothesis"> 5.4 å‡è®¾æ£€éªŒ </a> </span></div> 

---

## å‡è®¾æ£€éªŒï¼šåŸç†å’Œæ€è·¯

**å‡è®¾æ£€éªŒ**ï¼ˆHypothesis Testingï¼‰ï¼šæŸä¸€ç»™å®šçš„è§‚æµ‹æˆ–å‘ç°ä¸æŸå£°ç§°çš„å‡è®¾æ˜¯å¦ç›¸ç¬¦ï¼Ÿè¿›è¡Œç»Ÿè®¡å‡è®¾æ£€éªŒï¼Œå°±æ˜¯è¦åˆ¶å®šä¸€å¥—æ­¥éª¤å’Œè§„åˆ™ï¼Œä»¥ä½¿å†³å®šæ¥å—æˆ–æ‹’ç»ä¸€ä¸ªè™šæ‹Ÿå‡è®¾ï¼ˆåŸå‡è®¾ï¼‰ã€‚

.pull-left[
**è™šæ‹Ÿå‡è®¾**(null hypothesis) â€”â€”
$H_0$

- æŒ‡å®šæˆ–å£°ç§°çš„å‡è®¾ï¼Œå¦‚
$H_0:  \beta_2 = 0$

- å®ƒæ˜¯ä¸€ä¸ªç­‰å¾…è¢«æŒ‘æˆ˜çš„.red[**â€œé¶å­â€**]ï¼.red[**â€œç¨»è‰äººâ€**]ï¼
]

.pull-right[
**å¤‡æ‹©å‡è®¾**(alternative hypothesis) â€”â€”
$H_1$

- ç®€å•çš„ï¼ˆsimpleï¼‰å¤‡æ‹©å‡è®¾ï¼Œå¦‚
$H_1:  \beta_2 = 1.5$

- å¤åˆçš„ï¼ˆcompositeï¼‰å¤‡æ‹©å‡è®¾ï¼Œå¦‚
$H_1:  \beta_2 \neq 1.5$
]

å‡è®¾æ£€éªŒçš„å…·ä½“æ–¹æ³•ï¼š

- **ç½®ä¿¡åŒºé—´æ£€éªŒ**ï¼ˆconfidence intervalï¼‰

- **æ˜¾è‘—æ€§æ£€éªŒ**ï¼ˆtest of significanceï¼‰

--

**è¯¾å ‚è®¨è®º**ï¼šå‚æ•°çš„ç½®ä¿¡åŒºé—´æ£€éªŒå’Œæ˜¾è‘—æ€§æ£€éªŒæœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»ï¼Ÿ

---

## å‡è®¾æ£€éªŒï¼šç½®ä¿¡åŒºé—´æ£€éªŒæ³•ï¼ˆåŒä¾§æ£€éªŒï¼‰

**åŒä¾§æˆ–åŒå°¾æ£€éªŒ**ï¼ˆTwo-sided or Two-Tail Testï¼‰

$$H_0: \beta_2 =0; \quad H_1: \beta_2 \neq 0$$

- å‡è®¾æ£€éªŒç›®çš„ï¼šä¼°è®¡çš„æ˜¯å¦ä¸ä¸Šè¿°ç›¸å®¹?

- å†³ç­–è§„åˆ™ï¼š

    - æ„é€ ä¸€ä¸ª
    $\beta_2$çš„
    $100(1-\alpha)\%$ç½®ä¿¡åŒºé—´ã€‚

    - å¦‚æœ
    $\beta_2$åœ¨
    $H_0$å‡è®¾ä¸‹è½å…¥æ­¤åŒºé—´ï¼Œå°±ä¸æ‹’ç»
    $H_0$ã€‚
    
    - å¦‚æœå®ƒè½åœ¨æ­¤åŒºé—´ä¹‹å¤–ï¼Œå°±è¦æ‹’ç»
    $H_0$ã€‚

---

### ï¼ˆç¤ºä¾‹ï¼‰æ•™è‚²ç¨‹åº¦ä¸æ—¶å‡å·¥èµ„å›å½’

å¯¹äº**æ–œç‡å‚æ•°**
$\beta_2$çš„ç½®ä¿¡åŒºé—´æ£€éªŒæ³•ã€‚

- **æ­¥éª¤1**ï¼šç»™å‡ºæ¨¡å‹ï¼Œå¹¶æå‡ºå‡è®¾ï¼š

$$Y_i = \beta_1 + \beta_2X_i +u_i$$

$$H_0: \beta_2 =0.5; \quad H_1: \beta_2 \neq 0.5$$

- **æ­¥éª¤2**ï¼šç»™å®š
$\alpha=0.05,\quad (1-\alpha) 100 \%=95 \%$

- **æ­¥éª¤3**ï¼šæ ¹æ®å‰è¿°è®¡ç®—ç»“æœï¼Œè®¡ç®—æ–œç‡å‚æ•°
$\beta_2$çš„95%ç½®ä¿¡åŒºé—´ä¸ºï¼š

```{r, results= "asis"}
cat(
"$$\\begin{align}",
"\\hat{\\beta}_{2} - t_{\\alpha / 2} \\cdot S_{\\hat{\\beta}_{2}} \\quad \\leq & \\beta_2 \\leq \\quad \\hat{\\beta}_{2} + t_{\\alpha / 2} \\cdot S_{\\hat{\\beta}_{2}} \\\\",
str_c(round(b2 - t_0.975*S_b2,4),
      "\\quad \\leq & \\beta_2 \\quad \\leq",
      round(b2 + t_0.975*S_b2, 4), "\\\\"),
"\\end{align}$$",
sep="\n"
)
```

- **æ­¥éª¤4**ï¼šé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¯¹æ–œç‡å‚æ•°
$\beta_2$åšå‡ºå¦‚ä¸‹æ£€éªŒåˆ¤æ–­ï¼šæ‹’ç»åŸå‡è®¾
$H_0$ï¼Œæ¥å—
$H_1$ã€‚è®¤ä¸ºï¼Œé•¿æœŸæ¥çœ‹å¾ˆå¤šä¸ªåŒºé—´ `r str_c("[",round(b2 - t_0.975*S_b2,4),",",round(b2 + t_0.975*S_b2, 4), "]")` æœ‰95%çš„å¯èƒ½æ€§ä¸åŒ…å«0.5ï¼ˆ
$\beta_2 \neq 0.5$ï¼‰ã€‚

---

### ï¼ˆç¤ºä¾‹ï¼‰æ•™è‚²ç¨‹åº¦ä¸æ—¶å‡å·¥èµ„å›å½’

å¯¹äº**æˆªè·å‚æ•°**
$\beta_1$çš„ç½®ä¿¡åŒºé—´æ£€éªŒæ³•ã€‚

- **æ­¥éª¤1**ï¼šç»™å‡ºæ¨¡å‹ï¼Œå¹¶æå‡ºå‡è®¾ï¼š

$$Y_i = \beta_1 + \beta_2X_i +u_i$$

$$H_0: \beta_1 =0; \quad H_1: \beta_1 \neq 0$$

- **æ­¥éª¤2**ï¼šç»™å®š
$\alpha=0.05,\quad (1-\alpha) 100 \%=95 \%$

- **æ­¥éª¤3**ï¼šæ ¹æ®å‰è¿°è®¡ç®—ç»“æœï¼Œè®¡ç®—æˆªè·å‚æ•°
$\beta_1$çš„95%ç½®ä¿¡åŒºé—´ä¸ºï¼š

```{r, results= "asis"}
cat(
"$$\\begin{align}",
"\\hat{\\beta}_{1} - t_{\\alpha / 2} \\cdot S_{\\hat{\\beta}_{1}} \\quad \\leq & \\beta_1 \\leq \\quad \\hat{\\beta}_{1} + t_{\\alpha / 2} \\cdot S_{\\hat{\\beta}_{1}} \\\\",
str_c(round(b1 - t_0.975*S_b1,4),
      "\\quad \\leq & \\beta_1 \\quad \\leq",
      round(b1 + t_0.975*S_b1, 4), "\\\\"),
"\\end{align}$$",
sep="\n"
)
```

- **æ­¥éª¤4**ï¼šé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¯¹æˆªè·å‚æ•°
$\beta_1$åšå‡ºå¦‚ä¸‹æ£€éªŒåˆ¤æ–­ï¼š

    - ä¸èƒ½æ‹’ç»åŸå‡è®¾
    $H_0$ï¼Œæš‚æ—¶æ¥å—
    $H_0$ã€‚è®¤ä¸ºï¼Œé•¿æœŸæ¥çœ‹å¾ˆå¤šä¸ªåŒºé—´`r str_c("[",round(b1 - t_0.975*S_b1,4),",",round(b1 + t_0.975*S_b1, 4), "]")` æœ‰95%çš„å¯èƒ½æ€§åŒ…å«0ï¼ˆ
    $\beta_1=0$ï¼‰ã€‚

---

## å‡è®¾æ£€éªŒï¼šæ˜¾è‘—æ€§æ£€éªŒæ³•

**æ˜¾è‘—æ€§æ£€éªŒæ–¹æ³•**( test-of-significance approach)ï¼šæ˜¯ä¸€ç§ç”¨æ ·æœ¬ç»“æœæ¥è¯å®
$H_0$çœŸä¼ªçš„æ£€éªŒç¨‹åºã€‚

**å…³é”®æ€è·¯**ï¼š

- æ‰¾åˆ°ä¸€ä¸ªé€‚åˆçš„æ£€éªŒç»Ÿè®¡é‡(test statistic) ã€‚ä¾‹å¦‚tç»Ÿè®¡é‡
$\chi^2$ç»Ÿè®¡é‡ã€Fç»Ÿè®¡é‡ç­‰ã€‚

- çŸ¥é“è¯¥ç»Ÿè®¡é‡åœ¨
$H_0$ä¸‹çš„æŠ½æ ·åˆ†å¸ƒ(pdf)ã€‚å¾€å¾€ä¸å¾…æ£€éªŒå‚æ•°æœ‰å…³ç³»ã€‚

- è®¡ç®—æ ·æœ¬ç»Ÿè®¡é‡çš„å€¼ã€‚ä¹Ÿå³èƒ½ç”¨æ ·æœ¬æ•°æ®å¿«é€Ÿè®¡ç®—å‡ºæ¥ï¼Œä¾‹å¦‚
$t^{\ast}_{\hat{\beta_2}}=\frac{\hat{\beta}_2}{S_{\hat{\beta}_2}}$ã€‚


- æŸ¥è¡¨æ‰¾å‡ºç»™å®šæ˜¾è‘—æ€§æ°´å¹³
$\alpha$ä¸‹çš„**ç†è®ºç»Ÿè®¡é‡**çš„.red[**ä¸´ç•Œå€¼**]ã€‚ä¾‹å¦‚ $t_{1-\alpha/2}(n-2)=t_{0.975}(11)=$
`r formatC(t_0.975, 4, format="f")`

- æ¯”è¾ƒæ ·æœ¬ç»Ÿè®¡é‡å€¼å’Œè¯¥ä¸´ç•Œå€¼çš„å¤§å°ã€‚ä¾‹å¦‚ï¼Œæ¯”è¾ƒ
$t^{\ast}_{\hat{\beta_2}}$ä¸
$t_{0.975}(11)$


- åšå‡ºæ‹’ç»è¿˜æ˜¯æ¥å—
$H_0$çš„åˆ¤æ–­ã€‚

---

## å‡è®¾æ£€éªŒï¼šæˆªè·å‚æ•°çš„tæ£€éªŒ


å¯¹äºæˆªè·å‚æ•°
$\beta_1$çš„æ˜¾è‘—æ€§æ£€éªŒï¼ˆtæ£€éªŒï¼‰ã€‚

- **æ­¥éª¤1**ï¼šç»™å‡ºæ¨¡å‹ï¼Œå¹¶æå‡ºå‡è®¾ï¼š

$$Y_i = \beta_1 + \beta_2X_i +u_i$$

$$H_0: \beta_1 =0; \quad H_1: \beta_1 \neq 0$$

- **æ­¥éª¤2**ï¼šæ„é€ åˆé€‚çš„æ£€éªŒç»Ÿè®¡é‡

$$\begin{align} 
T&=\frac{\hat{\beta}_{1}-\beta_{1}}{S_{\hat{\beta}_{1}}}
&& \leftarrow T \sim t(n-2)
 \end{align}$$

---

## å‡è®¾æ£€éªŒï¼šæˆªè·å‚æ•°çš„tæ£€éªŒ

- **æ­¥éª¤3**ï¼šåŸºäºåŸå‡è®¾
$H_0$è®¡ç®—å‡ºæ ·æœ¬ç»Ÿè®¡é‡ã€‚

```{r, results="asis"}
cat(
  "$$\\begin{align} \\\\", 
"T&=\\frac{\\hat{\\beta}_{1}-\\beta_{1}}{S_{\\hat{\\beta}_{1}}} && \\leftarrow T \\sim t(n-2) \\\\",
"t^{\\ast}_{\\hat{\\beta}_1}&=\\frac{\\hat{\\beta}_{1}}{S_{\\hat{\\beta}_{1}}} && \\leftarrow H_0: \\beta_1 = 0 \\\\",
str_c("t^{\\ast}_{\\hat{\\beta}_1}&= \\frac{",round(b1,4), "}{", round(S_b1,4),"}=",round(b1/S_b1,4)),
 "\\end{align}$$",
  sep="\n"
)
```


- **æ­¥éª¤4**ï¼šç»™å®šæ˜¾è‘—æ€§æ°´å¹³
$\alpha=0.05$ä¸‹ï¼ŒæŸ¥å‡ºç»Ÿè®¡é‡çš„**ç†è®ºåˆ†å¸ƒå€¼**ã€‚

> 
$t_{1-\alpha/2}(n-2)=t_{1-0.05/2}(13-2)=t_{0.975}(11)=$
`r formatC(qt(0.975, n-2), 4, format="f")`

---

## å‡è®¾æ£€éªŒï¼šæˆªè·å‚æ•°çš„tæ£€éªŒ

- **æ­¥éª¤5**ï¼šå¾—åˆ°æ˜¾è‘—æ€§æ£€éªŒçš„åˆ¤æ–­ç»“è®ºã€‚

    - è‹¥
    $|t^{\ast}_{\hat{\beta}_1}| > t_{1-\alpha/2}(n-2)$ï¼Œåˆ™
    $\beta_1$çš„tæ£€éªŒç»“æœ**æ˜¾è‘—**ã€‚æ¢è¨€ä¹‹ï¼Œåœ¨æ˜¾è‘—æ€§æ°´å¹³
    $\alpha=0.05$ä¸‹ï¼Œåº”**æ˜¾è‘—**åœ°æ‹’ç»åŸå‡è®¾
    $H_0$ï¼Œæ¥å—å¤‡æ‹©å‡è®¾
    $H_1$ï¼Œè®¤ä¸ºæˆªè·å‚æ•°
    $\beta_1 \neq 0$ã€‚
    
    - è‹¥
    $|t^{\ast}_{\hat{\beta}_1}| < t_{1-\alpha/2}(n-2)$ï¼Œåˆ™
    $\beta_1$çš„tæ£€éªŒç»“æœ**ä¸æ˜¾è‘—**ã€‚æ¢è¨€ä¹‹ï¼Œåœ¨æ˜¾è‘—æ€§æ°´å¹³
    $\alpha=0.05$ä¸‹ï¼Œä¸èƒ½**æ˜¾è‘—**åœ°æ‹’ç»åŸå‡è®¾
    $H_0$ï¼Œåªèƒ½æš‚æ—¶æ¥å—åŸå‡è®¾
    $H_0$ï¼Œè®¤ä¸ºæˆªè·å‚æ•°
    $\beta_1 = 0$ã€‚

æœ¬ä¾‹ä¸­ï¼Œ
 $|t^{\ast}_{\hat{\beta}_1}|=$
`r formatC(abs(t_b1), 4, format="f")` .red[**å°äº**]
$t_{0.975}(11)=$
`r formatC(qt(0.975, n-2), 4, format="f")`ã€‚å› æ­¤ï¼Œè®¤ä¸º
$\beta_1$çš„tæ£€éªŒç»“æœ**ä¸æ˜¾è‘—**ã€‚

æ¢è¨€ä¹‹ï¼Œåœ¨æ˜¾è‘—æ€§æ°´å¹³
$\alpha=0.05$ä¸‹ï¼Œä¸èƒ½**æ˜¾è‘—**åœ°æ‹’ç»åŸå‡è®¾
$H_0$ï¼Œåªèƒ½æš‚æ—¶æ¥å—åŸå‡è®¾
$H_0$ï¼Œè®¤ä¸ºæˆªè·å‚æ•°
$\beta_1 = 0$ã€‚

---

## å‡è®¾æ£€éªŒï¼šæ–œç‡å‚æ•°çš„tæ£€éªŒ

å¯¹äºæ–œç‡å‚æ•°
$\beta_2$çš„æ˜¾è‘—æ€§æ£€éªŒï¼ˆtæ£€éªŒï¼‰ã€‚

- **æ­¥éª¤1**ï¼šç»™å‡ºæ¨¡å‹ï¼Œå¹¶æå‡ºå‡è®¾ï¼š

$$Y_i = \beta_1 + \beta_2X_i +u_i$$

$$H_0: \beta_2 =0; \quad H_1: \beta_2 \neq 0$$

- **æ­¥éª¤2**ï¼šæ„é€ åˆé€‚çš„æ£€éªŒç»Ÿè®¡é‡

$$\begin{align} 
T&=\frac{\hat{\beta}_{2}-\beta_{2}}{{S_{\beta_{2}}}}
&& \leftarrow T \sim t(n-2)
 \end{align}$$

---

## å‡è®¾æ£€éªŒï¼šæ–œç‡å‚æ•°çš„tæ£€éªŒ

- **æ­¥éª¤3**ï¼šåŸºäºåŸå‡è®¾
$H_0$è®¡ç®—å‡ºæ ·æœ¬ç»Ÿè®¡é‡ã€‚

```{r, results="asis"}
cat(
  "$$\\begin{align} \\\\", 
"T&=\\frac{\\hat{\\beta}_{2}-\\beta_{2}}{S_{\\hat{\\beta}_{2}}} && \\leftarrow T \\sim t(n-2) \\\\",
"t^{\\ast}_{\\hat{\\beta}_2}&=\\frac{\\hat{\\beta}_{2}}{S_{\\hat{\\beta}_{2}}} && \\leftarrow H_0: \\beta_2 = 0 \\\\",
str_c("t^{\\ast}_{\\hat{\\beta}_2}&= \\frac{",round(b2,4), "}{", round(S_b2,4),"}=",round(b2/S_b2,4)),
 "\\end{align}$$",
  sep="\n"
)
```


- **æ­¥éª¤4**ï¼šç»™å®šæ˜¾è‘—æ€§æ°´å¹³
$\alpha=0.05$ä¸‹ï¼ŒæŸ¥å‡ºç»Ÿè®¡é‡çš„**ç†è®ºåˆ†å¸ƒå€¼**ã€‚

> 
$t_{1-\alpha/2}(n-2)=t_{1-0.05/2}(13-2)=t_{0.975}(11)=$
`r formatC(qt(0.975, n-2), 4, format="f")`

---

## å‡è®¾æ£€éªŒï¼šæ–œç‡å‚æ•°çš„tæ£€éªŒ

- **æ­¥éª¤5**ï¼šå¾—åˆ°æ˜¾è‘—æ€§æ£€éªŒçš„åˆ¤æ–­ç»“è®ºã€‚

    - è‹¥
    $|t^{\ast}_{\hat{\beta}_2}| > t_{1-\alpha/2}(n-2)$ï¼Œåˆ™
    $\beta_2$çš„tæ£€éªŒç»“æœ**æ˜¾è‘—**ã€‚æ¢è¨€ä¹‹ï¼Œåœ¨æ˜¾è‘—æ€§æ°´å¹³
    $\alpha=0.05$ä¸‹ï¼Œåº”**æ˜¾è‘—**åœ°æ‹’ç»åŸå‡è®¾
    $H_0$ï¼Œæ¥å—å¤‡æ‹©å‡è®¾
    $H_1$ï¼Œè®¤ä¸ºæ–œç‡å‚æ•°
    $\beta_2 \neq 0$ã€‚
    
    - è‹¥
    $|t^{\ast}_{\hat{\beta}_2}| < t_{1-\alpha/2}(n-2)$ï¼Œåˆ™
    $\beta_2$çš„tæ£€éªŒç»“æœ**ä¸æ˜¾è‘—**ã€‚æ¢è¨€ä¹‹ï¼Œåœ¨æ˜¾è‘—æ€§æ°´å¹³
    $\alpha=0.05$ä¸‹ï¼Œä¸èƒ½**æ˜¾è‘—**åœ°æ‹’ç»åŸå‡è®¾
    $H_0$ï¼Œåªèƒ½æš‚æ—¶æ¥å—åŸå‡è®¾
    $H_0$ï¼Œè®¤ä¸ºæ–œç‡å‚æ•°
    $\beta_2 = 0$ã€‚

æœ¬ä¾‹ä¸­ï¼Œ
 $|t^{\ast}_{\hat{\beta}_2}|=$
`r formatC(abs(t_b2), 4, format="f")` .red[**å¤§äº**]
$t_{0.975}(11)=$
`r formatC(qt(0.975, n-2), 4, format="f")`ã€‚å› æ­¤ï¼Œè®¤ä¸º
$\beta_2$çš„tæ£€éªŒç»“æœ**æ˜¾è‘—**ã€‚

æ¢è¨€ä¹‹ï¼Œåœ¨æ˜¾è‘—æ€§æ°´å¹³
$\alpha=0.05$ä¸‹ï¼Œåº”**æ˜¾è‘—**åœ°æ‹’ç»åŸå‡è®¾
$H_0$ï¼Œæ¥å—å¤‡æ‹©å‡è®¾
$H_1$ï¼Œè®¤ä¸ºæ–œç‡å‚æ•°
$\beta_2 \neq 0$ã€‚

---

## å‡è®¾æ£€éªŒï¼šæ˜¾è‘—æ€§æ°´å¹³VSæ˜¾è‘—æ€§æ¦‚ç‡

æˆ‘ä»¬å¯ä»¥å›é¡¾çŠ¯é”™è¯¯ç±»å‹ï¼š

- ç¬¬Iç±»é”™è¯¯ï¼šå¼ƒçœŸé”™è¯¯
$\alpha = P(Z > Z_0|H_0=True)$

- ç¬¬IIç±»é”™è¯¯ï¼šå–ä¼ªé”™è¯¯
$\beta = P(Z \leq Z_0|H_1=True)$

- [ç»™å®šæ ·æœ¬å®¹é‡æ—¶]å¦‚æœæˆ‘ä»¬è¦å‡å°‘çŠ¯ç¬¬I ç±»é”™è¯¯ï¼Œ ç¬¬IIç±»é”™è¯¯å°±è¦å¢åŠ ï¼›åä¹‹äº¦ç„¶ã€‚

ä¸ºä»€ä¹ˆé€‰æ‹©æ˜¾è‘—æ€§æ°´å¹³
$\alpha$é€šå¸¸å›ºå®šåœ¨0.01ã€0.05ã€0.1æ°´å¹³ä¸Šï¼Ÿ

- çº¦å®šè€Œå·²ï¼Œå¹¶éç¥åœ£ä¸å¯æ”¹å˜ï¼

- å¦‚ä½•æ”¹å˜ï¼Ÿï¼Ÿ

---

## å‡è®¾æ£€éªŒï¼šæ˜¾è‘—æ€§æ°´å¹³VSæ˜¾è‘—æ€§æ¦‚ç‡

ç²¾ç¡®çš„æ˜¾è‘—æ€§æ¦‚ç‡æ°´å¹³på€¼ï¼š

- å¯¹ç»™å®šçš„æ ·æœ¬ç®—å‡ºä¸€ä¸ªæ£€éªŒç»Ÿè®¡é‡(å¦‚tç»Ÿè®¡é‡)ï¼ŒæŸ¥åˆ°ä¸ä¹‹å¯¹åº”çš„æ¦‚ç‡ï¼špå€¼(p value)æˆ–æ¦‚ç‡å€¼(probability value)

- ä¸çº¦å®š
$\alpha$ï¼Œè€Œæ˜¯ç›´æ¥æ±‚å‡ºçŠ¯é”™è¯¯æ¦‚ç‡på€¼ï¼Œç”±è¯»è€…è‡ªå·±å»è¯„åˆ¤çŠ¯é”™è¯¯çš„å¯èƒ½æ€§å’Œä»£ä»·ï¼ï¼å› äººè€Œå¼‚ï¼ï¼



---

## å‡è®¾æ£€éªŒï¼šå®é™…æ“ä½œä¸­çš„è‹¥å¹²é—®é¢˜

å…³äº**ç»Ÿè®¡æ˜¾è‘—æ€§**ä¸**å®é™…æ˜¾è‘—æ€§**ã€‚

- ä¸èƒ½ä¸€å‘³è¿½æ±‚ç»Ÿè®¡æ˜¾è‘—æ€§ï¼Œæœ‰æ—¶å€™è¿˜éœ€è¦è€ƒè™‘â€œå®é™…æ˜¾è‘—æ€§â€çš„ç°å®æ„ä¹‰ã€‚

- ä¸¾ä¾‹è¯´æ˜ï¼š

    - è¾¹é™…æ¶ˆè´¹å€¾å‘(MPC)æ˜¯æŒ‡GDPæ¯å¢åŠ 1ç¾å…ƒå¸¦æ¥æ¶ˆè´¹çš„å¢åŠ æ•°ï¼›å®è§‚ç†è®ºè¡¨æ˜æ”¶å…¥ä¹˜æ•°ä¸ºï¼š1/(1-MPC)ã€‚
    
    - è‹¥MPCçš„95%ç½®ä¿¡åŒºé—´ä¸º(0.7129,0.7306)ï¼Œå½“æ ·æœ¬è¡¨æ˜MPCçš„ä¼°è®¡å€¼ä¸º
    $\widehat{MPC}=0.74$ï¼ˆæ­¤æ—¶ï¼Œå³ä¹˜æ•°ä¸º3.84ï¼‰ï¼Œä½ æ€æ ·æŠ‰æ‹©ï¼ï¼ï¼
    

å…³äº**ç½®ä¿¡åŒºé—´æ–¹æ³•**å’Œ**æ˜¾è‘—æ€§æ£€éªŒæ–¹æ³•**çš„é€‰æ‹©ã€‚

- ä¸€èˆ¬æ¥è¯´ï¼Œç½®ä¿¡åŒºé—´æ–¹æ³•ä¼˜äºæ˜¾è‘—æ€§æ£€éªŒæ–¹æ³•ï¼

- ä¾‹å¦‚ï¼šå‡è®¾MPC
$H_0: \beta_2 =0$æ˜¾ç„¶è’è°¬çš„ï¼


---

## æ–¹å·®åˆ†è§£ï¼ˆANOVAï¼‰ï¼šYå˜å¼‚çš„åˆ†è§£

```{r, out.width="65%"}
include_graphics("../pic/extra/chpt2-1-PRL-SRL.png")
```


$$\begin{alignedat}{2}
&&(Y_i - \bar{Y}) &&= (\hat{Y}_i - \bar{Y}) &&+ (Y_i - \hat{Y}_i ) \\
&&y_i &&= \hat{y}_i &&+ e_i 
\end{alignedat}$$

---

## æ–¹å·®åˆ†è§£ï¼ˆANOVAï¼‰ï¼šå¹³æ–¹å’Œåˆ†è§£

$$\begin{alignedat}{2}
&&(Y_i - \bar{Y}) &&= (\hat{Y}_i - \bar{Y}) &&+ (Y_i - \hat{Y}_i ) \\
&&y_i &&= \hat{y}_i &&+ e_i \\
&&\sum{y_i^2} &&= \sum{\hat{y}_i^2} &&+ \sum{e_i^2} \\
&&TSS &&=ESS &&+RSS
\end{alignedat}$$

- å…¶ä¸­ï¼š
$TSS$è¡¨ç¤º**æ€»ç¦»å·®å¹³æ–¹å’Œ**;
$ESS$è¡¨ç¤º**å›å½’å¹³æ–¹å’Œ**;
$RSS$è¡¨ç¤º**æ®‹å·®å·®å¹³æ–¹å’Œ**


---

### ï¼ˆé™„å½•ï¼‰ï¼šå¹³æ–¹å’Œåˆ†è§£è¯æ˜è¿‡ç¨‹

$$\begin{align}
\sum{y_i^2} &= \sum{(\hat{y}_i e_i)^2} \\
&= \sum{(\hat{y}_i^2 +2\hat{y}_ie_i +e_i^2)}\\
&= \sum{\hat{y}_i^2 } +2\sum{\hat{y}_ie_i} + \sum{e_i^2}\\
&= \sum{\hat{y}_i^2 } +2\sum{\left( \hat{(\beta_2}x_i)e_i \right)} + \sum{e_i^2}\\
&= \sum{\hat{y}_i^2 } +2\hat{\beta_2}\sum{\left( x_ie_i \right)} + \sum{e_i^2} && \leftarrow \left[ \sum{x_ie_i} =0 \right]\\ 
&= \sum{\hat{y}_i^2} + \sum{e_i^2}
\end{align}$$

---

## æ–¹å·®åˆ†è§£ï¼ˆANOVAï¼‰ï¼šåŒå˜é‡åˆ†è§£è¡¨

```{r}
anova_tab <- tribble(
  ~`å˜å¼‚æ¥æº`, ~`å¹³æ–¹å’Œç¬¦å·SS`, ~`å¹³æ–¹å’Œè®¡ç®—å…¬å¼`, ~`è‡ªç”±åº¦df`,  ~`å‡æ–¹å’Œç¬¦å·MSS`, ~`å‡æ–¹å’Œè®¡ç®—å…¬å¼`, 
  "å›å½’å¹³æ–¹å’Œ", "ESS","\\(\\sum{(\\hat{Y}_i-\\bar{Y}_i)^2}=\\sum{\\hat{y}_i^2}\\)","1", "\\(MSS_{ESS}\\)", "\\(ESS/df_{ESS}=\\hat{\\beta}_2^2\\sum{x_i^2}\\)",
  "æ®‹å·®å¹³æ–¹å’Œ", "RSS","\\(\\sum{(Y_i-\\hat{Y}_i)^2}=\\sum{e_i^2}\\)","n-2", "\\(MSS_{RSS}\\)", "\\(RSS/df_{RSS}=\\frac{\\sum{e_i^2}}{n-2}\\)",
  "æ€»å¹³æ–¹å’Œ", "TSS","\\(\\sum{(Y_i-\\bar{Y}_i)^2}=\\sum{y_i^2}\\)","n-1", "\\(MSS_{TSS}\\)", "\\(TSS/df_{TSS}=\\frac{\\sum{y_i^2}}{n-1}\\)"
)
```

```{r}
kable(anova_tab, align ="c") %>%
 kable_styling(full_width = T, font_size =20)
```


---

## æ¨¡å‹æ•´ä½“æ˜¾è‘—æ€§æ£€éªŒï¼šFæ£€éªŒ

- **æ­¥éª¤1**ï¼šç»™å‡ºæ¨¡å‹ï¼Œå¹¶æå‡ºå‡è®¾ï¼š

ä¸€å…ƒå›å½’æ¨¡å‹ä¸‹ï¼š

$$Y_i = \beta_1 + \beta_2X_i +u_i$$

$$H_0: \beta_2 =0; \quad H_1: \beta_2 \neq 0$$

å¤šå…ƒå›å½’æ¨¡å‹ä¸‹ï¼š

$$Y_i = \beta_1 + \beta_2X_{2i} + \beta_3X_{3i}+ \cdots + \beta_kX_{ki}+ u_i$$

$$H_0: \beta_2 = \beta_3 =\cdots= \beta_k= 0; \quad H_1: \text{not all} \quad \beta_j = 0, \quad j \in 2, 3, \cdots, k$$

---

## æ¨¡å‹æ•´ä½“æ˜¾è‘—æ€§æ£€éªŒï¼šFæ£€éªŒ

- **æ­¥éª¤2**ï¼šæ„é€ åˆé€‚çš„æ£€éªŒç»Ÿè®¡é‡

$$\begin {align} 
\chi^2_1 &= \left( \frac{\hat{\beta}_{2}-\beta_{2} }{\sigma_{\hat{\beta_2}}}\right)^2
= \left( \frac{\hat{\beta}_{2}-\beta_{2} }{\sqrt{\sigma^{2}/\sum x_{i}^{2}}}\right)^2=\frac{\left(\hat{\beta}_{2}-\beta_{2}\right)^{2} \sum x_{i}^{2}}{\sigma^{2}} &&\leftarrow \chi^2_1 \sim \chi^2(1)
 \end {align}$$

$$\begin {align} 
\chi^2_{2}&=(n-2) \frac{\hat{\sigma}^{2}}{\sigma^{2}}=\frac{\sum e_{i}^{2}}{\sigma^{2}} && \leftarrow \chi^2_2 \sim \chi^2(n-2)
 \end {align}$$

$$\begin {align} 
F &= \frac{\chi^2_1/1}{\chi^2_2/n-2} 
= \left( \frac{\left(\hat{\beta}_{2}-\beta_{2}\right)^{2} \sum x_{i}^{2}}{\sigma^{2}} \right ) / \left( \frac{\sum e_{i}^{2}}{(n-2)\sigma^{2}} \right) 
=\frac{\left(\hat{\beta}_{2}-\beta_{2}\right)^{2} \sum x_{i}^{2}}{\sum e_{i}^{2} /(n-2)}\\
F & \sim F(1,n-2)
\end {align}$$

---

## æ¨¡å‹æ•´ä½“æ˜¾è‘—æ€§æ£€éªŒï¼šFæ£€éªŒ

- **æ­¥éª¤3**ï¼šåŸºäºåŸå‡è®¾
$H_0$è®¡ç®—å‡ºæ ·æœ¬ç»Ÿè®¡é‡ã€‚

$$\begin {align} 
F^{\ast} &= \frac{\left(\hat{\beta}_{2}-\beta_{2}\right)^{2} \sum x_{i}^{2}}{\sum e_{i}^{2} /(n-2)} &&\leftarrow H_0: \beta_2=0 \\
& = \frac{\hat{\beta}_{2}^{2} \sum x_{i}^{2}}{\sum e_{i}^{2} /(n-2)}\\
& = \frac{ESS / df_{ESS}}{RSS / df_{RSS}}
=\frac{MSS_{ESS}}{MSS_{RSS}}
=\frac{\hat{\beta}_{2}^{2} \sum x_{i}^{2}}{\hat{\sigma}^{2}}
\end {align}$$


---

## æ¨¡å‹æ•´ä½“æ˜¾è‘—æ€§æ£€éªŒï¼šFæ£€éªŒ

- **æ­¥éª¤4**ï¼šç»™å®šæ˜¾è‘—æ€§æ°´å¹³
$\alpha=0.05$ä¸‹ï¼ŒæŸ¥å‡ºç»Ÿè®¡é‡çš„**ç†è®ºåˆ†å¸ƒå€¼**ã€‚
$F_{1-\alpha}(1,n-2)$

- **æ­¥éª¤5**ï¼šå¾—åˆ°æ˜¾è‘—æ€§æ£€éªŒçš„åˆ¤æ–­ç»“è®ºã€‚

    - è‹¥
    $F^{\ast} > F_{1-\alpha}(1,n-2)$ï¼Œåˆ™
    æ¨¡å‹æ•´ä½“æ˜¾è‘—æ€§çš„Fæ£€éªŒç»“æœ**æ˜¾è‘—**ã€‚æ¢è¨€ä¹‹ï¼Œåœ¨æ˜¾è‘—æ€§æ°´å¹³
    $\alpha=0.05$ä¸‹ï¼Œåº”**æ˜¾è‘—**åœ°æ‹’ç»åŸå‡è®¾
    $H_0$ï¼Œæ¥å—å¤‡æ‹©å‡è®¾
    $H_1$ï¼Œè®¤ä¸ºæ–œç‡å‚æ•°
    $\beta_2 \neq 0$ã€‚
    
    - è‹¥
    $F^{\ast} < F_{1-\alpha}(1,n-2)$ï¼Œåˆ™
    æ¨¡å‹æ•´ä½“æ˜¾è‘—æ€§çš„Fæ£€éªŒç»“æœ**ä¸æ˜¾è‘—**ã€‚æ¢è¨€ä¹‹ï¼Œåœ¨æ˜¾è‘—æ€§æ°´å¹³
    $\alpha=0.05$ä¸‹ï¼Œä¸èƒ½**æ˜¾è‘—**åœ°æ‹’ç»åŸå‡è®¾
    $H_0$ï¼Œåªèƒ½æš‚æ—¶æ¥å—åŸå‡è®¾
    $H_0$ï¼Œè®¤ä¸ºæ–œç‡å‚æ•°
    $\beta_2 = 0$ã€‚

---

## æ¨¡å‹æ•´ä½“æ˜¾è‘—æ€§æ£€éªŒï¼šæ¯”è¾ƒ

Fæ£€éªŒä¸tæ£€éªŒçš„**è”ç³»**ï¼š

- åœ¨ä¸€å…ƒå›å½’æ¨¡å‹ä¸­ï¼Œtæ£€éªŒä¸Fæ£€éªŒçš„ç»“è®ºæ€»æ˜¯ä¸€è‡´çš„ã€‚

- å¯¹äºæ£€éªŒæ–œç‡å‚æ•°
$\beta_2$çš„æ˜¾è‘—æ€§ï¼Œä¸¤è€…å¯ç›¸äº’æ›¿ä»£ï¼åœ¨ä¸€å…ƒå›å½’åˆ†æä¸­ï¼Œè‹¥å‡è®¾
$H_0:\beta_2=0$ï¼Œåˆ™
$F^{\ast} \simeq (t^{\ast})^2$

Fæ£€éªŒä¸tæ£€éªŒçš„**ä¸åŒ**ï¼š

- æ£€éªŒç›®çš„ä¸åŒã€‚Fæ£€éªŒæ˜¯æ£€éªŒæ¨¡å‹çš„æ•´ä½“æ˜¾è‘—æ€§ï¼›tæ£€éªŒæ˜¯æ£€éªŒå„ä¸ªå›å½’å‚æ•°çš„æ˜¾è‘—æ€§ã€‚

- å‡è®¾çš„æå‡ºä¸åŒï¼š
    
    - Fæ£€éªŒï¼šæ–œç‡ç³»æ•°è”åˆå‡è®¾
    $H_0: \beta_2 =0; \quad H_1: \beta_2 \neq 0$
    
    - tæ£€éªŒï¼šå›å½’ç³»æ•°åˆ†åˆ«å‡è®¾
    $H_0: \beta_i =0; \quad H_1: \beta_i \neq 0; \quad i \in 1,2$

- æ£€éªŒåŸç†çš„ä¸åŒï¼šFæ£€éªŒéœ€è¦æ„é€ Fç»Ÿè®¡é‡ï¼›tæ£€éªŒéœ€è¦æ„é€ tç»Ÿè®¡é‡

---

### ï¼ˆæ¡ˆä¾‹ï¼‰æ•™è‚²ç¨‹åº¦ä¸æ—¶å‡å·¥èµ„ï¼šè®¡ç®—ANOVAè¡¨

```{r}
anova_value <- tribble(
  ~`å˜å¼‚æ¥æº`, ~`å¹³æ–¹å’ŒSS`,  ~`è‡ªç”±åº¦df`,  ~`å‡æ–¹å’ŒMSS`, 
  "å›å½’å¹³æ–¹å’ŒESS", ESS, 1,  ESS/f_ESS, 
  "æ®‹å·®å¹³æ–¹å’ŒRSS", RSS, n-2, RSS/f_RSS,
  "æ€»å¹³æ–¹å’ŒTSS", TSS, n-1, TSS/n-1
)

kable(anova_value, align= "c",digits=3,caption = "æ•™è‚²ç¨‹åº¦ä¸æ—¶å‡å·¥èµ„æ¡ˆä¾‹çš„ANOVAåˆ†æè¡¨")
```

---

### ï¼ˆæ¡ˆä¾‹ï¼‰æ•™è‚²ç¨‹åº¦ä¸æ—¶å‡å·¥èµ„ï¼šFæ£€éªŒ

- **æ­¥éª¤1**ï¼šç»™å‡ºæ¨¡å‹
$Y_i = \beta_1 + \beta_2X_i +u_i$ï¼Œæå‡ºå‡è®¾ï¼š
$H_0: \beta_2 =0; \quad H_1: \beta_2 \neq 0$

- **æ­¥éª¤2**ï¼šæ„é€ åˆé€‚æ£€éªŒçš„åˆ†å¸ƒï¼š

$$\begin {align} 
F &= \frac{\left(\hat{\beta}_{2}-\beta_{2}\right)^{2} \sum x_{i}^{2}}{\sum e_{i}^{2} /(n-2)} 
&& \leftarrow F \sim F(1,n-2)
\end {align}$$

- **æ­¥éª¤3**ï¼šåŸºäºåŸå‡è®¾
$H_0: \beta_2=0$ï¼Œå¯ä»¥è®¡ç®—å‡ºæ ·æœ¬ç»Ÿè®¡é‡ã€‚

```{r, results="asis"}
cat(
"$$\\begin {align}",
"F^{\\ast} = \\frac{\\hat{\\beta}_{2}^{2} \\sum x_{i}^{2}}{\\sum e_{i}^{2} /(n-2)}",
"= \\frac{ESS / df_{ESS}}{RSS / df_{RSS}}",
"=\\frac{MSS_{ESS}}{MSS_{RSS}}",
str_c("=\\frac{", round(ESS/f_ESS, 4),"}{",round(RSS/f_RSS, 4), "}=", round(f_test,4)),
"\\end {align}$$",
  sep="\n"
)
```

- **æ­¥éª¤4**ï¼šç»™å®š
$\alpha=0.05$ä¸‹ï¼ŒæŸ¥å‡ºF**ç†è®ºå€¼**
$F_{1-\alpha}(1,n-2)=F_{0.95}(1,11)=$ `r formatC(f_0.95, 4, format="f")`

- **æ­¥éª¤5**ï¼šå¾—åˆ°æ˜¾è‘—æ€§æ£€éªŒçš„åˆ¤æ–­ç»“è®ºã€‚å› ä¸º
$F^{\ast}=$ `r formatC(f_test,4, format="f")` .red[**å¤§äº**] $F_{0.95}(1,11)=$ `r formatC(f_0.95, 4, format="f")`ï¼Œæ‰€ä»¥æ¨¡å‹æ•´ä½“æ˜¾è‘—æ€§çš„Fæ£€éªŒç»“æœ**æ˜¾è‘—**ã€‚æ¢è¨€ä¹‹ï¼Œåœ¨æ˜¾è‘—æ€§æ°´å¹³
$\alpha=0.05$ä¸‹ï¼Œåº”**æ˜¾è‘—**åœ°æ‹’ç»åŸå‡è®¾
$H_0$ï¼Œæ¥å—å¤‡æ‹©å‡è®¾
$H_1$ï¼Œè®¤ä¸ºæ–œç‡å‚æ•°
$\beta_2 \neq 0$ã€‚

---
layout: false
class: center, middle, duke-softblue,hide_logo
name: goodness

# 5.5 æ‹Ÿåˆä¼˜åº¦ä¸æ®‹å­˜åˆ†æ

### æ‹Ÿåˆä¼˜åº¦

### æ®‹å­˜åˆ†æ

---
layout: true

<div class="my-header-h2"></div>

<div class="watermark1"></div>

<div class="watermark2"></div>

<div class="watermark3"></div>

<div class="my-footer"><span>huhuaping@  &emsp;&emsp; <a href="#chapter"> ç¬¬05ç«  ç›¸å…³å’Œå›å½’åˆ†æ </a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
<a href="#goodness"> 5.5 æ‹Ÿåˆä¼˜åº¦ä¸æ®‹å­˜åˆ†æ </a> </span></div> 

---

## æ‹Ÿåˆä¼˜åº¦ï¼šå¼•å­

æ€ä¹ˆæ¥åˆ¤å®šOLSæ–¹æ³•å¯¹ç‰¹å®šæ ·æœ¬æ•°æ®æ‹Ÿåˆçš„å¥½åï¼Ÿ

è¯·å¤§å®¶æ€è€ƒå¦‚ä¸‹å‡ ä¸ª**é—®é¢˜**ï¼š

- æ ·æœ¬æ•°æ®ä¸å®Œå…¨è½åœ¨æ‹Ÿåˆçš„ç›´çº¿ï¼ˆæˆ–æ›²çº¿ï¼‰ä¸Šï¼Œæ˜¯ç»å¸¸å‘ç”Ÿçš„ä¹ˆï¼Ÿ

- æ€ä¹ˆæ¥è¡¨è¾¾æˆ–æµ‹é‡è¿™ç§å¯¹æ ·æœ¬æ•°æ®æ‹Ÿåˆçš„ä¸å®Œå…¨æ€§ï¼Ÿ

- åœ¨OLSæ–¹æ³•å’ŒCLRMå‡è®¾â€œåŒå‰‘åˆç’§â€ä¸‹ï¼Œå¯¹ç‰¹å®šæ ·æœ¬æ•°æ®çš„æ‹Ÿåˆä¸æ˜¯å·²ç»è¯æ˜æœ€å¥½çš„ä¹ˆï¼ˆBLUEï¼‰ï¼Ÿä¸ºä»€ä¹ˆè¿˜è¦è¯´â€œæ‹Ÿåˆâ€æœ‰â€œå¥½åä¹‹åˆ†â€ï¼Ÿ


---

## æ‹Ÿåˆä¼˜åº¦ï¼šæµ‹é‡æŒ‡æ ‡


**æ‹Ÿåˆä¼˜åº¦**ï¼ˆGoodness of fitï¼‰ï¼šåˆ¤æ–­æ ·æœ¬å›å½’çº¿å¯¹ä¸€ç»„æ•°æ®æ‹Ÿåˆä¼˜åŠ£æ°´å¹³çš„åº¦é‡ã€‚

**åˆ¤å®šç³»æ•°**ï¼ˆcoefficient of determinationï¼‰ï¼šä¸€ç§åˆ©ç”¨å¹³æ–¹å’Œåˆ†è§£ï¼Œè€ƒå¯Ÿæ ·æœ¬å›å½’çº¿å¯¹æ•°æ®æ‹Ÿåˆæ•ˆæœçš„æ€»åº¦é‡ã€‚ä¸€å…ƒå›å½’ä¸­ï¼Œä¸€èˆ¬è®°ä¸º
$r^2$ï¼›å¤šå…ƒå›å½’ä¸­ï¼Œä¸€èˆ¬è®°ä¸º
$R^2$ã€‚

```{r, fig.cap="ç»´æ©å›¾çœ‹æ‹Ÿåˆä¼˜åº¦"}
include_graphics("../pic/extra/chpt3-fitness-venn.png", dpi =100)
```

---

## æ‹Ÿåˆä¼˜åº¦ï¼šæµ‹é‡æŒ‡æ ‡

```{r, fig.cap="å¹³æ–¹å’Œåˆ†è§£çœ‹æ‹Ÿåˆä¼˜åº¦"}
include_graphics("../pic/extra/chpt2-1-PRL-SRL.png", dpi=120)
```

---

## æ‹Ÿåˆä¼˜åº¦ï¼šåˆ¤å®šç³»æ•°

åˆ¤å®šç³»æ•°
$r^2$è®¡ç®—å…¬å¼1ï¼š

$$\begin{align}
r^2 &=\frac{ESS}{TSS} = \frac{\sum{(\hat{Y}_i - \bar{Y})^2}}{\sum{(Y_i - \bar{Y})^2}} 
\end{align}$$

åˆ¤å®šç³»æ•°
$r^2$è®¡ç®—å…¬å¼2ï¼š

$$\begin{align}
r^2 &=1- \frac{RSS}{TSS} = 1- \frac{\sum{e_i^2}}{\sum{(Y_i - \bar{Y})^2}} \\
\end{align}$$

---

## æ‹Ÿåˆä¼˜åº¦ï¼šåˆ¤å®šç³»æ•°

åˆ¤å®šç³»æ•°
$r^2$è®¡ç®—å…¬å¼3ï¼š

$$\begin{align}
r^2 &=\frac{ESS}{TSS} 
= \frac{\sum{\hat{y}_i^2}}{\sum{y_i^2}} 
= \frac{\sum{(\hat{\beta}_2x_i)^2}}{\sum{y_i^2}} 
= \hat{\beta}_2^2\frac{\sum{x_i^2}}{\sum{y_i^2}} 
= \hat{\beta}_2^2 \frac{S_{X_i}^2}{S_{Y_i}^2}
\end{align}$$

åˆ¤å®šç³»æ•°
$r^2$è®¡ç®—å…¬å¼4ï¼š

$$\begin{align}
r^2 &= \hat{\beta}_2^2 \cdot \frac{\sum{x_i^2}}{\sum{y_i^2}} 
= \left( \frac{\sum{x_iy_i}}{\sum{x_i^2}} \right)^2 \cdot \left( \frac{\sum{x_i^2}}{\sum{y_i^2}} \right)
= \frac{(\sum{x_iy_i})^2}{\sum{x_i^2 }\sum{y_i^2}}
\end{align}$$

è¯¾å ‚è®¨è®ºï¼š

- è®¨è®º1ï¼š 
$r^2$æ˜¯ä¸€ä¸ªéè´Ÿé‡ã€‚ä¸ºä»€ä¹ˆï¼Ÿ

- è®¨è®º2ï¼š
$0 \leq r^2 \leq 1$ï¼Œä¸¤ä¸ªç«¯å€¼åˆ†åˆ«æ„å‘³ä»€ä¹ˆï¼Ÿ

---

## æ‹Ÿåˆä¼˜åº¦ï¼šåˆ¤å®šç³»æ•°VSç®€å•ç›¸å…³ç³»æ•°

åˆ¤å®šç³»æ•°ä¸ç®€å•ç›¸å…³ç³»æ•°æœ‰ä»€ä¹ˆåŒºåˆ«ä¸è”ç³»ï¼Ÿ

**æ€»ä½“ç›¸å…³ç³»æ•°**ï¼šæ˜¯å˜é‡
$X_i$ä¸å˜é‡
$Y_i$æ€»ä½“ç›¸å…³å…³ç³»çš„å‚æ•°ï¼Œä¸€èˆ¬è®°ä¸º
$\rho$ã€‚

$$\begin{align}
\rho &=\frac{Cov(X,Y)}{\sqrt{Var(X_i)Var(Y_i)}}
=\frac{E(X_i-EX)(Y_i-EY)}{\sqrt{E(X_i-EX)^2E(Y_i-EY)^2}}
\end{align}$$

**æ ·æœ¬ç›¸å…³ç³»æ•°**ï¼šæ˜¯ä»æ€»ä½“ä¸­æŠ½å–éšæœºæ ·æœ¬ï¼Œè·å¾—å˜é‡
$X_i$ä¸å˜é‡
$Y_i$æ ·æœ¬ç›¸å…³å…³ç³»çš„ç»Ÿè®¡é‡åº¦é‡ï¼Œä¸€èˆ¬è®°ä¸º
$r$ã€‚

$$\begin{align}
r &=\frac{S_{XY}^2}{S_X\ast S_Y}
=\frac{\sum{(X_i-\bar{X})(Y_i-\bar{Y})}}{\sqrt{\sum{(X_i-\bar{X}})^2\sum{(Y_i-\bar{Y})^2}}}
= \frac{\sum{x_iy_i}}{\sqrt{\sum{x_i^2 }\sum{y_i^2}}}
\end{align}$$

---

## æ‹Ÿåˆä¼˜åº¦ï¼šåˆ¤å®šç³»æ•°VSç®€å•ç›¸å…³ç³»æ•°

åˆ¤å®šç³»æ•°å’Œç®€å•ç›¸å…³ç³»æ•°çš„è”ç³»:

- åœ¨ä¸€å…ƒå›å½’ä¸­ï¼Œåˆ¤å®šç³»æ•°
$r^2$ç­‰äºæ ·æœ¬ç›¸å…³ç³»æ•°
$r$çš„å¹³æ–¹ã€‚

åˆ¤å®šç³»æ•°å’Œç®€å•ç›¸å…³ç³»æ•°çš„åŒºåˆ«ï¼š

- åˆ¤å®šç³»æ•°
$r^2$è¡¨æ˜å› å˜é‡å˜å¼‚ç”±è§£é‡Šå˜é‡æ‰€è§£é‡Šçš„æ¯”ä¾‹ï¼Œè€Œç›¸å…³ç³»æ•°
$r$åªèƒ½è¡¨æ˜å˜é‡é—´çš„çº¿æ€§å…³è”å¼ºåº¦ã€‚

- åœ¨å¤šå…ƒå›å½’ä¸­ï¼Œè¿™ç§åŒºåˆ«ä¼šæ›´åŠ å‡¸æ˜¾ï¼å› ä¸ºé‚£æ—¶çš„ç›¸å…³ç³»æ•°rå‡ºç°äº†åç›¸å…³çš„æƒ…å½¢(äº¤äº’å…³è”)ï¼

---

### ï¼ˆæ¡ˆä¾‹ï¼‰è®¡ç®—ç›¸å…³ç³»æ•°å’Œåˆ¤å®šç³»æ•°

å¯¹äºâ€œæ•™è‚²ç¨‹åº¦ä¸æ—¶å‡å·¥èµ„æ¡ˆä¾‹â€ï¼Œæ ¹æ®FF-ffè®¡ç®—è¡¨å’Œæ–¹å·®åˆ†è§£ANOVAè¡¨ï¼Œå¯ä»¥åˆ†åˆ«è®¡ç®—å¾—åˆ°æ ·æœ¬ç›¸å…³ç³»æ•°å’Œæ¨¡å‹åˆ¤å®šç³»æ•°ã€‚

æ ·æœ¬ç›¸å…³ç³»æ•°
$r$ï¼š

```{r, results="asis"}
cat(
  "$$\\begin{align}",
  str_c("r =\\frac{S_{XY}^2}{S_X\\ast S_Y}=","\\frac{",round(cov_XY,4),"}{",round(S_X,4),"\\ast",round(S_Y,4),"} =",round(r,4),"\\\\"),
  "\\end{align}$$",
  sep = "\n"
)
```

å›å½’æ–¹ç¨‹çš„åˆ¤å®šç³»æ•°
$r^2$ï¼š

```{r, results="asis"}
cat(
  "$$\\begin{align}",
  str_c("r^2 &= 1- \\frac{RSS}{TSS}=",1,"-\\frac{",round(RSS,4),"}{",round(TSS,4),"} =",round(r2,4),"\\\\"),
  "\\end{align}$$",
  sep = "\n"
)
```

äºŒè€…å…³ç³»

---

## æ‹Ÿåˆä¼˜åº¦ï¼šå°ç»“ä¸æ€è€ƒ

**å†…å®¹å°ç»“**ï¼š

- å³ä½¿é‡‡ç”¨OLSæ–¹æ³•ï¼Œå®ƒå¯¹æ ·æœ¬æ•°æ®çš„æ‹Ÿåˆä¹Ÿæ˜¯ä¸å®Œå…¨çš„ã€‚æ„å‘³ç€å®é™…æ•°æ®ç‚¹åœ¨æ ·æœ¬å›å½’çº¿é™„è¿‘ï¼Œè€Œä¸æ˜¯åœ¨æ ·æœ¬å›å½’çº¿ä¸Šã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ ·æœ¬ç‚¹è¡Œä¸ºçš„â€œå˜å¼‚â€ï¼Œåˆ’åˆ†ä¸ºâ€œå›å½’â€èƒ½è§£é‡Šçš„éƒ¨åˆ†å’Œâ€œéšæœºâ€çš„éƒ¨åˆ†ã€‚å¹¶è¿›ä¸€æ­¥è·å¾—å˜å¼‚å¹³æ–¹å’Œçš„åˆ†è§£ã€‚

- åˆ¤å®šç³»æ•°
$R^2$æ˜¯å¯¹OLSæ‹Ÿåˆç¨‹åº¦çš„æµ‹é‡ï¼Œå®ƒä½¿ç”¨äº†å˜å¼‚å¹³æ–¹å’Œåˆ†è§£çš„æ€æƒ³ã€‚åœ¨ä¸€å…ƒçº¿æ€§å›å½’ï¼ˆå«æˆªè·ï¼‰ä¸­ï¼Œåˆ¤å®šç³»æ•°ä¸ç›¸å…³ç³»æ•°å­˜åœ¨å¦‚ä¸‹å…³ç³»
$R^2 = r^2_{(X_i,Y_i)}$ã€‚æ³¨æ„ï¼Œåœ¨å¤šå…ƒå›å½’ä¸­åˆ™ä¸å­˜åœ¨è¿™ç§å…³ç³»ã€‚

**é—®é¢˜æ€è€ƒ**ï¼š

- OLSæ–¹æ³•çš„å‚æ•°ä¼°è®¡é‡ï¼Œåœ¨CLRMå‡è®¾æ»¡è¶³æƒ…å†µä¸‹ï¼Œå°±æ˜¯æœ€ä¼˜çº¿æ€§æ— åä¼°è®¡é‡ï¼ˆBLUEï¼‰ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨**åˆ¤å®šç³»æ•°**æ¥åˆ¤æ–­â€œæ‹Ÿåˆå¥½è¿˜æ˜¯ä¸å¥½ï¼Ÿâ€ã€‚å¯¹æ­¤ï¼Œä½ çš„å›ç­”æ˜¯ä»€ä¹ˆï¼Ÿ

- è¿˜æœ‰æ²¡æœ‰å…¶ä»–æŒ‡æ ‡ï¼Œæ¥åæ˜ ä¼°è®¡æ–¹æ³•å¯¹æ ·æœ¬æ•°æ®çš„æ‹Ÿåˆå¥½åç¨‹åº¦ï¼Ÿè¯·è¯´å‡ºä¸€ä¸¤ä¸ªã€‚

???
å‚è€ƒç­”æ¡ˆï¼šè¿˜å¯ä»¥æœ‰**å‡æ–¹è¯¯å·®å’Œ**ï¼ˆMSEï¼‰
$MSE=RSS/n= 1/n\sum{(Y_i - \hat{Y}_i})^2$ï¼Œä»¥åŠ**å‡æ–¹è¯¯å·®æ ¹**ï¼ˆRMSEï¼‰ç­‰ã€‚

---

## æ®‹å·®åˆ†æï¼šå®šä¹‰å’Œä½œç”¨

**æ®‹å·®**(residual)ï¼šæ˜¯å› å˜é‡çš„è§‚æµ‹å€¼ä¸æ ¹æ®ä¼°è®¡çš„å›å½’æ–¹ç¨‹æ±‚å‡ºçš„ä¼°è®¡å€¼ä¹‹å·®ï¼Œç”¨
$e_i$è¡¨ç¤ºã€‚

$$e_i = Y_i - \hat{Y_i}$$

å¯¹æ¨¡å‹çš„æ®‹å·®è¿›è¡Œåˆ†æï¼Œä¸»è¦ç›®çš„åŒ…æ‹¬ï¼š

- åæ˜ ç”¨ä¼°è®¡çš„å›å½’æ–¹ç¨‹å»é¢„æµ‹è€Œå¼•èµ·çš„è¯¯å·®ã€‚

- å¯ç”¨äºç¡®å®šæœ‰å…³éšæœºå¹²æ‰°é¡¹
$\mu_i$çš„å‡å®šæ˜¯å¦æˆç«‹ã€‚

- ç”¨äºæ£€æµ‹æœ‰å½±å“çš„è§‚æµ‹å€¼ã€‚

---

## æ®‹å·®åˆ†æï¼šçš®å°”é€Šæ ‡å‡†åŒ–æ®‹å·®

**æ ‡å‡†åŒ–æ®‹å·®**(standardized residual)ï¼šæ˜¯å¯¹æ®‹å·®è¿›è¡ŒæŸç§æ ‡å‡†åŒ–å˜æ¢ã€‚å…·ä½“è®¡ç®—æ–¹æ³•æœ‰**çš®å°”é€Šæ ‡å‡†åŒ–æ®‹å·®**å’Œ**å­¦ç”ŸåŒ–æ ‡å‡†æ®‹å·®**ä¸¤ç§ã€‚

æœ€å¸¸ç”¨çš„çš®å°”é€Šæ ‡å‡†åŒ–æ®‹å·®ï¼ˆPearson residual/.red[internally studentized residuals]ï¼‰çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š

$$\begin{align}
e_{i, sd}^{\ast}= \frac{e_i}{s_{e_i}} 
= \frac{(Y_i - \hat{Y_i})}{\sqrt{\frac{\sum{(e_i-\bar{e})^2}}{n-1}}}
\end{align}$$

---

## æ®‹å·®åˆ†æï¼šçš®å°”é€Šæ ‡å‡†åŒ–æ®‹å·®

**å­¦ç”ŸåŒ–æ ‡å‡†æ®‹å·®**ï¼ˆStudentized Residuals/.red[externally studentized residual]/deleted Studentized residual/semi-studentized residuals/jackknifed residualsï¼‰ï¼Œæ˜¯å¯¹æ®‹å·®çš„å¦ä¸€ç§ç‰¹æ®Šæ ‡å‡†åŒ–å˜æ¢ï¼ˆä¾‹å¦‚è€ƒè™‘åˆ°äº†Xçš„å½±å“åŠ›ï¼‰ã€‚

**å­¦ç”ŸåŒ–æ ‡å‡†æ®‹å·®**çš„è®¡ç®—å…¬å¼æœ‰ä¸¤ä¸ª<sup>*</sup>ï¼š

$$\begin{align}
e_{i,st}^{\ast} &= \frac{e_i}{\sqrt{MSE_{(i)}(1-h_{ii})}} \\
e_{i,st}^{\ast}& = e_{i, sd}^{\ast}\left( \frac{n-m-2}{n-m-1-e_{i, sd}^{\ast 2}}\right)^2
\end{align}$$

> å…¶ä¸­ï¼š
$MSE_{(i)}$æ˜¯æŒ‡åˆ é™¤ç¬¬
$i$ä¸ªè§‚æµ‹å€¼è¿›è¡Œå»ºæ¨¡çš„**å‡æ–¹è¯¯å·®**ï¼ˆMSEï¼‰ï¼›
$h_{ii}$æŒ‡åˆ é™¤ç¬¬
$i$ä¸ªè§‚æµ‹å€¼è¿›è¡Œå»ºæ¨¡çš„ç¬¬
$i$ä¸ª**å½±å“æƒé‡**ï¼ˆleverageï¼‰ã€‚
$m=k-1$ä¸ºå›å½’å…ƒä¸ªæ•°ã€‚

.footnote[
è¯´æ˜ï¼š
1ï¼‰å­¦ç”ŸåŒ–æ®‹å·®çš„ç¬¬ä¸€ä¸ªè®¡ç®—å…¬å¼è®¡ç®—èµ·æ¥æ¯”è¾ƒéº»çƒ¦å’Œå¤æ‚ã€‚éœ€è¦åˆ†åˆ«è¿›è¡Œ(n-1)æ¬¡çº¿æ€§å›å½’ï¼Œç„¶åä¾æ¬¡è®¡ç®—ç›¸å…³
$MSE_{(i)}$å’Œ
$h_ii$ã€‚2ï¼‰å­¦ç”ŸåŒ–æ®‹å·®çš„ç¬¬äºŒä¸ªè®¡ç®—å…¬å¼ç›¸å¯¹ç®€å•ï¼Œåªéœ€è¦åˆ©ç”¨åŸæ¥çš„å›å½’æ¨¡å‹åŠå…¶æ ‡å‡†åŒ–æ®‹å·®
$e_{i, sd}^{\ast}$ã€‚

]

???

ç†è®ºå‚çœ‹ï¼š

- [Studentized Residuals](https://online.stat.psu.edu/stat462/node/247/)

- [Using Leverages to Help Identify Extreme X Values](https://online.stat.psu.edu/stat462/node/171/)

æ“ä½œå‚çœ‹ï¼š
- [Is studentized residuals v/s standardized residuals in lm model](https://stats.stackexchange.com/questions/204708/is-studentized-residuals-v-s-standardized-residuals-in-lm-model)

---

## æ®‹å·®åˆ†æï¼šæ®‹å·®å›¾

**æ®‹å·®å›¾**(residual plot)ï¼šç”¨äºå‘ˆç°æ®‹å·®æ•°æ®
$e_i$çš„åˆ†å¸ƒæƒ…å†µçš„ç»Ÿè®¡å›¾å›¾å½¢ï¼Œä¸»è¦åŒ…æ‹¬ï¼š


- å…³äº
$X_i$çš„æ®‹å·®æ•£ç‚¹å›¾ã€‚

- å…³äº
$Y_i$çš„æ®‹å·®æ•£ç‚¹å›¾ï¼ˆæˆ–è€…å…³äº
$\hat{Y_i}$ï¼‰ã€‚

- å…³äºæ ·æœ¬åºå·çš„æ®‹å·®æ•£ç‚¹å›¾æˆ–æ ‡å‡†åŒ–æ®‹å·®æ•£ç‚¹å›¾ã€‚

---

### ï¼ˆç¤ºä¾‹ï¼‰æ®‹å·®å›¾çš„æ¨¡æ‹Ÿæ¼”ç¤º


```{r, out.width= "75%"}
include_graphics("../pic/extra/chpt8-diagnose-ei.png")
```

???
æ®‹å·®åºåˆ—
$e_i$ï¼ˆæˆ–è€…æ ‡å‡†åŒ–æ®‹å·®åºåˆ—
$e_i^{\ast}$ï¼‰ä¸ç›¸å…³å˜é‡ï¼ˆåŒ…æ‹¬
$X_i; Y_i;\hat{Y_i}$ä»¥åŠæ ·æœ¬åºå·ï¼‰ä¹‹é—´**æ•£ç‚¹å›¾**çš„è‹¥å¹²å‡æƒ³åˆ†å¸ƒæ¨¡å¼ã€‚

---

### ï¼ˆæ¡ˆä¾‹ï¼‰çš®å°”é€Šæ ‡å‡†åŒ–æ®‹å·®

.pull-left[

```{r, eval=T}
show_tbl %>%
  select(c(1:3,12:14)) %>%
  mutate_at(vars(contains("e_")), funs(formatC(., digits = 4, format = "f"))) %>%
  kable( ) %>%  
  kable_styling(font_size=20)
```


]

.pull-right[

- æ ¹æ®æ ·æœ¬å›å½’æ–¹ç¨‹ï¼Œå¯ä»¥è®¡ç®—å¾—åˆ°
$Y_i$çš„å›å½’æ‹Ÿåˆå€¼
$\hat{Y}_i$ï¼Œä»¥åŠå›å½’æ®‹å·®
$e_i$ã€‚

$$\begin{align}
\hat{Y}_i &=\hat{\beta}_1 +\hat{\beta}_2X_i\\
e_i &= Y_i - \hat{Y}_i
\end{align}$$

- è¿›ä¸€æ­¥åœ°è®¡ç®—å¾—åˆ°**çš®å°”é€Šæ ‡å‡†åŒ–æ®‹å·®**
$e_{i, sd}^{\ast}$ï¼š

$$\begin{align}
e_{i, sd}^{\ast}= \frac{e_i}{s_{e_i}} 
= \frac{(Y_i - \hat{Y_i})}{\sqrt{\frac{\sum{(e_i-\bar{e})^2}}{n-1}}}
\end{align}$$

]


---

### ï¼ˆæ¡ˆä¾‹ï¼‰å­¦ç”ŸåŒ–æ ‡å‡†æ®‹å·®

.pull-left[

```{r, eval=T}
show_tbl %>%
  select(c(1:3,12:15)) %>%
  mutate_at(vars(contains("e_")), funs(formatC(., digits = 4, format = "f"))) %>%
  kable() %>%  
  kable_styling(font_size=20)

```


]

.pull-right[

- æ ¹æ®æ ·æœ¬å›å½’æ–¹ç¨‹ï¼Œå¯ä»¥è®¡ç®—å¾—åˆ°
$Y_i$çš„å›å½’æ‹Ÿåˆå€¼
$\hat{Y}_i$ï¼Œä»¥åŠå›å½’æ®‹å·®
$e_i$ï¼Œä»¥åŠå‰è¿°çš„**çš®å°”é€Šæ ‡å‡†åŒ–æ®‹å·®**
$e_{i, sd}^{\ast}$ã€‚

- è¿›è€Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å…¬å¼è®¡ç®—å¾—åˆ°**å­¦ç”ŸåŒ–æ ‡å‡†æ®‹å·®**
$e_{i,st}^{\ast}$ï¼š

$$\begin{align}
e_{i,st}^{\ast}& = e_{i, sd}^{\ast}\left( \frac{n-k-2}{n-k-1-e_{i, sd}^{\ast 2}}\right)^2
\end{align}$$

]

---

### ï¼ˆæ¡ˆä¾‹ï¼‰çš®å°”é€Šæ ‡å‡†åŒ–æ®‹å·®æ•£ç‚¹å›¾

```{r}
resid_tbl <- calc_tbl %>%
  select(all_of(c("obs", "X", "Y")), all_of(contains("e_i")))

resid_tbl %>%
  ggplot(aes(X, e_i)) +
  geom_point() +
  #labs(x = ) +
  theme(text = element_text(size=18),
        axis.title.x = element_text(size = 16,
                                margin = margin(t = 15, r = 0, 
                                                b = 0, l = 0)),
        axis.title.y = element_text(size = 16,
                                margin = margin(t = 0, r = 15, 
                                                b = 0, l = 0)))
```



---
layout: false
class: center, middle, duke-softblue,hide_logo
name: forecast

# 5.6 å›å½’é¢„æµ‹åˆ†æ

### å‡å€¼é¢„æµ‹

### ä¸ªå€¼é¢„æµ‹

### ç½®ä¿¡å¸¦

---
layout: true

<div class="my-header-h2"></div>

<div class="watermark1"></div>

<div class="watermark2"></div>

<div class="watermark3"></div>

<div class="my-footer"><span>huhuaping@  &emsp;&emsp; <a href="#chapter"> ç¬¬05ç«  ç›¸å…³å’Œå›å½’åˆ†æ </a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
<a href="#forecast"> 5.6 å›å½’é¢„æµ‹åˆ†æ </a> </span></div> 

---

## å›å½’é¢„æµ‹ï¼šå¼•å­

é¢„æµ‹æœªæ¥äº‹ä»¶çš„ä¸€äº›æƒ¯å¸¸è¯´æ³•

- ç®—å‘½æœ¯å£«ï¼š

    - â€œå®¢å®˜å°å ‚å‘é»‘ï¼Œæ˜æ—¥å¿…æœ‰å‡¶è±¡!â€

- å¤©æ°”é¢„æŠ¥æ’­æŠ¥è¯ï¼š

    - é¢„æµ‹è¥¿å®‰æ˜å¤©æ˜¯å°é›¨ï¼Œæ¦‚ç‡ä¸º95%ã€‚
    
    - é¢„æµ‹è¥¿å®‰æ˜å¤©æ˜¯å°é›¨è½¬é˜´ï¼Œæ¦‚ç‡ä¸º95%ã€‚
    
    - é¢„æµ‹è¥¿å®‰æ˜å¤©æ˜¯å¤©æ™´æˆ–é˜´å¤©æˆ–é›¨å¤©ï¼Œæ¦‚ç‡ä¸º100%ï¼

- ç®€è¦è§£æï¼š
    
    - äººä»¬åœ¨é¢„æµ‹ä»€ä¹ˆäº‹ä»¶ï¼Ÿ
    
    - é¢„æµ‹å¤šå°‘ä¸ªäº‹ä»¶ï¼Ÿå®ƒä»¬å‘ç”Ÿçš„å…³ç³»ï¼Ÿ
    
    - é¢„æµ‹å¦‚ä½•ä»¤äººä¿¡æœï¼Ÿ

---

## å›å½’é¢„æµ‹ï¼šä¸¤ç±»é¢„æµ‹

ä¸€å…ƒå›å½’æ¨¡å‹ä¸‹ï¼š

$$Y_i = \beta_1 + \beta_2X_i +u_i$$

é¢„æµ‹ä»€ä¹ˆï¼Ÿ

**å‡å€¼é¢„æµ‹**(mean prediction)ï¼š

- ç»™å®š
$X_0$ï¼Œé¢„æµ‹Yçš„æ¡ä»¶å‡å€¼
$E(Y|X=X_0)$


**ä¸ªå€¼é¢„æµ‹**(individual prediction)ï¼š

- ç»™å®š
$X_0$ï¼Œé¢„æµ‹å¯¹åº”äº
$X0$çš„Yçš„ä¸ªåˆ«å€¼
$(Y_0|X_0)$

---

### ï¼ˆç¤ºä¾‹ï¼‰æ ·æœ¬å†…é¢„æµ‹

```{r}
dpi_pred <-  220
include_graphics("../pic/extra/chpt4-forecast-demo-01-insample.png", dpi= dpi_pred)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰æ ·æœ¬å¤–é¢„æµ‹

```{r}
include_graphics("../pic/extra/chpt4-forecast-demo-02-outsample.png" , dpi= dpi_pred)
```


---

### ï¼ˆç¤ºä¾‹ï¼‰å‡å€¼é¢„æµ‹

```{r}
include_graphics("../pic/extra/chpt4-forecast-demo-03-exp.png", dpi= dpi_pred)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ä¸ªå€¼é¢„æµ‹

```{r}
include_graphics("../pic/extra/chpt4-forecast-demo-04-ind.png", dpi= dpi_pred)
```

---

## å›å½’é¢„æµ‹ï¼šé¢„æµ‹åˆ†æçš„å…³é”®

æ‹¿ä»€ä¹ˆæ¥é¢„æµ‹ï¼Ÿâ€”â€”æ ·æœ¬æ•°æ®ï¼Ÿæ ·æœ¬å›å½’çº¿ï¼Ÿæ ·æœ¬æ‹Ÿåˆå€¼ï¼Ÿ

æ ·æœ¬å¤–æ‹Ÿåˆå€¼
$\hat{Y}_0|X=X_0$ï¼š

- å¯ä»¥è¯æ˜ï¼šæ ·æœ¬å¤–æ‹Ÿåˆå€¼
  $\hat{Y}_0|X=X_0$æ˜¯**å‡å€¼**
  $E(Y|X=X_0)$çš„ä¸€ä¸ª.blue[**BLUE**]

- ä¹Ÿå¯ä»¥è¯æ˜ï¼šæ ·æœ¬å¤–æ‹Ÿåˆå€¼
  $\hat{Y}_0|X=X_0$æ˜¯**ä¸ªå€¼**
  $(Y_0|X=X_0)$çš„ä¸€ä¸ª.blue[**BLUE**]

å·¥èµ„æ¡ˆä¾‹ä¸­ï¼Œç»™å®š
$X_0=$ `r X_0`ï¼Œåˆ™å¯ä»¥å¾—åˆ°æ ·æœ¬å¤–æ‹Ÿåˆå€¼ï¼š

```{r, results="asis"}
cat(
  "\\begin{align}",
  "\\hat{Y}_{0}=\\hat{\\beta}_{1}+\\hat{\\beta}_{2} X_{0}",
  str_c("=",round(b1,4),"+",round(b2,4),"\\ast",X_0),
  str_c("=",round(Y_0_hat, 4)),
  "\\end{align}",
  sep="\n"
  )
```


---

## å›å½’é¢„æµ‹ï¼šé¢„æµ‹åˆ†æçš„å…³é”®

```{r}
include_graphics("../pic/extra/chpt4-forecast-demo-05-fitted.png", dpi= dpi_pred)
```

---

## å‡å€¼é¢„æµ‹

åœ¨**N-CLRM**å‡è®¾å’Œ**OLS**æ–¹æ³•ä¸‹ï¼Œå¯ä»¥è¯æ˜ï¼ˆè¯æ˜è¿‡ç¨‹ç•¥ï¼‰ç»™å®š
$X_0$ä¸‹çš„æ‹Ÿåˆå€¼
$\hat{Y}_0$æœä»å¦‚ä¸‹æ­£æ€åˆ†å¸ƒï¼š

$$\begin {align} 
\hat{Y}_{0} \sim \mathrm{N}\left(\mu_{\hat{Y}_{0}}, \sigma_{\hat{Y}_{0}}^{2}\right)
\end {align}$$

$$\begin {align} 
\mu_{\hat{Y}_{0}}=E\left(\hat{Y}_{0}\right)=E\left(\hat{\beta}_{1}+\hat{\beta}_{2} X_{0}\right)=\beta_{1}+\beta_{2} X_{0}=E(Y | X_{0})
\end {align}$$

$$\begin {align} 
\operatorname{var}\left(\hat{Y}_{0}\right)=\sigma_{\hat{Y}_{0}}^{2}=\sigma^{2}\left[\frac{1}{n}+\frac{\left(X_{0}-\overline{X}\right)^{2}}{\sum x_{i}^{2}}\right]
 \end {align}$$

$$\begin {align} 
\hat{Y}_{0} \sim N\left(E(Y | X_{0}), \sigma^{2}\left[\frac{1}{n}+\frac{\left(X_{0}-\overline{X}\right)^{2}}{\sum x_{i}^{2}}\right]\right)
\end {align}$$

---

## å‡å€¼é¢„æµ‹

å¯¹
$\hat{Y}_{0}$æ„é€ **tç»Ÿè®¡é‡**ï¼š

$$\begin {align} 
T &=\frac{\hat{Y}_{0}-\mathrm{E}(\mathrm{Y} | \mathrm{X}_{0})}{S_{\hat{Y}_{0}}} \sim t(n-2)
&& \Leftarrow S_{\hat{Y}_{0}}=\sqrt{\hat{\sigma}^{2}\left[\frac{1}{n}+\frac{\left(X_{0}-\overline{X}\right)^{2}}{\sum x_{i}^{2}}\right]}
\end {align}$$

å¾—åˆ°**å‡å€¼**
$E(Y|X=X_0)$ç½®ä¿¡åŒºé—´ä¸ºï¼š

$$\begin {align} 
\operatorname{Pr}\left[\hat{Y}_{0}-t_{1-\alpha / 2}(n-2) \cdot S_{\hat{Y}_{0}} \leq E(Y | X_{0}) \leq \hat{Y}_{0}+t_{1-\alpha / 2}(n-2) \cdot S_{\hat{Y}_{0}}\right]=1-\alpha
\end {align}$$
 
$$\begin {align} 
\operatorname{Pr}\left[\hat{\beta}+\hat{\beta}_{2} X_{0}-t_{1-\alpha / 2}(n-2) \cdot S_{\hat{Y}_{0}} \leq E(Y | X_{0}) \leq \hat{\beta}+\hat{\beta}_{2} X_{0}+t_{1- \alpha / 2}(n-2) \cdot S_{\hat{Y}_{0}}\right]=1-\alpha
\end {align}$$

---

### ï¼ˆæ¡ˆä¾‹ï¼‰æ•™è‚²ç¨‹åº¦å’Œæ—¶å‡å·¥èµ„ï¼šå‡å€¼é¢„æµ‹

ç»™å®š
$X_0=$ `r X_0`æ—¶ï¼Œæ ¹æ®æ—©å‰è®¡ç®—ç»“æœï¼š
$\hat{\sigma}^2=$ `r formatC(dev, 4, format="f")`ï¼›
$\bar{X}=$ `r formatC(mean_X, 4, format="f")`ï¼›
$\sum{x_i^2}=$ `r formatC(FF_ff$ff_x_sqr, 4, format="f")`ã€‚å› æ­¤å¯ä»¥å¾—åˆ°ï¼š

```{r, results="asis"}
cat(
  "\\begin{align}",
  "S^2_{\\hat{Y}_{0}} &=\\hat{\\sigma}^{2}\\left[\\frac{1}{n}+\\frac{\\left(X_{0}-\\overline{X}\\right)^{2}}{\\sum x_{i}^{2}}\\right] ",
  str_c("=",round(dev,4), "\\left( \\frac{1}{",n,"}+","\\frac{(",round(X_0,4),"-",round(mean_X,4),")^2}{",round(FF_ff$ff_x_sqr,4), "}", "\\right)"),
  str_c("=",round(S2_Y0h,4), "; \\quad"),
  str_c("S_{\\hat{Y}_{0}} = \\sqrt{S^2_{\\hat{Y}_{0}}}=",
        round(sqrt(S2_Y0h),4)
        ),
  "\\end{align}",
  sep="\n"
)
```


```{r, results="asis"}
cat(
  "\\begin{align}",
  "\\hat{Y}_{0}=\\hat{\\beta}_{1}+\\hat{\\beta}_{2} X_{0}",
  str_c("=",round(b1,4),"+",round(b2,4),"\\ast",X_0),
  str_c("=",round(Y_0_hat, 4)),
  "\\end{align}",
  sep="\n"
  )
```

å› æ­¤ï¼Œå¯ä»¥è®¡ç®—å¾—åˆ°**å‡å€¼**
$E(Y|X=20)$ç½®ä¿¡åŒºé—´ä¸ºï¼š

```{r, results="asis"}
cat(
  "\\begin{align}",
  "\\hat{\\beta}+\\hat{\\beta}_{2} X_{0}-t_{1-\\alpha / 2}(n-2) \\cdot S_{\\hat{Y}_{0}} \\leq  & E(Y | X_{0}) \\leq \\hat{\\beta}+\\hat{\\beta}_{2} X_{0}+t_{1- \\alpha / 2}(n-2) \\cdot S_{\\hat{Y}_{0}} \\\\",
  str_c(round(Y_0_hat,4),"-",round(t_0.95, 4),"\\ast",round(sqrt(S2_Y0h),4), 
        "\\leq & E(Y|X_0=",X_0,")\\leq", 
        round(Y_0_hat,4),"+",round(t_0.95, 4),"\\ast",round(sqrt(S2_Y0h),4)
        ),"\\\\",
  str_c(round(Y_exp_lft,4), 
        "\\leq & E(Y|X_0=",X_0,")\\leq", 
        round(Y_exp_rht,4)
        ),
  "\\end{align}",
  sep="\n"
)
```

---

### ï¼ˆæ¡ˆä¾‹ï¼‰æ•™è‚²ç¨‹åº¦å’Œæ—¶å‡å·¥èµ„ï¼šå‡å€¼é¢„æµ‹

```{r}
include_graphics("../pic/extra/chpt4-forecast-demo-06-interval-exp.png", dpi= dpi_pred)
```

---

## ä¸ªå€¼é¢„æµ‹

åœ¨**N-CLRM**å‡è®¾å’Œ**OLS**æ–¹æ³•ä¸‹ï¼Œå¯ä»¥è¯æ˜ï¼ˆè¯æ˜è¿‡ç¨‹ç•¥ï¼‰ç»™å®š
$X_0$ä¸‹çš„ä¸ªåˆ«å€¼
$Y_0=\beta_1+\beta_2X_0 +u_0$æœä»å¦‚ä¸‹æ­£æ€åˆ†å¸ƒï¼š

$$\begin {align} 
Y_{0} &\sim \mathrm{N}\left(\mu_{Y_{0}}, \sigma_{Y_{0}}^{2}\right) \\
\mu_{Y_{0}}&=E\left(Y_{0}\right)=E\left(\beta_{1}+\beta_{2} X_{0}\right)=\beta_{1}+\beta_{2} X_{0} \\
Var(Y_{0}) &=Var{(u_0)}=\sigma^{2}
\end {align}$$


$$\begin {align} 
Y_{0} \sim N\left(\beta_{1}+\beta_{2} X_{0}, \sigma^{2} \right)
\end {align}$$

---

## ä¸ªå€¼é¢„æµ‹

è¿›ä¸€æ­¥å¯ä»¥æ„é€ æ–°çš„éšæœºå˜é‡
$(Y_0-\hat{Y}_0)$ï¼Œå…¶å°†æœä»å¦‚ä¸‹æ­£æ€åˆ†å¸ƒï¼š

$$\begin {align} 
Y_{0} & \sim N\left(\beta_{1}+\beta_{2} X_{0}, \sigma^{2} \right)\\
\hat{Y}_{0} & \sim N\left( \beta_{1}+\beta_{2} X_{0}, \sigma^{2}\left[\frac{1}{n}+\frac{\left(X_{0}-\overline{X}\right)^{2}}{\sum x_{i}^{2}}\right]\right) 
\end {align}$$

$$\begin {align} 
Y_{0} - \hat{Y}_{0} & \sim N\left( 0, \sigma^{2}\left[1 + \frac{1}{n}+\frac{\left(X_{0}-\overline{X}\right)^{2}}{\sum x_{i}^{2}}\right]\right) \\
Y_{0} - \hat{Y}_{0} & \sim N\left( 0, \sigma^{2}_{Y_{0} - \hat{Y}_{0}} \right)
\end {align}$$


---

## ä¸ªå€¼é¢„æµ‹

å¯¹
$Y_{0} - \hat{Y}_{0}$æ„é€ **tç»Ÿè®¡é‡**ï¼š

$$\begin {align} 
T &=\frac{(Y_{0} - \hat{Y}_{0})}{S_{(Y_{0} - \hat{Y}_{0})}} \sim t(n-2)
&& \Leftarrow S_{(Y_{0} - \hat{Y}_{0})}
=\sqrt{\hat{\sigma}^{2}\left[1+\frac{1}{n}+\frac{\left(X_{0}-\overline{X}\right)^{2}}{\sum x_{i}^{2}}\right]}
\end {align}$$

å¾—åˆ°**ä¸ªå€¼**
$Y_{0}$ç½®ä¿¡åŒºé—´ä¸ºï¼š

$$\begin {align} 
\operatorname{Pr}\left[\hat{Y}_{0}-t_{1-\alpha / 2}(n-2) \cdot S_{(Y_{0} - \hat{Y}_{0})} \leq Y_{0} \leq \hat{Y}_{0}+t_{1-\alpha / 2}(n-2) \cdot S_{(Y_{0} - \hat{Y}_{0})}\right]=1-\alpha
\end {align}$$
 
$$\begin {align} 
\operatorname{Pr}\left[\hat{\beta}+\hat{\beta}_{2} X_{0}-t_{1-\alpha / 2}(n-2) \cdot S_{(Y_{0} - \hat{Y}_{0})} 
\leq Y_{0} \leq 
\hat{\beta}+\hat{\beta}_{2} X_{0}+t_{1- \alpha / 2}(n-2) \cdot S_{(Y_{0} - \hat{Y}_{0})}\right]=1-\alpha
\end {align}$$


---

### ï¼ˆæ¡ˆä¾‹ï¼‰æ•™è‚²ç¨‹åº¦å’Œæ—¶å‡å·¥èµ„ï¼šä¸ªå€¼é¢„æµ‹

ç»™å®š
$X_0=$ `r X_0`æ—¶ï¼Œæ ¹æ®æ—©å‰è®¡ç®—ç»“æœï¼š
$\hat{\sigma}^2=$ `r formatC(dev, 4, format="f")`ï¼›
$\bar{X}=$ `r formatC(mean_X, 4, format="f")`ï¼›
$\sum{x_i^2}=$ `r formatC(FF_ff$ff_x_sqr, 4, format="f")`ã€‚å› æ­¤å¯ä»¥å¾—åˆ°ï¼š

```{r, results="asis"}
cat(
  "\\begin{align}",
  "S^2_{(Y_{0} - \\hat{Y}_{0})} &=\\hat{\\sigma}^{2}\\left[1+\\frac{1}{n}+\\frac{\\left(X_{0}-\\overline{X}\\right)^{2}}{\\sum x_{i}^{2}}\\right] ",
  str_c("=",round(dev,4), "\\left( 1+ \\frac{1}{",n,"}+","\\frac{(",round(X_0,4),"-",round(mean_X,4),")^2}{",round(FF_ff$ff_x_sqr,4), "}", "\\right)"),
  str_c("=",round(S2_Y0h_mns,4)),"\\\\",
  str_c("S_{\\hat{Y}_{0}} &= \\sqrt{S^2_{\\hat{Y}_{0}}}=",
        round(sqrt(S2_Y0h_mns),4)
        ),
  "\\end{align}",
  sep="\n"
)
```


```{r, results="asis"}
cat(
  "\\begin{align}",
  "\\hat{Y}_{0}=\\hat{\\beta}_{1}+\\hat{\\beta}_{2} X_{0}",
  str_c("=",round(b1,4),"+",round(b2,4),"\\ast",X_0),
  str_c("=",round(Y_0_hat, 4)),
  "\\end{align}",
  sep="\n"
  )
```

å› æ­¤ï¼Œå¯ä»¥è®¡ç®—å¾—åˆ°**ä¸ªå€¼**
$(Y_0|X=20)$ç½®ä¿¡åŒºé—´ä¸ºï¼š

```{r, results="asis"}
cat(
  "\\begin{align}",
  "\\hat{\\beta}+\\hat{\\beta}_{2} X_{0}-t_{1-\\alpha / 2}(n-2) \\cdot S_{(Y_{0} - \\hat{Y}_{0})} \\leq  & Y_0 | X=X_0) \\leq \\hat{\\beta}+\\hat{\\beta}_{2} X_{0}+t_{1- \\alpha / 2}(n-2) \\cdot S_{(Y_{0} - \\hat{Y}_{0})} \\\\",
  str_c(round(Y_0_hat,4),"-",round(t_0.95, 4),"\\ast",round(sqrt(S2_Y0h_mns),4), 
        "\\leq & Y_0|X_0=",X_0,")\\leq", 
        round(Y_0_hat,4),"+",round(t_0.95, 4),"\\ast",round(sqrt(S2_Y0h_mns),4)
        ),"\\\\",
  str_c(round(Y_ind_lft,4), 
        "\\leq & Y_0|X_0=",X_0,")\\leq", 
        round(Y_ind_rht,4)
        ),
  "\\end{align}",
  sep="\n"
)
```

---

### ï¼ˆæ¡ˆä¾‹ï¼‰æ•™è‚²ç¨‹åº¦å’Œæ—¶å‡å·¥èµ„ï¼šä¸ªå€¼é¢„æµ‹

```{r}
include_graphics("../pic/extra/chpt4-forecast-demo-09-interval-ind.png", dpi= dpi_pred)
```

---

## ç½®ä¿¡å¸¦

**ç½®ä¿¡å¸¦**(confidence interval)ï¼šå¯¹æ‰€æœ‰çš„Xå€¼ï¼Œåˆ†åˆ«è¿›è¡Œ**å‡å€¼**å’Œ**ä¸ªå€¼**åˆ†åˆ«è¿›è¡Œé¢„æµ‹ï¼Œå°±èƒ½å¾—åˆ°ï¼š

- å‡å€¼é¢„æµ‹çš„ç½®ä¿¡å¸¦â€”â€”æ€»ä½“å›å½’å‡½æ•°çš„ç½®ä¿¡å¸¦

- ä¸ªå€¼é¢„æµ‹çš„ç½®ä¿¡å¸¦

- é¢„æµ‹å¦‚ä½•å¯ä¿¡ï¼Ÿ
    
    - å‡å€¼é¢„æµ‹ç½®ä¿¡åŒºé—´
    
    - å‡å€¼é¢„æµ‹ç½®ä¿¡å¸¦

- æ ·æœ¬å†…ç½®ä¿¡å¸¦ã€‚â€”â€”æ£€éªŒå¯é æ€§

- æ ·æœ¬å¤–ç½®ä¿¡å¸¦ã€‚â€”â€”é¢„æµ‹æœªæ¥å€¼èŒƒå›´


---

## ç½®ä¿¡å¸¦

```{r}
include_graphics("../pic/extra/chpt4-forecast-demo-08-band-exp.png", dpi= dpi_pred)
```

---

## ç½®ä¿¡å¸¦

```{r}
include_graphics("../pic/extra/chpt4-forecast-demo-10-band-ind.png", dpi= dpi_pred)
```

---

## ç½®ä¿¡å¸¦

å¦‚ä½•ç†è§£ç½®ä¿¡å¸¦ï¼Ÿ

- è°æ›´å®½ï¼Ÿâ€”â€”å‡å€¼é¢„æµ‹æ›´å‡†ç¡®

- ä½•å¤„æœ€çª„ï¼Ÿâ€”â€” ä¸­å¿ƒç‚¹
$(\bar{X}, \bar{Y})=$ `r str_c("(",mean_X,",", formatC(mean_Y,2,format="f"),")")`æ˜¯å†å²ä¿¡æ¯çš„é›†ä¸­ä»£è¡¨ã€‚

---

## å›å½’é¢„æµ‹ï¼šæ€»ç»“ä¸æ€è€ƒ

**å†…å®¹æ€»ç»“**ï¼š

- å›å½’é¢„æµ‹åŸºäºä¸€å¥—åšå®ä¸¥å¯†çš„â€œåº•åº§â€ï¼šOLSä¼°è®¡æ–¹æ³•ã€CLRMå‡è®¾ã€BLUEä¼°è®¡æ€§è´¨

- å‡å€¼é¢„æµ‹ç½®ä¿¡å¸¦å’Œä¸ªå€¼é¢„æµ‹ç½®ä¿¡å¸¦ï¼Œæ˜¯å¯¹é¢„æµ‹å¯ä¿¡åº¦çš„å½¢è±¡è¡¨è¾¾ã€‚

- ï¼ˆåŒç­‰æ¡ä»¶ä¸‹ï¼‰å‡å€¼é¢„æµ‹æ¯”ä¸ªå€¼é¢„æµ‹æ›´å‡†ç¡®ï¼ˆç½®ä¿¡å¸¦å®½çª„ï¼‰


**è¯¾å ‚æ€è€ƒ**ï¼š

- åŒæ ·æ˜¯95%ç½®ä¿¡åº¦åŒºé—´ï¼Œä¸¤ä¸ªäººçš„è®¤è¯†æ˜¯ä¸€æ ·çš„ä¹ˆï¼Ÿ

**è¯¾åä½œä¸š**ï¼šå·¥èµ„ä¸æ•™è‚²æ¡ˆä¾‹æ‰©å±•

- è¯·è®¡ç®—ç½®ä¿¡åº¦
$100(1âˆ’\alpha)=95\%$ä¸‹ï¼Œ
$X_0=20$æ—¶å‡å€¼çš„ç½®ä¿¡åŒºé—´ã€‚
ä¸
$100(1âˆ’\alpha)=90\%$æ—¶ç›¸æ¯”ï¼Œæœ‰ä»€ä¹ˆå·®å¼‚ï¼Ÿ

- 99%æ›´å€¼å¾—å¯ä¿¡ä¹ˆï¼Ÿ

---
layout: false
class: center, middle, duke-softblue,hide_logo
name: report

# 5.7 å›å½’æŠ¥å‘Šè§£è¯»

### æ–¹ç¨‹è¡¨è¾¾å¼

### è¡¨æ ¼è¡¨è¾¾å¼

### ç»Ÿè®¡è½¯ä»¶

---
layout: true

<div class="my-header-h2"></div>

<div class="watermark1"></div>

<div class="watermark2"></div>

<div class="watermark3"></div>

<div class="my-footer"><span>huhuaping@  &emsp;&emsp; <a href="#chapter"> ç¬¬05ç«  ç›¸å…³å’Œå›å½’åˆ†æ </a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
<a href="#report"> 5.7 å›å½’æŠ¥å‘Šè§£è¯» </a> </span></div>

---

## å›å½’åˆ†æçš„å½¢å¼

**è¯¾ç¨‹è¦æ±‚**ï¼šä¼šç†Ÿç»ƒã€æ­£ç¡®é˜…è¯»ç»Ÿè®¡è½¯ä»¶ç»™å‡ºçš„å„ç±»åˆ†ææŠ¥å‘Šï¼Œç†è§£å…¶ä¸­çš„å…³é”®ä¿¡æ¯å’Œå†…æ¶µã€‚è¿™äº›åˆ†ææŠ¥å‘ŠåŒ…æ‹¬ï¼šä¼ ç»Ÿçš„å¤šå…ƒå›å½’åˆ†ææŠ¥å‘Šï¼›ä»¥åŠå„ç§è®¡é‡æ£€éªŒçš„è¾…åŠ©åˆ†ææŠ¥å‘Šï¼ˆå¦‚å¼‚æ–¹å·®whiteæ£€éªŒæŠ¥å‘Šï¼‰ç­‰ã€‚

æ ¹æ®ç»Ÿè®¡è½¯ä»¶çš„ä¸åŒï¼ˆ`stata`ï¼›`Eview`ï¼›`R`ï¼›`Excel` â€¦â€¦ï¼‰ï¼Œå„ç§åˆ†ææŠ¥å‘Šå‘ˆç°å½¢å¼ç•¥æœ‰å·®å¼‚ï¼Œä½†åŸºæœ¬è¦ç´ å’Œä¿¡æ¯éƒ½å¤§æŠµä¸€è‡´ã€‚

ç»™å®šå¦‚ä¸‹ä¸€å…ƒå›å½’æ¨¡å‹ï¼š

$$Y_i = \beta_1 + \beta_2X_i +u_i$$

---

## å›å½’åˆ†æçš„å½¢å¼ï¼ˆå¤šè¡Œæ–¹ç¨‹è¡¨è¾¾æ³•ï¼‰

**å½¢å¼1ï¼šå¤šè¡Œæ–¹ç¨‹è¡¨è¾¾æ³•**ï¼ˆæ•´ç†å¥½çš„**ç²¾ç‚¼æŠ¥å‘Š**ï¼‰ï¼šæ ¹æ®ç»Ÿè®¡è½¯ä»¶çš„åŸå§‹æŠ¥å‘Šï¼Œå¾€å¾€æ˜¯é€‰å–æœ€å…³é”®çš„ä¿¡æ¯ï¼Œç»è¿‡æ•´ç†å¹¶ä»¥å¤šè¡Œ**æ ·æœ¬å›å½’æ–¹ç¨‹**ï¼ˆSRFï¼‰çš„å½¢å¼å‘ˆç°ï¼Œ**ç²¾ç‚¼æŠ¥å‘Š**çš„å½¢å¼ä¸€èˆ¬ä¸ºï¼š

```{r, results="asis"}
mod_wage <- "Y~X"
fun_report_eq(lm.mod = mod_wage, lm.dt = data_wage,
              lm.n = 3)
```

--

- ç¬¬1è¡Œè¡¨ç¤ºæ ·æœ¬å›å½’å‡½æ•°ï¼ˆå›å½’ç³»æ•°ï¼‰

- ç¬¬2è¡Œ(t)è¡¨ç¤ºå›å½’ç³»æ•°å¯¹åº”çš„**æ ·æœ¬tç»Ÿè®¡é‡**ï¼ˆ
$t^{\ast}_{\hat{\beta}_i},i \in 1,2,\cdots, k$ï¼‰

- ç¬¬3è¡Œ(se)è¡¨ç¤ºå›å½’ç³»æ•°å¯¹åº”çš„**æ ·æœ¬æ ‡å‡†è¯¯å·®**ï¼ˆ
$S_{\hat{\beta}_i},i \in 1,2,\cdots, k$ï¼‰

- ç¬¬4è¡Œ(fitness)è¡¨ç¤ºå›å½’æ¨¡å‹**æ‹Ÿåˆæƒ…å†µ**å’Œ**ç»Ÿè®¡æ£€éªŒ**çš„ç®€è¦ä¿¡æ¯ï¼Œå…¶ä¸­
$R^2$è¡¨ç¤º**åˆ¤å®šç³»æ•°**ï¼Œ
$\bar{R}^2$è¡¨ç¤º**è°ƒæ•´åˆ¤å®šç³»æ•°**ï¼ŒFè¡¨ç¤ºæ¨¡å‹æ•´ä½“æ˜¾è‘—æ€§æ£€éªŒä¸­çš„**æ ·æœ¬Fç»Ÿè®¡é‡å€¼**ï¼ˆ
$F^{\ast}$ï¼‰,pè¡¨ç¤ºæ ·æœ¬Fç»Ÿè®¡é‡å€¼å¯¹åº”çš„æ¦‚ç‡å€¼ã€‚

---

## å›å½’åˆ†æçš„å½¢å¼ï¼ˆè¡¨æ ¼åˆ—ç¤ºæ³•ï¼‰

**å½¢å¼2ï¼šè¡¨æ ¼åˆ—ç¤ºæ³•**ï¼ˆæ•´ç†å¥½çš„**ç²¾ç‚¼æŠ¥å‘Š**ï¼‰ï¼šæ ¹æ®ç»Ÿè®¡è½¯ä»¶çš„åŸå§‹æŠ¥å‘Šï¼Œå¾€å¾€æ˜¯é€‰å–æœ€å…³é”®çš„ä¿¡æ¯ï¼Œç»è¿‡æ•´ç†ä»¥è¡¨æ ¼å½¢å¼å‘ˆç°ï¼Œ**è¡¨æ ¼åˆ—ç¤ºæ³•**çš„å½¢å¼å‘ˆç°ä¸ºï¼š

```{r demo-kable}
require("broom")
out_lm <- summary(lm(mod_wage,data_wage))
kable(broom::tidy(lm(mod_wage,data_wage)), align= "c")
```

--

- **ç¬¬1åˆ—**ï¼š`term`è¡¨ç¤ºå›å½’æ¨¡å‹ä¸­åŒ…å«çš„å˜é‡ï¼Œä¹Ÿå³
$X_{2i},X_{3i},\cdots,X_{ki}$ï¼Œå…¶ä¸­**æˆªè·é¡¹**é»˜è®¤ä¸º`(Intercept)`ã€‚

- **ç¬¬2åˆ—**ï¼š`estimate`è¡¨ç¤ºå›å½’ç³»æ•°çš„ä¼°è®¡å€¼ï¼Œä¹Ÿå³
$\hat{\beta}_1,\hat{\beta}_2, \cdots, \hat{\beta}_k$ã€‚

- **ç¬¬3åˆ—**ï¼š`std.error`è¡¨ç¤ºå›å½’ç³»æ•°å¯¹åº”çš„**æ ·æœ¬æ ‡å‡†è¯¯å·®**ï¼Œä¹Ÿå³
$S_{\hat{\beta}_i},i \in 1,2,\cdots, k$ã€‚

- **ç¬¬4åˆ—**ï¼š`statistic`è¡¨ç¤ºå›å½’ç³»æ•°å¯¹åº”çš„**æ ·æœ¬tç»Ÿè®¡é‡**ï¼Œä¹Ÿå³
$t^{\ast}_{\hat{\beta}_i},i \in 1,2,\cdots, k$

- **ç¬¬5åˆ—**ï¼š`p.value`è¡¨ç¤ºå›å½’ç³»æ•°**æ ·æœ¬tç»Ÿè®¡é‡**å¯¹åº”çš„æ¦‚ç‡å€¼ï¼Œä¹Ÿå³
$Pr(t = t^{\ast}_{\hat{\beta}_i})=p$

---

### ï¼ˆç¤ºä¾‹ï¼‰Excelè½¯ä»¶åŸå§‹æŠ¥å‘Šï¼šå…¨è²Œ

**å½¢å¼3ï¼šåŸå§‹æŠ¥å‘Š**ï¼šåˆ†æè½¯ä»¶å¦‚`EViews`ã€`R`ã€`STATA`ã€`Excel`ç­‰ç›´æ¥è‡ªåŠ¨ç”Ÿæˆçš„å¤šå…ƒå›å½’åˆ†ææŠ¥å‘Šã€‚`Excel`è½¯ä»¶åŸå§‹åˆ†ææŠ¥å‘Šå½¢å¼å¦‚ä¸‹ï¼š

```{r}
include_graphics("../pic/chpt05-reg-excel-report-view.png")
```

---

### ï¼ˆç¤ºä¾‹ï¼‰Excelè½¯ä»¶åŸå§‹æŠ¥å‘Šï¼šå‚æ•°ä¼°è®¡

```{r}
include_graphics("../pic/chpt05-reg-excel-report-estimate.png")
```

---

### ï¼ˆç¤ºä¾‹ï¼‰Excelè½¯ä»¶åŸå§‹æŠ¥å‘Šï¼šæ‹Ÿåˆä¼˜åº¦

```{r}
include_graphics("../pic/chpt05-reg-excel-report-goodness.png")
```

---

### ï¼ˆç¤ºä¾‹ï¼‰Excelè½¯ä»¶åŸå§‹æŠ¥å‘Šï¼šæ–¹å·®åˆ†è§£

```{r}
include_graphics("../pic/chpt05-reg-excel-report-anova.png")
```

---

### ï¼ˆç¤ºä¾‹ï¼‰Excelè½¯ä»¶åŸå§‹æŠ¥å‘Šï¼šæ®‹å·®è¡¨

```{r}
include_graphics("../pic/chpt05-reg-excel-report-ei.png")
```

---

### ï¼ˆç¤ºä¾‹ï¼‰Excelè½¯ä»¶åŸå§‹æŠ¥å‘Šï¼šæ®‹å·®å›¾

```{r}
include_graphics("../pic/chpt05-reg-excel-residual.png")
```


---

### å›å½’åˆ†æçš„å½¢å¼ï¼ˆEViewsè½¯ä»¶åŸå§‹æŠ¥å‘Šï¼‰

**å½¢å¼3ï¼šåŸå§‹æŠ¥å‘Š**ï¼šåˆ†æè½¯ä»¶å¦‚`EViews`ã€`R`ã€`STATA`ç­‰ç›´æ¥è‡ªåŠ¨ç”Ÿæˆçš„å¤šå…ƒå›å½’åˆ†ææŠ¥å‘Šã€‚`EViews`è½¯ä»¶åŸå§‹åˆ†ææŠ¥å‘Šå½¢å¼å¦‚ä¸‹ï¼š**æŠ¬å¤´åŒºåŸŸ**

.pull-left[
```{r}
include_graphics("../pic/extra/chpt4-eq-report-EViews.png")
```
]

--

.pull-right[

- `Dependent Variable: Y`ï¼šå› å˜é‡

- `Method: Least Squares`ï¼šåˆ†ææ–¹æ³•

- `Date: 03/09/19  Time: 10:55`ï¼šåˆ†æçš„æ—¶é—´

- `Sample: 1 13`ï¼šæ ·æœ¬èŒƒå›´

- `Included observations: 13`ï¼šæ ·æœ¬æ•°n

]

---

### å›å½’åˆ†æçš„å½¢å¼ï¼ˆEViewsè½¯ä»¶åŸå§‹æŠ¥å‘Šï¼‰

**å½¢å¼3ï¼šåŸå§‹æŠ¥å‘Š**ï¼šåˆ†æè½¯ä»¶å¦‚`EViews`ã€`R`ã€`STATA`ç­‰ç›´æ¥è‡ªåŠ¨ç”Ÿæˆçš„å¤šå…ƒå›å½’åˆ†ææŠ¥å‘Šã€‚`EViews`è½¯ä»¶åŸå§‹åˆ†ææŠ¥å‘Šå½¢å¼å¦‚ä¸‹ï¼š**ä¸‰çº¿è¡¨åŒºåŸŸ**

.pull-left[
```{r}
include_graphics("../pic/extra/chpt4-eq-report-EViews.png")
```
]

--

.pull-right[

- **ç¬¬1åˆ—**ï¼š`Variable`è¡¨ç¤ºæ¨¡å‹åŒ…å«çš„å˜é‡ï¼Œ
$X_{2i},X_{3i},\cdots,X_{ki}$ï¼Œå…¶ä¸­**æˆªè·é¡¹**é»˜è®¤ä¸º`C`ã€‚

- **ç¬¬2åˆ—**ï¼š`Coefficient`å›å½’ç³»æ•°ï¼Œä¹Ÿå³
$\hat{\beta}_1,\hat{\beta}_2, \cdots, \hat{\beta}_k$ï¼›

- **ç¬¬3åˆ—**ï¼š`Std. Error`å›å½’ç³»æ•°çš„æ ·æœ¬æ ‡å‡†è¯¯å·®ï¼Œä¹Ÿå³ä¹Ÿå³
$S_{\hat{\beta}_i},i \in 1,2,\cdots, k$ã€‚

- **ç¬¬4åˆ—**ï¼š`t-Statistic`è¡¨ç¤ºå›å½’ç³»æ•°å¯¹åº”çš„**æ ·æœ¬tç»Ÿè®¡é‡**ï¼Œä¹Ÿå³
$t^{\ast}_{\hat{\beta}_i},i \in 1,2,\cdots, k$ï¼›

- **ç¬¬5åˆ—**ï¼š`Prob.`è¡¨ç¤ºå›å½’ç³»æ•°**æ ·æœ¬tç»Ÿè®¡é‡**å¯¹åº”çš„æ¦‚ç‡å€¼ï¼Œä¹Ÿå³
$Pr(t = t^{\ast}_{\hat{\beta}_i})=p$

]

---

### å›å½’åˆ†æçš„å½¢å¼ï¼ˆEViewsè½¯ä»¶åŸå§‹æŠ¥å‘Šï¼‰

**å½¢å¼3ï¼šåŸå§‹æŠ¥å‘Š**ï¼šåˆ†æè½¯ä»¶å¦‚`EViews`ã€`R`ã€`STATA`ç­‰ç›´æ¥è‡ªåŠ¨ç”Ÿæˆçš„å¤šå…ƒå›å½’åˆ†ææŠ¥å‘Šã€‚`EViews`è½¯ä»¶åŸå§‹åˆ†ææŠ¥å‘Šå½¢å¼å¦‚ä¸‹ï¼š**æŒ‡æ ‡å€¼åŒºåŸŸï¼ˆå·¦ï¼‰**

.pull-left[
```{r}
include_graphics("../pic/extra/chpt4-eq-report-EViews.png")
```
]

--

.pull-right[

- `R-squared`ï¼šå›å½’æ¨¡å‹**åˆ¤å®šç³»æ•°**
$R^2$ã€‚

- `Adjusted R-squared`ï¼šå›å½’æ¨¡å‹**è°ƒæ•´åˆ¤å®šç³»æ•°**
$\bar{R}^2$ã€‚

- `S.E. of regression`ï¼šå›å½’æ¨¡å‹çš„**å›å½’è¯¯å·®æ ‡å‡†å·®**
$\hat{\sigma}$ã€‚

- `Sum squared resid`ï¼šå›å½’æ¨¡å‹çš„**æ®‹å·®å¹³æ–¹å’ŒRSS**
$RSS=\sum{e_i^2}$ã€‚

- `Log likelihood`ï¼šå›å½’æ¨¡å‹çš„**å¯¹æ•°ä¼¼ç„¶å€¼**ã€‚

- `F-statistic`ï¼šå›å½’æ¨¡å‹æ•´ä½“æ˜¾è‘—æ€§çš„**æ ·æœ¬Fç»Ÿè®¡é‡**
$F^{\ast}$ã€‚

- `Prob(F-statistic)`ï¼šå›å½’æ¨¡å‹æ•´ä½“æ˜¾è‘—æ€§çš„æ ·æœ¬Fç»Ÿè®¡é‡å¯¹åº”çš„**æ¦‚ç‡å€¼p**ã€‚

]

---

### å›å½’åˆ†æçš„å½¢å¼ï¼ˆEViewsè½¯ä»¶åŸå§‹æŠ¥å‘Šï¼‰

**å½¢å¼3ï¼šåŸå§‹æŠ¥å‘Š**ï¼šåˆ†æè½¯ä»¶å¦‚`EViews`ã€`R`ã€`STATA`ç­‰ç›´æ¥è‡ªåŠ¨ç”Ÿæˆçš„å¤šå…ƒå›å½’åˆ†ææŠ¥å‘Šã€‚`EViews`è½¯ä»¶åŸå§‹åˆ†ææŠ¥å‘Šå½¢å¼å¦‚ä¸‹ï¼š**æŒ‡æ ‡å€¼åŒºåŸŸï¼ˆå³ï¼‰**

.pull-left[
```{r}
include_graphics("../pic/extra/chpt4-eq-report-EViews.png")
```
]

--

.pull-right[

- `Mean dependent var`ï¼šYçš„**å‡å€¼**
$\bar{Y}$ã€‚

- `S.D. dependent var`ï¼šYçš„**æ ·æœ¬æ ‡å‡†å·®**
$S_{Y}$ã€‚

- `Akaike info criterion`ï¼šå›å½’æ¨¡å‹çš„**AICä¿¡æ¯å‡†åˆ™**ã€‚

- `Schwarz criterion`ï¼šå›å½’æ¨¡å‹çš„**Schwarzå‡†åˆ™**ã€‚

- `Hannan-Quinn criter.	`ï¼šå›å½’æ¨¡å‹çš„**Hannan-Quinnå‡†åˆ™**ã€‚

- `Durbin-Watson stat`ï¼šå›å½’æ¨¡å‹çš„**å¾·å®¾æ²ƒæ£®ç»Ÿè®¡é‡d**ã€‚

]

---

## å›å½’åˆ†æçš„å½¢å¼ï¼ˆRè½¯ä»¶åŸå§‹æŠ¥å‘Šï¼‰

**å½¢å¼4ï¼šåŸå§‹æŠ¥å‘Š**ï¼šåˆ†æè½¯ä»¶å¦‚`EViews`ã€`R`ã€`STATA`ç­‰ç›´æ¥è‡ªåŠ¨ç”Ÿæˆçš„å¤šå…ƒå›å½’åˆ†ææŠ¥å‘Šã€‚`R`è½¯ä»¶åŸå§‹åˆ†ææŠ¥å‘Šå½¢å¼å¦‚ä¸‹ï¼š

```{r, comment=""}
out_lm

```


---
layout:false
background-image: url("../pic/thank-you-gif-funny-fan.gif")
class: inverse,center
# æœ¬ç« ç»“æŸ

