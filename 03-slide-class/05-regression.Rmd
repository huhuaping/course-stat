---
output:
  xaringan::moon_reader:
    seal: false
    lib_dir: libs
    css:
      - default
      - ../mycss/my-theme.css 
      - ../mycss/my-font.css
      - ../mycss/my-custom-for-video-roomy.css
      - ../mycss/text-box.css
      - duke-blue
      - hygge-duke
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
---
background-image: url("../pic/slide-front-page.jpg")
class: center,middle

# ç»Ÿè®¡å­¦åŸç†(Statistic)

<!---    chakra: libs/remark-latest.min.js --->

### èƒ¡åå¹³

### è¥¿åŒ—å†œæ—ç§‘æŠ€å¤§å­¦

### ç»æµç®¡ç†å­¦é™¢æ•°é‡ç»æµæ•™ç ”å®¤

### huhuaping01@hotmail.com

### `r Sys.Date()`

```{r global_options, echo=F,message=FALSE,warning=F}
source("../R/set-global.R")
source("../R/external-math-equation.R")
options(width = 70)
#source("../R/xaringan-chromote-print.R")
```


```{r ex-math-eq}
source("../R/external-math-equation.R")
```


```{r xaringan-logo, echo=FALSE}
require('xaringanExtra')

xaringanExtra::use_tachyons()

xaringanExtra::use_panelset()

xaringanExtra::use_logo(
  image_url = "../pic/logo/nwafu-logo-circle-wb.png",
  height = '70px',
  position = xaringanExtra::css_position(top='0.2em',left="1em")
)
```

---
class: center, middle, duke-orange,hide_logo
name:chapter

# ç¬¬äº”ç«  ç›¸å…³å’Œå›å½’åˆ†æ


### [5.1 å˜é‡é—´å…³ç³»çš„åº¦é‡](#measure)

### [5.2 ä¸€å…ƒçº¿æ€§å›å½’](#regression)

### [5.3 ä¼°è®¡å’Œé¢„æµ‹](#estimation)

### [5.4 æ®‹å·®åˆ†æ](#residual)



---
layout: false
class: center, middle, duke-softblue,hide_logo
name: absolute

# 5.1 å˜é‡é—´å…³ç³»çš„åº¦é‡

### å˜é‡é—´çš„å…³ç³»

### ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦

### ç›¸å…³ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒ

---
layout: true

<div class="my-header-h2"></div>

<div class="watermark1"></div>

<div class="watermark2"></div>

<div class="watermark3"></div>

<div class="my-footer"><span>huhuaping@  &emsp;&emsp; <a href="#chapter"> ç¬¬05ç«  ç›¸å…³å’Œå›å½’åˆ†æ </a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
<a href="#absolute"> 5.1 å˜é‡é—´å…³ç³»çš„åº¦é‡ </a> </span></div> 

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šç»æµå­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-1-econ.png")
```

> â€œæˆ‘ä»¬æ•°æ®ä¸å°‘ï¼Œåšäº†å¾ˆä¸¥æ ¼çš„å›å½’ï¼Œä½†å¼‚å¸¸å€¼ç•¥å¤šç•¥å¤šï¼Œç¬¦åˆç†è®ºçš„æ•°å€¼åè€Œéš¾æ‰¾â€¦â€¦â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šé‡‘èå­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-2-fin.png")
```

> â€œæˆ‘ä»¬çš„æ•°æ®å¤šå¦‚ç‰›æ¯›ï¼Œæ— å­”ä¸å…¥ã€‚å³ä½¿åšå®Œå›å½’ï¼Œä¹Ÿä¼šå‘ç°å¼‚å¸¸å€¼å’Œç¬¦åˆç†è®ºçš„æ•°å€¼å¤šå¾—ä¸å¿ç›´è§†ã€‚â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šåœŸæœ¨å·¥ç¨‹ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-3-engine.png")
```

> â€œæˆ‘ä»¬å¾—è¦è®¾è®¡ä½™é‡ï¼Œæ‰€ä»¥ç†è®ºè®¾è®¡å¾—è¿œé«˜äºå®é™…æ‰¿å—â€¦â€¦â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šç‰©ç†å­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-4-physics.png")
```

> â€œæˆ‘ä»¬çš„ç†è®ºå’Œæ•°æ®ä¸¥ä¸åˆç¼ï¼Œbingoï¼â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šç¯å¢ƒç§‘å­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-5-eniron.png")
```

> â€œæˆ‘ä»¬çš„ç†è®ºå’Œæ•°æ®å¤§è‡´å»åˆï¼Œå°±æ˜¯â€¦â€¦åº”ç”¨èŒƒå›´æœ‰ç‚¹è›‹ç–¼ã€‚â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šå†å²å­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-6-history.png")
```

> â€œæ•°æ®è™½ç„¶å¾ˆå¤šï¼Œå¯æˆ‘ä»¬èƒ½ç”¨ç†è®ºæŠŠä»–ä»¬ç»Ÿç»Ÿè¿èµ·æ¥ï¼â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šæ”¿æ²»å­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-7-politics.png")
```

> â€œä¸–ç•Œå¤§åŠ¿ä¸€æ—¥ä¸‰å˜ï¼Œå°½ç®¡æˆ‘ä»¬æ•°æ®ä¸å°‘ï¼Œå¯â€¦â€¦æˆ‘ä»¬çš„ç†è®ºè·Ÿæ•°æ®è¶‹åŠ¿æ˜¯åç€æ¥çš„â€¦â€¦â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šç¤¾ä¼šå­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-8-sociology.png")
```

> â€œå­¦æµ·æ— æ¶¯è‹¦ä½œèˆŸã€‚é‚£ä¹ˆå¤šæ•°æ®ï¼Œé‚£ä¹ˆå¤šç†è®ºï¼Œæ…¢æ…¢å­¦ï¼Œæ©â€¦â€¦â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šæ•°å­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-9-math.png")
```

> â€œæ•°æ®å¾ˆå°‘ï¼Œä½†èƒ½å»ºç«‹ç†è®ºï½â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šæ–°é—»å­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-10-journalism.png")
```

> ï¼ˆç¤ºä¾‹ï¼‰â€œåªæœ‰ä¸€ä¸ªæ•°æ®ï¼Œä¹Ÿèƒ½å»ºç«‹ç†è®ºâ€¦â€¦â€

---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šå“²å­¦ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-11-philosophy.png")
```

> â€œæ²¡æœ‰æ•°æ®ï¼Œä¾ç„¶å»ºç«‹ç†è®ºâ€¦â€¦â€


---

### ï¼ˆç¤ºä¾‹ï¼‰å˜é‡é—´çš„å…³ç³»ï¼šæ–‡å­¦æ‰¹è¯„ä¸“ä¸šè§£è¯»

```{r, out.width= "60%"}
include_graphics("../pic/chpt05-intro-12-literary.png")
```

> â€œå¦‚å›¾æ‰€ç¤ºï¼Œä½ æ‡‚çš„â€¦â€¦â€

---

## å˜é‡é—´çš„å…³ç³»ï¼šå‡½æ•°å…³ç³»

ä¸¤ä¸ªå˜é‡è‹¥å­˜åœ¨æ˜¯ä¸€ä¸€å¯¹åº”çš„ç¡®å®šå…³ç³»ï¼Œåˆ™ç§°ä¹‹ä¸ºäºŒè€…å…·æœ‰**å‡½æ•°å…³ç³»**ã€‚

```{block, type = "notes", echo =T}

è®¾æœ‰ä¸¤ä¸ªå˜é‡
$X$å’Œ 
$Y$ï¼Œå˜é‡
$Y$éšå˜é‡
$X$ä¸€èµ·å˜åŒ–ï¼Œå¹¶å®Œå…¨ä¾èµ–äº
$X$ï¼Œå½“å˜é‡
$X$å–æŸä¸ªæ•°å€¼æ—¶ï¼Œ 
$Y$ä¾ç¡®å®šçš„å…³ç³»å–ç›¸åº”çš„å€¼ï¼Œåˆ™ç§°
$Y$æ˜¯
$X$çš„å‡½æ•°ï¼Œè®°ä¸º
$Y = f(X)$ï¼Œå…¶ä¸­
$X$ç§°ä¸ºè‡ªå˜é‡ï¼Œ
$Y$ç§°ä¸ºå› å˜é‡ã€‚

```



> ä»**å‡ ä½•å­¦**è§’åº¦æ¥çœ‹ï¼Œæ•°æ®é›†å„è§‚æµ‹ç‚¹ä¼šè½åœ¨ä¸€æ¡æ›²çº¿ä¸Šã€‚

---

### ï¼ˆç¤ºä¾‹ï¼‰å‡½æ•°å…³ç³»

æŸç§å•†å“çš„é”€å”®é¢
$Y$ä¸é”€å”®é‡
$X$ä¹‹é—´çš„å…³ç³»å¯è¡¨ç¤ºä¸º(
$P$ä¸ºå•ä»·)ï¼š

$$Y_i = P_i\cdot X_i$$

åœ†çš„é¢ç§¯
$S$ä¸åŠå¾„
$R$ä¹‹é—´çš„å…³ç³»å¯è¡¨ç¤ºä¸ºï¼š

$$S = \pi R^2$$

ä¼ä¸šçš„åŸææ–™æ¶ˆè€—é¢
$Y$ä¸äº§é‡
$X1$ ã€å•ä½äº§é‡æ¶ˆè€—
$X2$ ã€åŸææ–™ä»·æ ¼
$X3$ä¹‹é—´çš„å…³ç³»å¯è¡¨ç¤ºä¸ºï¼š

$$Y = X_1 \cdot X_2 \cdot X_3$$

---

## å˜é‡é—´çš„å…³ç³»ï¼šç›¸å…³å…³ç³»(correlation)

```{r, out.width= "90%", fig.cap="ç›¸å…³å…³ç³»çš„ç±»å‹"}
include_graphics("../pic/chpt05-measure-rel.png")
```


---

### ï¼ˆç¤ºä¾‹ï¼‰ç›¸å…³å…³ç³»

```{block, type = "case", echo = T}
- çˆ¶äº²èº«é«˜
$Y$ä¸å­å¥³èº«é«˜
$X$ä¹‹é—´çš„å…³ç³»

- æ”¶å…¥æ°´å¹³
$Y$ä¸å—æ•™è‚²ç¨‹åº¦
$X$ä¹‹é—´çš„å…³ç³»

- ç²®é£Ÿå•ä½é¢ç§¯äº§é‡
$Y$ä¸æ–½è‚¥é‡
$X1$ ã€é™é›¨é‡
$X2$ã€æ¸©åº¦
$X3$ä¹‹é—´çš„å…³ç³»

- å•†å“çš„æ¶ˆè´¹é‡
$Y$ä¸å±…æ°‘æ”¶å…¥
$X$ä¹‹é—´çš„å…³ç³»

- å•†å“é”€å”®é¢
$Y$ä¸å¹¿å‘Šè´¹æ”¯å‡º
$X$ä¹‹é—´çš„å…³ç³»

```


---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šé—®é¢˜ä¸å‡å®š

ç›¸å…³åˆ†æè¦è§£å†³çš„é—®é¢˜ï¼š

- å˜é‡ä¹‹é—´æ˜¯å¦å­˜åœ¨å…³ç³»ï¼Ÿ

- å¦‚æœå­˜åœ¨å…³ç³»ï¼Œå®ƒä»¬ä¹‹é—´æ˜¯ä»€ä¹ˆæ ·çš„å…³ç³»ï¼Ÿ

- å˜é‡ä¹‹é—´çš„å…³ç³»å¼ºåº¦å¦‚ä½•ï¼Ÿ

- æ ·æœ¬æ‰€åæ˜ çš„å˜é‡ä¹‹é—´çš„å…³ç³»èƒ½å¦ä»£è¡¨æ€»ä½“å˜é‡ä¹‹é—´çš„å…³ç³»ï¼Ÿ

ç›¸å…³åˆ†æä¸­çš„æ€»ä½“å‡å®šï¼š

- ä¸¤ä¸ªå˜é‡ä¹‹é—´æ˜¯çº¿æ€§å…³ç³»

- ä¸¤ä¸ªå˜é‡éƒ½æ˜¯éšæœºå˜é‡

---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šæ•£ç‚¹å›¾

.fl.w-50[

```{r}
include_graphics("../pic/chpt05-scatter-p0.png")
```
]

--

.fl.w-50[

```{r}
include_graphics("../pic/chpt05-scatter-p1.png")
```
]

---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šæ•£ç‚¹å›¾


.fl.w-50[

```{r}
include_graphics("../pic/chpt05-scatter-n0.png")
```

]

--

.fl.w-50[

```{r}
include_graphics("../pic/chpt05-scatter-n1.png")
```

]

---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šæ•£ç‚¹å›¾

.fl.w-50[

```{r}
include_graphics("../pic/chpt05-scatter-nonline.png")
```

]

--

.fl.w-50[

```{r}
include_graphics("../pic/chpt05-scatter-independence.png")
```

]

---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šæ•£ç‚¹å›¾

```{r, out.width="90%"}
include_graphics("../pic/chpt05-scatter-all-cases.png")
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ä¸¤ç±»æ²¹ä»·çš„æ•£ç‚¹å›¾

```{r, out.width="90%"}
include_graphics("../pic/chpt05-scatter-oil-price.png")
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ä¼ æŸ“ç—…ä¸è®¤çŸ¥æ°´å¹³çš„æ•£ç‚¹å›¾

```{r, out.width="80%"}
include_graphics("../pic/chpt05-scatter-disease.png")
```

---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šç›¸å…³ç³»æ•°

**ç›¸å…³ç³»æ•°**(correlation coefficient)ï¼šæ˜¯åº¦é‡å˜é‡ä¹‹é—´å…³ç³»å¼ºåº¦çš„ä¸€ä¸ªç»Ÿè®¡é‡ã€‚

- å®ƒæ˜¯å¯¹ä¸¤ä¸ªå˜é‡ä¹‹é—´çº¿æ€§ç›¸å…³å¼ºåº¦çš„ä¸€ç§åº¦é‡ã€‚

- ä¸€èˆ¬ç§°ä¸º**ç®€å•ç›¸å…³ç³»æ•°**ï¼Œä¹Ÿç§°ä¸º**çº¿æ€§ç›¸å…³ç³»æ•°**(linear correlation coefficient) ã€‚

- æˆ–ç§°ä¸º**Pearsonç›¸å…³ç³»æ•°**(Pearsonâ€™s correlation coefficient) ã€‚

ç›¸å…³ç³»æ•°è®°å·è¡¨è¾¾ï¼š

- è‹¥ç›¸å…³ç³»æ•°æ˜¯æ ¹æ®æ€»ä½“å…¨éƒ¨æ•°æ®è®¡ç®—çš„ï¼Œç§°ä¸ºæ€»ä½“ç›¸å…³ç³»æ•°ï¼Œè®°ä¸º
$\rho$ã€‚

- è‹¥æ˜¯æ ¹æ®æ ·æœ¬æ•°æ®è®¡ç®—çš„ï¼Œåˆ™ç§°ä¸ºæ ·æœ¬ç›¸å…³ç³»æ•°ï¼Œç®€ç§°ä¸ºç›¸å…³ç³»æ•°ï¼Œè®°ä¸º
$r$ã€‚


---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šè®¡ç®—å…¬å¼

.mb1.bg-light-blue[
ç®€å•ç›¸å…³ç³»æ•°çš„å¤§FFè®¡ç®—å…¬å¼ï¼š

$$\begin{align}
r & = \frac{n \sum X_i Y_i -\sum X_i \sum Y_i}{\sqrt{n \sum X_i^{2}-\left(\sum X_i\right)^{2}} \cdot \sqrt{n \sum Y_i^{2}-\left(\sum Y_i\right)^{2}}}
\end{align}$$

]

.mb1.bg-light-blue[
ç®€å•ç›¸å…³ç³»æ•°çš„å°ffè®¡ç®—å…¬å¼ï¼š

$$\begin{align}
r & = \frac{ \sum{\left( (X_i - \overline{X})(Y_i - \overline{Y})\right ) } }{\sqrt{\sum{(X_i - \overline{X})^2 }\sum{(Y_i - \overline{Y})^2}}} 
= \frac{S S_{XY}}{\sqrt{S S_{XX}} \sqrt{S S_{YY}}}
= \frac{\sum{x_iy_i}}{\sqrt{\sum{x_i^2}\sum{y_i^2}}}

\end{align}$$

]


.mb1.bg-lightest-blue[

å…¶ä¸­ï¼š

$$\begin{align}
S S_{X X} =\sum_{i=1}^{n}\left(X_{i}-\overline{X}\right)^{2}  ;\quad 
S S_{Y Y} =\sum_{i=1}^{n}\left(Y_{i}-\overline{Y}\right)^{2}  ;\quad 
S S_{X Y}=\sum_{i=1}^{n}\left(X_{i}-\overline{X}\right)\left(Y_{i}-\overline{Y}\right)
\end{align}$$

]


---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šç‰¹å¾

ç®€å•ç›¸å…³ç³»æ•°çš„ç‰¹å¾ï¼š

**æ€§è´¨1**ï¼š
$r$çš„å–å€¼èŒƒå›´æ˜¯
$[-1,1]$ï¼Œ
$|r|$è¶Šè¶‹äº1è¡¨ç¤ºç›¸å…³å…³ç³»è¶Šå¼ºï¼›
$|r|$è¶Šè¶‹äº0è¡¨ç¤ºç›¸å…³å…³ç³»è¶Šå¼±ã€‚


- å¦‚æœ
$|r|=1$ï¼Œä¸ºå®Œå…¨ç›¸å…³ã€‚å…¶ä¸­
$r =1$ï¼Œä¸ºå®Œå…¨æ­£ç›¸å…³ï¼›
$r =-1$ï¼Œä¸ºå®Œå…¨è´Ÿæ­£ç›¸å…³

- å¦‚æœ
$r = 0$ï¼Œä¸å­˜åœ¨çº¿æ€§ç›¸å…³å…³ç³»

- å¦‚æœ
$-1<r<0$ï¼Œä¸ºè´Ÿç›¸å…³ï¼›å¦‚æœ
$0<r<1$ï¼Œä¸ºæ­£ç›¸å…³ã€‚


**æ€§è´¨2**ï¼šrå…·æœ‰å¯¹ç§°æ€§ã€‚å³
$X$ä¸
$Y$ä¹‹é—´çš„ç›¸å…³ç³»æ•°å’Œ
$Y$ä¸
$X$ä¹‹é—´çš„ç›¸å…³ç³»æ•°ç›¸ç­‰ï¼Œå³
$r_{XY}= r_{YX}$ã€‚

---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šç‰¹å¾

ç®€å•ç›¸å…³ç³»æ•°çš„ç‰¹å¾ï¼š

**æ€§è´¨3**ï¼š
$r$æ•°å€¼å¤§å°ä¸
$X$å’Œ
$Y$åŸç‚¹åŠå°ºåº¦æ— å…³ï¼Œå³æ”¹å˜
$X$å’Œ
$Y$çš„æ•°æ®åŸç‚¹åŠè®¡é‡å°ºåº¦ï¼Œå¹¶ä¸æ”¹å˜
$r$æ•°å€¼å¤§å°ã€‚

**æ€§è´¨4**ï¼šä»…ä»…æ˜¯
$X$ä¸
$Y$ä¹‹é—´çº¿æ€§å…³ç³»çš„ä¸€ä¸ªåº¦é‡ï¼Œå®ƒä¸èƒ½ç”¨äºæè¿°éçº¿æ€§å…³ç³»ã€‚è¿™æ„ä¸ºç€ï¼Œ
$r=0$åªè¡¨ç¤ºä¸¤ä¸ªå˜é‡ä¹‹é—´ä¸å­˜åœ¨çº¿æ€§ç›¸å…³å…³ç³»ï¼Œå¹¶ä¸è¯´æ˜å˜é‡ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»

**æ€§è´¨5**ï¼š
$r$è™½ç„¶æ˜¯ä¸¤ä¸ªå˜é‡ä¹‹é—´çº¿æ€§å…³ç³»çš„ä¸€ä¸ªåº¦é‡ï¼Œå´ä¸ä¸€å®šæ„å‘³ç€
$X$ä¸
$Y$ä¸€å®šæœ‰å› æœå…³ç³»ã€‚

---

## ç›¸å…³å…³ç³»çš„æè¿°ä¸æµ‹åº¦ï¼šè§£é‡Š


```{block, type= "fyi", echo =T}

ä¸‹é¢ç»™å‡ºå®è¯ç ”ç©¶æ—¶ï¼Œå¯¹ç›¸å…³ç³»æ•°çš„ç»éªŒè§£é‡Šï¼š

- å½“
$|r|<0.8$æ—¶ï¼Œå¯è§†ä¸ºä¸¤ä¸ªå˜é‡ä¹‹é—´é«˜åº¦ç›¸å…³ã€‚

- å½“
$0.5<|r|<0.8$æ—¶ï¼Œå¯è§†ä¸ºä¸­åº¦ç›¸å…³ã€‚

- å½“
$0.3<|r|<0.5$æ—¶ï¼Œè§†ä¸ºä½åº¦ç›¸å…³ã€‚

- å½“
$|r|<0.3$æ—¶ï¼Œè¯´æ˜ä¸¤ä¸ªå˜é‡ä¹‹é—´çš„ç›¸å…³ç¨‹åº¦æå¼±ï¼Œå¯è§†ä¸ºä¸ç›¸å…³ã€‚

è€Œä¸”ä¸Šè¿°è§£é‡Šå¿…é¡»å»ºç«‹åœ¨å¯¹ç›¸å…³ç³»æ•°çš„æ˜¾è‘—æ€§è¿›è¡Œæ£€éªŒçš„åŸºç¡€ä¹‹ä¸Šã€‚

```



---

## åç›¸å…³ç³»æ•°


**åç›¸å…³ç³»æ•°**ï¼ˆpartial correlation coefficientï¼‰ï¼š
ä¸€ä¸ªä¸ä¾èµ–äº
$X_{2i}$çš„ï¼Œå¯¹
$X_{3i}$å’Œ
$Y_i$çš„å½±å“çš„ä¸€ç§ç›¸å…³ç³»æ•°ã€‚

- ä¿æŒ
$X_{3i}$ä¸å˜ï¼Œ
$Y_i$å’Œ
$X_{2i}$ä¹‹é—´çš„ç›¸å…³ç³»æ•°ï¼š

$$\begin {align} 
r_{12 \cdot 3}=\frac{r_{12}-r_{13} r_{23}}{\sqrt{\left(1-r_{13}^{2}\right)\left(1-r_{23}^{2}\right)}}
\end {align}$$

- ä¿æŒ
$X_{2i}$ä¸å˜ï¼Œ
$Y_i$å’Œ
$X_{3i}$ä¹‹é—´çš„ç›¸å…³ç³»æ•°ï¼š

$$\begin {align} 
r_{13.2}=\frac{r_{13}-r_{12} r_{23}}{\sqrt{\left(1-r_{12}^{2}\right)\left(1-r_{23}^{2}\right)}}
\end {align}$$

- ä¿æŒ
$Y_i$ä¸å˜ï¼Œ
$X_{2i}$å’Œ
$X_{3i}$ä¹‹é—´çš„ç›¸å…³ç³»æ•°ï¼š

$$\begin {align} 
r_{23.1}=\frac{r_{23}-r_{12} r_{13}}{\sqrt{\left(1-r_{12}^{2}\right)\left(1-r_{13}^{2}\right)}}
\end {align}$$

---

## ç®€å•ç›¸å…³ç³»æ•°


**ç®€å•ç›¸å…³ç³»æ•°**ï¼ˆsimple correlation coefficientï¼‰ï¼š


- 
$Y_i$å’Œ
$X_{2i}$ä¹‹é—´çš„ç›¸å…³ç³»æ•°ï¼š

$$\begin {align} 
r_{12}=\frac{\sum y_{i} x_{2 i}}{\sqrt{\sum y_{i}^{2}} \sqrt{\sum x_{2 i}^{2}}}
\end {align}$$

- 
$Y_i$å’Œ
$X_{3i}$ä¹‹é—´çš„ç›¸å…³ç³»æ•°ï¼š

$$\begin {align} 
r_{13}=\frac{\sum y_{i} x_{3 i}}{\sqrt{\sum y_{i}^{2}} \sqrt{\sum x_{3 i}^{2}}}
\end {align}$$

- 
$X_{2i}$å’Œ
$X_{3i}$ä¹‹é—´çš„ç›¸å…³ç³»æ•°ï¼š

$$\begin {align} 
r_{23}=\frac{\sum x_{2 i} x_{3 i}}{\sqrt{\sum x_{2 i}^{2}} \sqrt{\sum x_{3 i}^{2}}}
\end {align}$$

---

## ç›¸å…³ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒ

**ç›¸å…³ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒ**ï¼Œæ˜¯æŒ‡æ£€éªŒä¸¤ä¸ªå˜é‡ä¹‹é—´æ˜¯å¦å­˜åœ¨çº¿æ€§ç›¸å…³å…³ç³»ã€‚

ç›¸å…³ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒæ–¹æ³•åŒ…æ‹¬ï¼š

- ç­‰ä»·äºå¯¹å›å½’æ–œç‡ç³»æ•°
$\beta_1$çš„æ£€éªŒï¼ˆä»…é’ˆå¯¹ä¸€å…ƒå›å½’ï¼‰

- é‡‡ç”¨R. A. Fisheræå‡ºçš„tæ£€éªŒ

---

## ç›¸å…³ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒ

ç›¸å…³ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒæ­¥éª¤ï¼š

1ï¼‰æå‡ºå‡è®¾ï¼š
$H_0: \rho =0; H_1: \rho \neq 0$

2ï¼‰è®¡ç®—æ ·æœ¬ç»Ÿè®¡é‡

$$T^{\ast} = |r|\sqrt{\frac{n-2}{1-r^2}} \quad \sim t(n-2)$$

3ï¼‰ç»™å®šæ˜¾è‘—æ€§æ°´å¹³
$\alpha$ï¼Œç¡®å®štç†è®ºåˆ†å¸ƒå€¼
$t_{1-\alpha/2}(n-2)$ã€‚

4ï¼‰å¾—åˆ°å‡è®¾æ£€éªŒç»“è®ºï¼š

- è‹¥
$T^{\ast}> t_{1-\alpha/2}(n-2)$ï¼Œåˆ™æ‹’ç»
$H_0$ï¼Œè®¤ä¸ºæ˜¾è‘—å­˜åœ¨ç›¸å…³å…³ç³»ï¼›

- è‹¥
$T^{\ast} < t_{1-\alpha/2}(n-2)$ï¼Œåˆ™æ— æ³•æ‹’ç»
$H_0$ï¼Œè®¤ä¸ºç›¸å…³å…³ç³»ä¸æ˜¾è‘—ã€‚

---

exclude: true

## ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾

```{r}
str_compose <- function(vec1, vec2,
                        decorate = c("ï¼ˆ", "ï¼‰"),
                        clps = "ã€"){
  if (length(vec1) != length(vec2)) {
    "length of the two vectors not equal"
  }
  out <- str_c(str_c(vec1,decorate[1]),
               str_c(vec2,decorate[2]), 
               collapse = clps )
  out
}
```


```{r}
df_loan <- openxlsx::read.xlsx("../data/textbook/example/case-11-6-loan.xlsx",startRow = 2)

names_chn <- c("åˆ†è¡Œç¼–å·",	"ä¸è‰¯è´·æ¬¾",	"å„é¡¹è´·æ¬¾ä½™é¢
"	,"æœ¬å¹´ç´¯è®¡åº”æ”¶è´·æ¬¾"	,"è´·æ¬¾é¡¹ç›®ä¸ªæ•°",	"æœ¬å¹´å›ºå®šèµ„äº§æŠ•èµ„é¢")
names_eng <- names(df_loan)
n <- nrow(df_loan)

```

```{r}
avr_X <- mean(df_loan$loan.surplus)
avr_Y <- mean(df_loan$loan.bad)

df_rel1 <- df_loan %>%
  select(1:3) %>%
  mutate(XY = loan.bad *loan.surplus,
         X_sqr = loan.surplus^2,
         Y_sqr = loan.bad^2,
         x = loan.surplus - avr_X,
         y = loan.bad - avr_Y,
         x_sqr = x^2,
         y_sqr = y^2,
         xy = x*y)


tot_Y <- sum(df_rel1$loan.bad)
tot_X <- sum(df_rel1$loan.surplus)
tot_XX <- sum(df_rel1$X_sqr)
tot_YY <- sum(df_rel1$Y_sqr)
tot_XY <- sum(df_rel1$XY)

sum_x <- sum(df_rel1$x)
sum_y <- sum(df_rel1$y)
sum_xx <- sum(df_rel1$x_sqr)
sum_yy <- sum(df_rel1$y_sqr)
sum_xy <- sum(df_rel1$xy)

r <- round(cor(df_rel1$loan.surplus,df_rel1$loan.bad),4)
t_r <- round(abs(r)*sqrt((n-2)/(1-r^2)),4)

```


---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šæ¡ˆä¾‹æ•°æ®

**æ¡ˆä¾‹è¯´æ˜**ï¼šæŸé“¶è¡Œå…±æœ‰`r n`å®¶åˆ†è¡Œï¼Œåˆ†è¡ŒåŠæ‰€åœ¨åœ°åŒºçš„ç›¸å…³å˜é‡æ•°æ®å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚

```{r}
df_loan %>%
  datatable(options = list(dom = "tip", pageLength = 7,
                           scrollX = TRUE)) 
```

.footnote[**è¯´æ˜**ï¼šä¸Šè¿°å˜é‡çš„å«ä¹‰åˆ†åˆ«æ˜¯`r str_compose(names_eng, names_chn)`ã€‚]

---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šä¸è‰¯è´·æ¬¾VSè´·æ¬¾ä½™é¢çš„æ•£ç‚¹å›¾

```{r, fig.cap="ä¸è‰¯è´·æ¬¾VSè´·æ¬¾ä½™é¢æ•£ç‚¹å›¾"}

df_loan %>%
  ggplot(aes(loan.surplus, loan.bad)) +
  geom_point(size = 4) +
  labs(x = "è´·æ¬¾ä½™é¢ loan.surplusï¼ˆäº¿å…ƒï¼‰",
       y = "ä¸è‰¯è´·æ¬¾ loan.badï¼ˆäº¿å…ƒï¼‰") +
  theme(text = element_text(size = 16))
  
```



---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šä¸è‰¯è´·æ¬¾VSè´·æ¬¾ä½™é¢çš„ç›¸å…³ç³»æ•°ï¼ˆå¤§FFï¼‰

.left-column[

#### 1)å¤§FFè®¡ç®—è¡¨

]

.right-column[

```{r}
df_rel1 %>%
  rename_at(vars(c("loan.bad", "loan.surplus")),
            ~all_of(c("Y" ,"X"))) %>%
  select(1:6) %>%
  janitor::adorn_totals("row") %>%
  datatable(caption = "å¤§FFè®¡ç®—è¡¨",
            options = list(dom = "tip", pageLength = 7,
                           scrollX = TRUE)) %>%
  formatRound(c(4:6), digits = 2)
```

]

---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šä¸è‰¯è´·æ¬¾VSè´·æ¬¾ä½™é¢çš„ç›¸å…³ç³»æ•°ï¼ˆå¤§FFï¼‰

.left-column[

#### 1)å¤§FFè®¡ç®—è¡¨

#### 2)rè®¡ç®—å¼1

]

.right-column[

$$\begin{align}
r & = \frac{n \sum X_i Y_i -\sum X_i \sum Y_i}{\sqrt{n \sum X_i^{2}-\left(\sum X_i\right)^{2}} \cdot \sqrt{n \sum Y_i^{2}-\left(\sum Y_i\right)^{2}}} \\
& = \frac{`r n` \times `r tot_XY` - `r tot_X` \times `r tot_Y`}{\sqrt{`r n` \times `r tot_XX`-\left(`r tot_X`\right)^2} \cdot \sqrt{`r n` \times `r tot_YY`-\left( `r tot_Y`\right)^{2}}}  \\
& = `r formatC(r, format = 'f', digits=4)`
\end{align}$$

]

---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šä¸è‰¯è´·æ¬¾VSè´·æ¬¾ä½™é¢çš„ç›¸å…³ç³»æ•°ï¼ˆå°ffï¼‰

.left-column[

#### 1)å°ffè®¡ç®—è¡¨

]

.right-column[

```{r}
df_rel1 %>%
  rename_at(vars(c("loan.bad", "loan.surplus")),
            ~all_of(c("Y" ,"X"))) %>%
  select(1:3,7:11) %>%
  janitor::adorn_totals("row") %>%
  datatable(caption = "å°ffè®¡ç®—è¡¨",
            options = list(dom = "tip", pageLength = 7,
                           scrollX = TRUE)) %>%
  formatRound(c(4:8), digits = 2)
```

]

---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šä¸è‰¯è´·æ¬¾VSè´·æ¬¾ä½™é¢çš„ç›¸å…³ç³»æ•°

.left-column[

#### 1)å°ffè®¡ç®—è¡¨

#### 2)rè®¡ç®—å¼2

]

.right-column[

$$\begin{align}
r & = \frac{ \sum{\left( (X_i - \overline{X})(Y_i - \overline{Y})\right ) } }{\sqrt{\sum{(X_i - \overline{X})^2 (Y_i - \overline{Y})^2}}} \\
& = \frac{\sum{x_i y_i}}{\sqrt{\sum{x_i^2}\sum{y_i^2}}} \\
& = \frac{`r sum_xy`}{\sqrt{ `r sum_xx` \times `r sum_yy`}} \\
& = `r formatC(r, format = 'f', digits=4)`
\end{align}$$

]

---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šç›¸å…³ç³»æ•°çŸ©é˜µ(Pearson)

```{r, echo=TRUE, comment="#` "}
corl_pearson<- round(cor(df_loan[,-1], method = "pearson"),4) 
corl_pearson[upper.tri(corl_pearson)]<- NA
```


```{r, eval=T, warning=FALSE}
# rowname to column
tbl_flex <- corl_pearson %>%  
  as.data.frame() %>%
  rownames_to_column(var = " ") 

# conditions
colormatrix <- ifelse((tbl_flex[, -1] < 0.7), "black", 
                      ifelse((tbl_flex[, -1] < 0.8), "orange",
                             ifelse((tbl_flex[, -1] < 1),"red", "black")))

tbl_flex %>%
  flextable::flextable() %>%
  align(align ='center', part = 'all') %>% 
  colformat_double(j = 2:6, digits =4)%>%
  fontsize(size = 19, part = "all") %>%
  color(j = 2:6, color=colormatrix) %>%
  flextable::set_caption(caption = "Pearsonç›¸å…³ç³»æ•°çŸ©é˜µ") %>%
  autofit()

```

---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šç›¸å…³ç³»æ•°çŸ©é˜µ(Spearman)

```{r, echo=TRUE, comment="#` "}
corl_spearman<- round(cor(df_loan[,-1], method = "spearman"),4) 
corl_spearman[upper.tri(corl_spearman)] <- NA
```

```{r, eval=T, warning=FALSE}
# rowname to column
tbl_flex <- corl_spearman %>%  
  as.data.frame() %>%
  rownames_to_column(var = " ") 

tbl_flex %>%
  flextable::flextable() %>%
  align(align ='center', part = 'all') %>% 
  colformat_double(j = 2:6, digits =4)%>%
  fontsize(size = 19, part = "all") %>%
  color(j = 2:6, color=colormatrix) %>%
  flextable::set_caption(caption = "Spearmanç›¸å…³ç³»æ•°çŸ©é˜µ") %>%
  autofit()

```

---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šç›¸å…³ç³»æ•°æ˜¾è‘—æ€§æ£€éªŒ(æ‰‹ç®—)

å¯¹äºå‰è¿°`loan.surplus`ä¸`loan.bad`è¿›è¡Œç›¸å…³ç³»æ•°æ˜¾è‘—æ€§æ£€éªŒï¼ˆPearsonï¼‰ï¼š

- 1ï¼‰æå‡ºå‡è®¾ï¼š
$H_0: \rho =0; H_1: \rho \neq 0$

- 2ï¼‰è®¡ç®—æ ·æœ¬ç»Ÿè®¡é‡ï¼š

$$\begin{align}
T^{\ast} = |r|\sqrt{\frac{n-2}{1-r^2}} 
=`r abs(r)` \times \sqrt{\frac{`r n`-2}{1-`r r`^2}}
= `r t_r`
\end{align}$$

- 3ï¼‰ç»™å®šæ˜¾è‘—æ€§æ°´å¹³
$\alpha=0.05$ï¼Œç¡®å®štç†è®ºåˆ†å¸ƒå€¼
$t_{1-\alpha/2}(n-2)=t_{1-0.05/2}(25-2)=t_{0.975}(`r n-2`)=`r round(qt(0.975,23),2)`$ã€‚

- 4ï¼‰å¾—åˆ°å‡è®¾æ£€éªŒç»“è®ºï¼šå› ä¸ºtæ ·æœ¬ç»Ÿè®¡é‡å¤§äºtç†è®ºæŸ¥è¡¨å€¼ï¼Œä¹Ÿå³

$$\left[T^{\ast}= `r t_r`\right] > \left[t_{0.975}(`r n-2`) =`r round(qt(0.975,23),2)`\right]$$

å› æ­¤æ‹’ç»åŸå‡è®¾
$H_0$ï¼Œè®¤ä¸ºå˜é‡`loan.surplus`ï¼ˆè´·æ¬¾ä½™é¢ï¼‰ä¸`loan.bad`ï¼ˆä¸è‰¯è´·æ¬¾ï¼‰æ˜¾è‘—å­˜åœ¨ç›¸å…³å…³ç³»ã€‚


---

### ï¼ˆæ¡ˆä¾‹ï¼‰é“¶è¡Œè´·æ¬¾ï¼šç›¸å…³ç³»æ•°æ˜¾è‘—æ€§æ£€éªŒ(Rè½¯ä»¶)

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Rè½¯ä»¶å‡½æ•°`cor.test()`å¯¹ä¸Šè¿°ä¸¤ä¸ªå˜é‡è¿›è¡Œç›¸å…³ç³»æ•°æ˜¾è‘—æ€§æ£€éªŒï¼š

```{r, echo=TRUE}
cor.test(df_rel1$loan.surplus, df_rel1$loan.bad,
         method = "pearson")
```


---
layout: false
class: center, middle, duke-softblue,hide_logo
name: basic

# 5.2 å›å½’åˆ†æçš„åŸºæœ¬æ€æƒ³

### ç›¸å…³å…³ç³»VSå› æœå…³ç³»

### è‹¥å¹²é‡è¦æ¦‚å¿µ

### å›å½’ç›´çº¿çš„æ‹Ÿåˆä¼˜åº¦

### æ˜¾è‘—æ€§æ£€éªŒ

### åˆ©ç”¨Excelè¿›è¡Œå›å½’åˆ†æ

---
layout: true

<div class="my-header-h2"></div>

<div class="watermark1"></div>

<div class="watermark2"></div>

<div class="watermark3"></div>

<div class="my-footer"><span>huhuaping@  &emsp;&emsp; <a href="#chapter"> ç¬¬05ç«  ç›¸å…³å’Œå›å½’åˆ†æ </a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
<a href="#basic"> 5.2 å›å½’åˆ†æçš„åŸºæœ¬æ€æƒ³ </a> </span></div> 

---

## çº¿æ€§å›å½’åˆ†æ

ä»ä¸€ç»„æ ·æœ¬æ•°æ®å‡ºå‘ï¼Œç¡®å®šå˜é‡ä¹‹é—´çš„æ•°å­¦å…³ç³»å¼ã€‚

å¯¹è¿™äº›å…³ç³»å¼çš„å¯ä¿¡ç¨‹åº¦è¿›è¡Œå„ç§ç»Ÿè®¡æ£€éªŒï¼Œå¹¶ä»å½±å“æŸä¸€ç‰¹å®šå˜é‡çš„è¯¸å¤šå˜é‡ä¸­æ‰¾å‡ºå“ªäº›å˜é‡çš„å½±å“æ˜¾è‘—ï¼Œå“ªäº›ä¸æ˜¾è‘—ã€‚

åˆ©ç”¨æ‰€æ±‚çš„å…³ç³»å¼ï¼Œæ ¹æ®ä¸€ä¸ªæˆ–å‡ ä¸ªå˜é‡çš„å–å€¼æ¥é¢„æµ‹æˆ–æ§åˆ¶å¦ä¸€ä¸ªç‰¹å®šå˜é‡çš„å–å€¼ï¼Œå¹¶ç»™å‡ºè¿™ç§é¢„æµ‹æˆ–æ§åˆ¶çš„ç²¾ç¡®ç¨‹åº¦ã€‚


---

## ç›¸å…³å…³ç³»ï¼šè¾¹é™…ç›¸å…³ä¸æ¡ä»¶ç›¸å…³1

```{r, out.width= "90%", fig.cap="è¾¹é™…ç›¸å…³ä½†æ˜¯æ¡ä»¶ç‹¬ç«‹"}
include_graphics("../pic/chpt05-causality-margin.png")
```

---

## ç›¸å…³å…³ç³»ï¼šè¾¹é™…ç›¸å…³ä¸æ¡ä»¶ç›¸å…³2

```{r, out.width= "90%", fig.cap="è¾¹é™…ç‹¬ç«‹ä½†æ˜¯æ¡ä»¶ç›¸å…³"}
include_graphics("../pic/chpt05-causality-margin-2.png")
```

---

## ç›¸å…³å…³ç³»VSå› æœå…³ç³»


```{r, out.width= "60%", fig.cap="å·§å…‹åŠ›æ¶ˆè´¹é‡ä¸è¯ºè´å°”å¥–æ•°é‡"}
include_graphics("../pic/chpt05-causality-chocolate.png")
```

---

## ç›¸å…³å…³ç³»VSå› æœå…³ç³»ï¼šæ€§åˆ«çš„ä½œç”¨

```{r, out.width= "95%", fig.cap="æ²»ç–—åº·å¤è¡¨"}
include_graphics("../pic/chpt05-causality-drug-gender1.png")
```

```{r, out.width= "60%", fig.cap="å› æœå…³ç³»å›¾"}
include_graphics("../pic/chpt05-causality-drug-gender-graph1.png")
```

---

## ç›¸å…³å…³ç³»VSå› æœå…³ç³»ï¼šè¡€å‹çš„ä½œç”¨

```{r, out.width= "100%", fig.cap="æ²»ç–—åº·å¤è¡¨"}
include_graphics("../pic/chpt05-causality-drug-pressure-tab.png")
```

```{r, out.width= "60%", fig.cap="å› æœå…³ç³»å›¾"}
include_graphics("../pic/chpt05-causality-drug-pressure-graph.png")
```

---

## ï¼ˆæ¡ˆä¾‹ï¼‰å¾®å‹å®¶åº­æ€»ä½“

<!---æ–°æ•°æ®è¡¨--->

```{r}
fams60<- as_tibble(read.xlsx("../data/Table-2-1-60families-new.xlsx",shee = 1))

fams60_long <- as_tibble(read.xlsx("../data/Table-2-1-60families-new.xlsx", sheet =2))

```

---

### ï¼ˆæ¡ˆä¾‹ï¼‰å‡æƒ³æ€»ä½“ï¼š60ä¸ªå®¶åº­çš„æ”¶æ”¯æ•°æ®ï¼ˆç›´è§‚åˆ—è¡¨ï¼‰


```{r, fig.cap="60ä¸ªå®¶åº­çš„æ”¶å…¥å’Œæ”¯å‡ºæƒ…å†µï¼šå‡è®¾çš„æ€»ä½“"}
include_graphics("../pic/chpt2-1-60families-pop.png",dpi=150)
```

???
æé—®ï¼š

- æ€»ä½“æ˜¯ä»€ä¹ˆï¼Ÿ

- æœ‰å¤šå°‘æ€»ä½“å•ä½ï¼Ÿ

---

### ï¼ˆæ¡ˆä¾‹ï¼‰å‡æƒ³æ€»ä½“ï¼š60ä¸ªå®¶åº­çš„æ”¶æ”¯æ•°æ®ï¼ˆæ‰æ•°æ®å½¢æ€ï¼‰


```{r}
datatable(fams60, options = list(pageLength =9, dom ="t"), caption = "60ä¸ªå®¶åº­çš„æ”¶å…¥å’Œæ”¯å‡ºæƒ…å†µï¼šå‡è®¾çš„æ€»ä½“")
```
???
**æ‰æ•°æ®å½¢æ€**ï¼šâ€œéæ ‡å‡†â€æ•°æ®å½¢æ€ï¼ˆä½†å¾ˆç›´è§‚ï¼‰

---

### ï¼ˆæ¡ˆä¾‹ï¼‰å‡æƒ³æ€»ä½“ï¼š60ä¸ªå®¶åº­çš„æ”¶æ”¯æ•°æ®ï¼ˆé•¿æ•°æ®å½¢æ€ï¼‰

```{r}
datatable(fams60_long, options = list(pageLength =8, dom ="tip"), caption = "60ä¸ªå®¶åº­çš„æ”¶å…¥å’Œæ”¯å‡ºæƒ…å†µï¼šå‡è®¾çš„æ€»ä½“")
```
???
**é•¿æ•°æ®å½¢æ€**ï¼šæ ‡å‡†æ•°æ®å½¢æ€ï¼ˆä½†ä¸ç›´è§‚ï¼‰ã€‚

---

## é‡è¦æ¦‚å¿µï¼šæ— æ¡ä»¶æ¦‚ç‡å’Œæ— æ¡ä»¶æœŸæœ›

**æ— æ¡ä»¶æ¦‚ç‡**ï¼š

- å®šä¹‰ï¼šä¸å—
$X_i$å˜é‡å–å€¼å½±å“ä¸‹ï¼Œ
$Y_i$å‡ºç°çš„å¯èƒ½æ€§ã€‚

- è®°å·ï¼šç¦»æ•£å˜é‡
$P(Y_i)$ï¼›è¿ç»­å˜é‡
$g(Y)$

**æ— æ¡ä»¶æœŸæœ›**ï¼š

- å®šä¹‰ï¼šä¸å—
$X_i$å˜é‡å–å€¼å½±å“ä¸‹ï¼Œå˜é‡
$Y_i$çš„æœŸæœ›å€¼ã€‚

- è®°å·ï¼š
$g(Y_i)$è¡¨ç¤ºè¿ç»­å˜é‡çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆcdfï¼‰

$$\begin{align}
E(Y) &= \sum_1^N{Y_i \cdot P(Y_i)} &&\text{(discrete vars)} \\
E(Y) &= \int{Y_i \cdot g(Y_i)dY} &&\text{(continue vars)} 
\end{align}$$

---

### ï¼ˆç¤ºä¾‹ï¼‰æ— æ¡ä»¶æ¦‚ç‡å’Œæ— æ¡ä»¶æœŸæœ›çš„ç¤ºä¾‹è®¡ç®—


```{r, out.width="90%", fig.cap="æ— æ¡ä»¶æ¦‚ç‡å’Œæ— æ¡ä»¶æœŸæœ›"}
include_graphics("../pic/chpt2-1-60fams-unconditional-mean.png")
```

---

### ï¼ˆç¤ºä¾‹ï¼‰æ— æ¡ä»¶æœŸæœ›çš„è®¡ç®—è¿‡ç¨‹

$$\begin{align}
E(Y) &= \sum_1^N{Y_i \cdot P(Y_i)} \\
     &= \sum_1^{60}\left( 55*\frac{1}{60} + 60*\frac{1}{60} + \cdots + 191*\frac{1}{60} \right) \\
     &=\frac{1}{60}\sum_1^{60}Y_i\\
     &=\frac{7272}{60}\\
     &=121.2
\end{align}$$

---

## é‡è¦æ¦‚å¿µï¼šæ¡ä»¶æ¦‚ç‡å’Œæ¡ä»¶æœŸæœ›

**æ¡ä»¶æ¦‚ç‡**ï¼š

- å®šä¹‰ï¼šç»™å®šå˜é‡
$X_i$çš„å–å€¼æ¡ä»¶ä¸‹ï¼Œ
$Y_i$å‡ºç°çš„å¯èƒ½æ€§ã€‚

- è®°å·ï¼šç¦»æ•£å˜é‡
$P(Y_i|X_i)$ï¼›è¿ç»­å˜é‡
$g(Y|X)$


**æ¡ä»¶æœŸæœ›**ï¼š

- åœ¨ç»™å®šå˜é‡
$X_i$çš„å–å€¼æ¡ä»¶ä¸‹ï¼Œ
$Y_i$çš„æœŸæœ›å€¼ã€‚

- è®°å·ï¼š
$g(Y|X)$è¡¨ç¤ºè¿ç»­å˜é‡çš„æ¡ä»¶æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼ˆcdfï¼‰

$$\begin{align}
E(Y|X_i) &= \sum_1^N{(Y_i|X_i) \cdot P(Y_i|X_i)} &&\text{(discrete vars)} \\
E(Y|X_i) &= \int{(Y|X) \cdot g(Y|X)dY} &&\text{(continue vars)} \end{align}$$

---

### ï¼ˆç¤ºä¾‹ï¼‰æ¡ä»¶æ¦‚ç‡å’Œæ¡ä»¶æœŸæœ›çš„è®¡ç®—

```{r, out.width="90%",fig.cap="æ¡ä»¶æ¦‚ç‡å’Œæ¡ä»¶æœŸæœ›"}
include_graphics("../pic/chpt2-1-60fams-conditional-mean.png")
```

---

### ï¼ˆç¤ºä¾‹ï¼‰æ¡ä»¶æœŸæœ›çš„è®¡ç®—è¿‡ç¨‹

$$\begin{align}
E(Y|80) &= \sum_1^N{Y_i \cdot P(Y_i|X=80)} \\
     &= \sum_1^{5}\left( 55*\frac{1}{5} + 60*\frac{1}{5} + \cdots + 75*\frac{1}{5} \right) \\
     &=\frac{1}{5}\sum_1^{5}Y_i\\
     &=\frac{325}{5}\\
     &=65
\end{align}$$

---

### ï¼ˆç¤ºä¾‹ï¼‰å‡æƒ³æ€»ä½“çš„å…¨éƒ¨æ•°æ®å±•ç¤º

```{r, warning=F}
exp_cond <- fams60 %>%
  filter(Mark!="X") %>%
  select(-Mark) %>%
  colMeans(.,na.rm = T) %>%
  rbind(fams60[1,-1], .) %>%
  add_column(var = c("X","E(Y|X)"), .before = "G1")

pivot_exp <- as_tibble(t(exp_cond))[-1,] %>%
  dplyr::rename( X=V1,exp.Y="V2") %>%
  type_convert(cols(X=col_double(),
                    exp.Y= col_double()))
```


```{r, out.width="90%"}
# the population points
p1<- ggplot() +
  geom_point(data = fams60_long,
             aes(x=X,  y=Y,color= "Y", shape="Y"),size=3) +
  scale_colour_manual(name= "",
                      values =c("blue")) +
  scale_shape_manual(name= "",
                      values =c(1)) +
  scale_x_continuous(breaks=seq(80,260, length=10)) +
  labs(x="å®¶åº­æ”¶å…¥X", y="å®¶åº­æ”¯å‡ºY") +
  theme(text = element_text(size=18),
        axis.title.x = element_text(size = 16,
                                margin = margin(t = 15, r = 0, 
                                                b = 0, l = 0)),
        axis.title.y = element_text(size = 16,
                                margin = margin(t = 0, r = 15, 
                                                b = 0, l = 0)))

p1
```


---

### ï¼ˆç¤ºä¾‹ï¼‰ç»™å®šä¸åŒXæ°´å¹³ä¸‹Yæ¡ä»¶æœŸæœ›å€¼

```{r, fig.height= 5.5}
# the expect points
p2 <- p1 +
  geom_point(data = pivot_exp, 
             aes(x=X, y=exp.Y,
                 color= "E(Y|X)",shape= "E(Y|X)"), size=3) +
  scale_colour_manual(name= "",
                      values =c("red","blue")) +
  scale_shape_manual(name= "",values =c(19,1)) 

p2
```


```{r}
kable(exp_cond) %>%
  kable_styling(full_width =T)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ç»™å®šä¸åŒXæ°´å¹³ä¸‹Yæ¡ä»¶æœŸæœ›å€¼

```{r, out.width="90%" , warning=FALSE,message=FALSE}
# the specified point
require("latex2exp")
X_spc <- 120
Y_spc <- pivot_exp$exp.Y[which(pivot_exp$X==X_spc)]
p2_1 <- p2 +
  geom_vline(aes(xintercept = X_spc), lty="dashed")+
  geom_hline(aes(yintercept = Y_spc), lty="dashed")+
  geom_text(aes(x=X_spc-22, y=Y_spc+10), label=TeX("$(X_i,E(Y|X_i))=(120,89)$"),
            color="red",size=5)

p2_1
```

ç»™å®š
$X=120$æ°´å¹³ä¸‹
$Y$æ¡ä»¶æœŸæœ›å€¼
$E(Y|X_i=120)$= `r pivot_exp$exp.Y[which(pivot_exp$X==X_spc)]`

---

### ï¼ˆç¤ºä¾‹ï¼‰Xå‡å€¼å’ŒYçš„æ— æ¡ä»¶æœŸæœ›å€¼

```{r, out.width="90%", warning=FALSE,message=FALSE}
# the center point
X_bar <- mean(fams60_long$X)
Y_bar <- mean(fams60_long$Y)
p3 <- p2 +
  geom_vline(aes(xintercept = X_bar), lty="dashed")+
  geom_hline(aes(yintercept = Y_bar), lty="dashed")+
  geom_text(aes(x=X_bar-20, y=Y_bar+10), label=TeX("$(\\bar{X},\\bar{Y})=(174, 121)$"),color="orange",size=5)+
  #geom_text(aes(x=15, y=mean(fams60_long$Y)+5), label=TeX("$E(Y)=\\bar{Y}$"))+
  geom_point(aes(x=X_bar, y=Y_bar,
                 color="center", shape="center"),size=3) +
  scale_colour_manual(name= "",
                      values =c("E(Y|X)"="red", "Y"="blue", "center" ="orange")) +
  scale_shape_manual(name= "",
                      values =c("E(Y|X)"=19,"Y"=1,"center" =17)) 
p3
```

Xçš„å‡å€¼
$\bar{X}$
=`r formatC(X_bar, format="f", digits =2)`å’ŒYçš„æ— æ¡ä»¶æœŸæœ›å€¼
$E(Y)=$
`r formatC(Y_bar, format ="f", digits = 2)`

---

## é‡è¦æ¦‚å¿µï¼šæ€»ä½“å›å½’çº¿ï¼ˆPRLï¼‰

- å‡ ä½•ï¼šç»™å®šXå€¼æ—¶Yçš„æ¡ä»¶æœŸæœ›å€¼çš„è½¨è¿¹ã€‚

- ç»Ÿè®¡ï¼šå®è´¨ä¸Šå°±æ˜¯Yå¯¹Xçš„å›å½’ã€‚

æ€»ä½“å›å½’æ›²çº¿(Population Regression Curveï¼ŒPRC)ï¼šæ¡ä»¶æœŸæœ›å€¼çš„è½¨è¿¹è¡¨ç°ä¸ºä¸€æ¡æ›²çº¿(Curve)ã€‚

æ€»ä½“å›å½’çº¿(Population Regression Lineï¼ŒPRL)ï¼šæ¡ä»¶æœŸæœ›å€¼çš„è½¨è¿¹è¡¨ç°ä¸ºä¸€æ¡ç›´çº¿(Line)ã€‚

---

## é‡è¦æ¦‚å¿µï¼šæ€»ä½“å›å½’çº¿ï¼ˆPRLï¼‰

```{r, out.width="90%", fig.cap="æ€»ä½“å›å½’çº¿PRL"}
p_PRL <- p2 +
  geom_line(data = pivot_exp,aes(x=X, y=exp.Y),color="purple", size=0.75)
p_PRL
```

---

## é‡è¦æ¦‚å¿µï¼šæ€»ä½“å›å½’å‡½æ•°ï¼ˆPRFï¼‰

æ€»ä½“å›å½’å‡½æ•°ï¼ˆPopulation Regression Functionï¼ŒPRFï¼‰ï¼šå®ƒæ˜¯å¯¹æ€»ä½“å›å½’æ›²çº¿(PRC)çš„æ•°å­¦å‡½æ•°è¡¨ç°å½¢å¼ã€‚

å¦‚æœä¸çŸ¥é“æ€»ä½“å›å½’æ›²çº¿çš„å…·ä½“å½¢å¼ï¼Œåˆ™æ€»ä½“å›å½’å‡½æ•°PRFè¡¨è¾¾ä¸ºå¦‚ä¸‹éšå‡½æ•°å½¢å¼ï¼ˆPRFï¼‰ï¼š

$$\begin{align}
E(Y|X_i) & = f(X_i)  && \text{(PRF)}
\end{align}$$

å¦‚æœæ€»ä½“å›å½’æ›²çº¿æ˜¯ç›´çº¿å½¢å¼ï¼Œåˆ™æ€»ä½“å›å½’å‡½æ•°PRFè¡¨è¾¾ä¸ºå¦‚ä¸‹æ˜¾å‡½æ•°å½¢å¼ï¼ˆPRF_Lï¼‰ï¼š

$$\begin{align}
E(Y|X_i) &= \beta_1 +\beta_2X_i && \text{(PRF_L)}
\end{align}$$

- 
$\beta_1,\beta_2$åˆ†åˆ«ç§°ä¸ºæˆªè·(intercept)å’Œæ–œç‡ç³»æ•°(slope coefficient)ã€‚

- 
$\beta_1,\beta_2$ç§°ä¸ºæ€»ä½“å‚æ•°æˆ–å›å½’ç³»æ•°(regression coefficients)ã€‚

- 
$\beta_1,\beta_2$ä¸ºæœªçŸ¥ä½†å´æ˜¯å›ºå®šçš„å‚æ•°ã€‚

---

## é‡è¦æ¦‚å¿µï¼šæ€»ä½“å›å½’å‡½æ•°ï¼ˆPRFï¼‰

```{r, out.width="90%", fig.cap="æ€»ä½“å›å½’çº¿PRLä¸æ€»ä½“å›å½’å‡½æ•°PRF", warning=FALSE,message=FALSE}
lm_pop<- lm(data = pivot_exp, formula = exp.Y~X)
b1 <- coef(lm_pop)[1]
b0 <- coef(lm_pop)[2]
p_PRF <- p_PRL +
  geom_text(aes(x=120, y=200),
            label=TeX("$PRF:E(Y|X_i)=\\beta_1+\\beta_2X_i$"),
            color="purple", size=5) +
    geom_text(aes(x=120, y=190),
            label=TeX("$E(Y|X_i)=17+0.6X_i$"),
            color="purple", size=5) 
p_PRF
```

---

## é‡è¦æ¦‚å¿µï¼šæ€»ä½“å›å½’æ¨¡å‹ï¼ˆPRMï¼‰

**æ€»ä½“å›å½’æ¨¡å‹**ï¼ˆPopulation Regression model, PRMï¼‰ï¼šæŠŠæ€»ä½“å›å½’å‡½æ•°è¡¨è¾¾æˆ**éšæœºè®¾å®š**å½¢å¼ã€‚

å¦‚æœæ€»ä½“å›å½’å‡½æ•°ä¸ºéšå‡½æ•°ï¼Œåˆ™**æ€»ä½“å›å½’æ¨¡å‹**è®°ä¸ºï¼š

$$\begin{align}
Y_i &=  E(Y|X_i) + u_i \\
    &=  f(X_i) +u_i
\end{align}$$

å¦‚æœæ€»ä½“å›å½’å‡½æ•°ä¸ºçº¿æ€§å‡½æ•°ï¼Œåˆ™**æ€»ä½“å›å½’æ¨¡å‹**è®°ä¸ºï¼š

$$\begin{align}
Y_i &=  E(Y|X_i) + u_i \\
    &= \beta_1 +\beta_2X_i + u_i
\end{align}$$

- æ€»ä½“å›å½’æ¨¡å‹ï¼ˆPRMï¼‰å±äº**è®¡é‡ç»æµå­¦æ¨¡å‹**ï¼Œè€Œæ€»ä½“å›å½’å‡½æ•°ï¼ˆPRFï¼‰æ˜¯**æ•°é‡ç»æµå­¦æ¨¡å‹**ï¼ˆæˆ–æ•°å­¦æ¨¡å‹ï¼‰ã€‚

- æ€»ä½“å›å½’æ¨¡å‹ï¼ˆPRMï¼‰èƒ½å……åˆ†è¡¨è¾¾çš„æ˜¯ç°å®ä¸–ç•Œä¸­
$Y_i$å˜é‡çš„è¡Œä¸ºç‰¹å¾ã€‚


---

## é‡è¦æ¦‚å¿µï¼šéšæœºå¹²æ‰°é¡¹

æ€»ä½“å›å½’æ¨¡å‹ï¼ˆPRMï¼‰è®¾å®šä¸‹ï¼Œ
$Y_i$å°†ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆã€‚

- ç‰¹å®šå®¶åº­çš„æ”¯å‡ºï¼ˆ
$Y_i$ï¼‰ = ç³»ç»Ÿæ€§éƒ¨åˆ†ï¼ˆ
$E(Y|X_i)$ + éšæœºéƒ¨åˆ†ï¼ˆ
$u_i$ï¼‰

- ç‰¹å®šå®¶åº­çš„æ”¯å‡ºï¼ˆ
$Y_i$ï¼‰ = ç³»ç»Ÿæ€§éƒ¨åˆ†ï¼ˆ
$\beta_1+\beta_2X_i$ï¼‰ + éšæœºéƒ¨åˆ†ï¼ˆ
$u_i$ï¼‰


**éšæœºå¹²æ‰°é¡¹**ï¼š

- ä¹Ÿè¢«ç§°ä¸ºéšæœºè¯¯å·®é¡¹(stochastic error term)ï¼šæ€»ä½“å›å½’å‡½æ•°ä¸­å¿½ç•¥æ‰çš„ä½†åˆå½±å“ç€Yçš„å…¨éƒ¨å˜é‡çš„æ›¿ä»£ç‰©ï¼Œå®ƒæ˜¯
$Y_i$ä¸æ¡ä»¶æœŸæœ›ï¼ˆ
$E(Y|X_i)$ï¼‰çš„ç¦»å·®ã€‚

$$\begin{align}
u_i &= Y_i - E(Y|X_i) 
\end{align}$$

---

## é‡è¦æ¦‚å¿µï¼šéšæœºå¹²æ‰°é¡¹

éšæœºå¹²æ‰°é¡¹çš„æ¥æºï¼š

- ç†è®ºçš„å«ç³Šï¼šé™¤äº†ä¸»å˜é‡ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶å®ƒå˜é‡çš„å½±å“ï¼Œä½†ä¸æ¸…æ¥šï¼Œåªèƒ½ç”¨ğœ‡_ğ‘–ä»£æ›¿å®ƒä»¬ã€‚ï¼ˆå®¶åº­æ”¶å…¥ä»¥å¤–ï¼Ÿï¼‰

- æ•°æ®çš„ä¸å……åˆ†ï¼šå¯èƒ½çŸ¥é“è¢«å¿½ç•¥çš„å˜é‡ï¼Œä½†ä¸èƒ½å¾—åˆ°è¿™äº›å˜é‡çš„æ•°é‡ä¿¡æ¯ã€‚ï¼ˆå¦‚å®¶åº­è´¢å¯Œæ•°æ®ä¸å¯å¾—ï¼‰

- æ ¸å¿ƒå˜é‡ä¸å…¶å®ƒå˜é‡ï¼šå…¶å®ƒå˜é‡å…¨éƒ¨æˆ–å…¶ä¸­ä¸€äº›åˆèµ·æ¥å½±å“è¿˜æ˜¯å¾ˆå°çš„ã€‚ï¼ˆå¦‚å­å¥³ã€æ•™è‚²ã€æ€§åˆ«ã€å®—æ•™ç­‰ï¼‰

- äººç±»è¡Œä¸ºçš„å†…åœ¨éšæœºæ€§ã€‚ï¼ˆå®¢è§‚å­˜åœ¨ã€å›ºæœ‰çš„ï¼‰

- å˜é‡è¢«â€œç§»èŠ±æ¥æœ¨â€è€Œäº§ç”Ÿæµ‹é‡è¯¯å·®ï¼ˆå¦‚å¼—é‡Œå¾·æ›¼çš„æŒä¹…æ”¶å…¥å’Œæ¶ˆè´¹ï¼‰

- èŠ‚çœåŸåˆ™ï¼šä¸ºäº†ä¿æŒä¸€ä¸ªå°½å¯èƒ½ç®€å•çš„å›å½’æ¨¡å‹

- é”™è¯¯çš„å‡½æ•°å½¢å¼ï¼šæœ‰æ—¶æ ¹æ®æ•°æ®åŠç»éªŒæ— æ³•ç¡®å®šä¸€ä¸ªæ­£ç¡®çš„å‡½æ•°å½¢å¼ ï¼ˆå¤šå…ƒå›å½’å°¤å…¶å¦‚æ­¤ï¼‰

---

## é‡è¦æ¦‚å¿µï¼šéšæœºå¹²æ‰°é¡¹


.pull-left[
ä¸ºä½•æ˜¯â€œéšæœºçš„â€ï¼Ÿ

- æµ‹ä¸å‡†ï¼Ÿï¼ˆè¯¯å·®ï¼‰

- æµ‹é”™äº†ï¼Ÿï¼ˆè¯¯å¯¼ï¼‰

- å…ä¸äº†!ï¼ˆå†…åœ¨æ€§ï¼‰

]

.pull-right[

æ‹¥æŠ±éšæœºä¸–ç•Œ

- é£ç­ï¼š
$Y_i$

- é£ç­çº¿ï¼š
$E(Y|X_i)$

- é£ï¼š
$u_i$

]


---

## é‡è¦æ¦‚å¿µï¼šç†è§£PRMå’ŒPRFçš„å…³ç³»

```{r, out.width="90%", warning=FALSE,message=FALSE}
Y_spc2 <- min(fams60_long$Y[which(fams60_long$X==X_spc)])

p_PRM_demo<- p_PRF +
  geom_point(aes(x=X_spc,y=Y_spc), shape=2,size=3)+
  geom_point(aes(x=X_spc,y=Y_spc2), shape=1, color="black",size=3)+
  geom_hline(aes(yintercept = Y_spc), lty= "dashed") +
  geom_text(aes(x=X_spc+25,y=Y_spc+4),
             label=paste0("E(Y|",X_spc,")=",Y_spc),size=5) +
  geom_hline(aes(yintercept = Y_spc2), lty= "dashed") +
  geom_text(aes(x=X_spc+25,y=Y_spc2-4),
             label=paste0("(Yi|", X_spc,")=",Y_spc2),size=5) 
  
p_PRM_demo
```

è‹¥ç»™å®šä¸€ä¸ªç‰¹å®šå®¶åº­
$(X_i=120, Y_i=79)$ï¼Œåˆ™æ¡ä»¶æœŸæœ›ä¸º
$E(Y|120)=89$


---

## é‡è¦æ¦‚å¿µï¼šç†è§£PRMå’ŒPRFçš„å…³ç³»

è‹¥ç»™å®š
$X_i=$ `r X_spc` ï¼Œåˆ™5ä¸ªå®¶åº­çš„çœŸå®æ¶ˆè´¹æ”¯å‡ºåˆ†åˆ«ä¸ºï¼š

$$\begin{align}
(Y_1|X=120) = 79 &= \beta_1 + \beta_2 \cdot 120 +u_1\\
(Y_2|X=120) = 84 &= \beta_1 + \beta_2 \cdot 120 +u_2\\
(Y_3|X=120) = 90 &= \beta_1 + \beta_2 \cdot 120 +u_3\\
(Y_4|X=120) = 94 &= \beta_1 + \beta_2 \cdot 120 +u_4\\
(Y_5|X=120) = 98 &= \beta_1 + \beta_2 \cdot 120 +u_5
\end{align}$$


---

## é‡è¦æ¦‚å¿µï¼šç†è§£PRMå’ŒPRFçš„å…³ç³»

ä¸»è¦ç»“è®ºï¼š

- æ€»ä½“æœŸæœ›åˆ»ç”»æ€»ä½“çš„â€œè¶‹åŠ¿â€ï¼Œæ€»ä½“å›å½’çº¿è®©â€œè¶‹åŠ¿â€ç›´è§‚åŒ–ã€‚

- ä¸ªä½“éšæœºæ€§æ˜¯ä¸å¯é¿å…çš„ï¼Œæ€»ä¼šâ€œæ¸¸ç¦»â€äºâ€œè¶‹åŠ¿â€ä¹‹å¤–ã€‚

- éšæœºå¹²æ‰°é¡¹
$u_i$ğ‘–æºå¸¦äº†éšæœºä¸ªä½“çš„â€œæ¸¸ç¦»â€ä¿¡æ¯ã€‚

- æ€»ä½“å›å½’æ¨¡å‹æ—¢â€œæå–â€äº†è¶‹åŠ¿å’Œè§„å¾‹æ€§ï¼Œåˆâ€œç»´ç³»â€ç€ä¸ªä½“éšæœºæ€§ï¼Œä»è€Œæ›´å¥½åœ°è¡¨è¾¾äº†â€œçœŸå®ä¸–ç•Œâ€ã€‚

è¯¾åæ€è€ƒï¼š

- å¦‚æœæ˜¯æ— é™æ€»ä½“ï¼Œæ€»ä½“çš„è§„å¾‹æ€§åœ¨ç†è®ºä¸Šä¹Ÿæ˜¯å¯ä»¥è¢«ä¸¥æ ¼è¡¨è¾¾å‡ºæ¥ä¹ˆï¼Ÿ

- å¦‚æœä¸å‘Šè¯‰ä½ æ€»ä½“ï¼Œä½ æ€ä¹ˆçŸ¥é“â€œè§¦ç¢°â€åˆ°çš„æ˜¯â€œçœŸå®çš„â€è¶‹åŠ¿/è§„å¾‹ï¼Ÿ

- ä»å‡æƒ³çš„60ä¸ªå®¶åº­çš„å¾®å‹æ€»ä½“ä¸­ï¼Œâ€œéšä¾¿â€æŠ½å–10ä¸ªå®¶åº­çš„æ•°æ®ï¼Œä½ è¿˜èƒ½çœ‹åˆ°â€œç›´çº¿â€è¶‹åŠ¿ä¹ˆï¼Ÿ


---

## é‡è¦æ¦‚å¿µï¼šâ€œçº¿æ€§â€çš„å«ä¹‰

â€œçº¿æ€§å›å½’æ¨¡å‹â€ä¸­â€œçº¿æ€§â€ä¸€è¯çš„å«ä¹‰

- **å˜é‡â€œçº¿æ€§â€æ¨¡å‹**ï¼šå› å˜é‡å¯¹äºè‡ªå˜é‡æ˜¯çº¿æ€§çš„ã€‚

- **å‚æ•°â€œçº¿æ€§â€æ¨¡å‹**ï¼šå› å˜é‡å¯¹äºå‚æ•°æ˜¯çº¿æ€§çš„ã€‚

---

### ï¼ˆæµ‹è¯•é¢˜ï¼‰â€œçº¿æ€§â€çš„å«ä¹‰

ä¸‹åˆ—æ¨¡å‹åˆ†åˆ«å±äºå“ªä¸€ç±»ï¼Ÿè¯·æŒ‡å‡ºæ¥ï¼š

$$\begin{align}
Y_i &= \beta_1 + \beta_2 X_i +u_i && \text{(mod1)}
\end{align}$$

$$\begin{align}
Y_i &= \beta_1 + \beta_2 X_i + \beta_3 X_i^2 +u_i && \text{(mod2)}
\end{align}$$

$$\begin{align}
Y_i &= \beta_1 + \beta_2 X_i + \beta_3 X_i^2 + \beta_4 X_i^3 +u_i && \text{(mod3)}
\end{align}$$

$$\begin{align}
Y_i &= \beta_1 + \beta_2 \frac{1}{X_i} +u_i && \text{(mod4)}
\end{align}$$


$$\begin{align}
Y_i &= \beta_1 + \beta_2 ln(X_i) +u_i && \text{(mod5)} \\
\end{align}$$



$$\begin{align}
ln(Y_i) &= \beta_1 + \beta_2 X_i +u_i && \text{(mod6)}
\end{align}$$

---

### ï¼ˆæµ‹è¯•é¢˜ï¼‰â€œçº¿æ€§â€çš„å«ä¹‰

ä¸‹åˆ—æ¨¡å‹åˆ†åˆ«å±äºå“ªä¸€ç±»ï¼Ÿè¯·æŒ‡å‡ºæ¥ï¼š

$$\begin{align}
ln(Y_i) &= \beta_1 - \beta_2 \frac{1}{X_i} +u_i && \text{(mod7)} 
\end{align}$$


$$\begin{align}
ln(Y_i) &= ln(\beta_1) + \beta_2 ln(X_i) +u_i && \text{(mod8)} 
\end{align}$$


$$\begin{align}
Y_i &= \frac{1}{1+e^{(\beta_1 + \beta_2 X_{2i}  +u_i) }} && \text{(mod9)}
\end{align}$$


$$\begin{align}
Y_i &= \beta_1 +(0.75-\beta_1)e^{-\beta_2(X_i-2)} +u_i && \text{(mod10)}
\end{align}$$


$$\begin{align}
Y_i &= \beta_1 + \beta_2^3 X_i +u_i && \text{(mod11)} 
\end{align}$$

---

## é‡è¦æ¦‚å¿µï¼šæ ·æœ¬å›å½’çº¿(SRL)

**æ ·æœ¬(Sample)**ï¼š

- ä»æ€»ä½“ä¸­éšæœºæŠ½å–å¾—åˆ°çš„æ•°æ®ã€‚

**æ ·æœ¬å›å½’çº¿**(Sample Regression Lineï¼ŒSRL)ï¼š

- æ˜¯é€šè¿‡æ‹Ÿåˆ**æ ·æœ¬æ•°æ®**å¾—åˆ°çš„ä¸€æ¡æ›²çº¿ï¼ˆæˆ–ç›´çº¿ï¼‰ã€‚æ¢è¨€ä¹‹ï¼Œè¿™æ¡çº¿ç”±æ‹Ÿåˆå€¼
$\hat{Y}_i$è¿æ¥è€Œæˆã€‚

- 
$\hat{Y}_i$æ˜¯å¯¹æ¡ä»¶æœŸæœ›å€¼
$Y|X_i$çš„æ‹Ÿåˆã€‚

- æ‹Ÿåˆæ–¹æ³•æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚é‡‡ç”¨OLSæ–¹æ³•å¯¹æ ·æœ¬æ•°æ®è¿›è¡Œæ‹Ÿåˆã€‚

    - å°½å¯èƒ½æ‹Ÿåˆæ•°æ®
    - ç”¨ä»€ä¹ˆæ–¹æ³•æ‹Ÿåˆï¼Ÿ
    - æ›²çº¿æ˜¯ä»€ä¹ˆå½¢æ€ï¼Ÿ


---

## é‡è¦æ¦‚å¿µï¼šæ ·æœ¬å›å½’å‡½æ•°(SRF)

**æ ·æœ¬å›å½’å‡½æ•°**(Sample Regression Functionï¼ŒSRF)ï¼šæ˜¯æ ·æœ¬å›å½’æ›²çº¿çš„æ•°å­¦å‡½æ•°å½¢å¼ï¼Œå¯æ˜¯æ˜¯çº¿æ€§çš„æˆ–éçº¿æ€§ã€‚å¦‚æœæ˜¯ç›´çº¿åˆ™å¯ä»¥å†™æˆï¼š

$$\begin{align}
\hat{Y}_i =\hat{\beta}_1 + \hat{\beta}_2X_i
\end{align}$$

å¯¹æ¯”æ€»ä½“å›å½’å‡½æ•°ï¼ˆPRFï¼‰ï¼š

$$\begin{align}
E(Y|X_i) =\beta_1 + \beta_2X_i
\end{align}$$

å¯ä»¥è®¤ä¸ºï¼š

- 
$\hat{Y}_i$æ˜¯å¯¹
$E(Y|X_i)$çš„ä¼°è®¡é‡ã€‚

- 
$\hat{\beta}_1$æ˜¯å¯¹
$\beta_1$çš„ä¼°è®¡é‡ã€‚

- 
$\hat{\beta}_2$æ˜¯å¯¹
$\beta_2$çš„ä¼°è®¡é‡ã€‚

---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬ä¸€ä»½éšæœºæ ·æœ¬ï¼šæŠ½æ ·

```{r}
set.seed("123")
sample1<- fams60_long %>% 
  mutate(group = as.factor(group)) %>%
  group_by(group) %>%
  sample_n(size=1) %>% ungroup() %>% select(-id,-group)

set.seed("124")
sample2<- fams60_long %>% 
  mutate(group = as.factor(group)) %>%
  group_by(group) %>%
  sample_n(size=1) %>% ungroup() %>% select(-id,-group) 

```


```{r, fig.height=6}
p_spl1 <- p1 +
  geom_point(data = sample1, 
         aes(x=X, y=Y, shape="sample1", color="sample1"),
         size=3)+
  scale_colour_manual(name= "",
                      values =c("black","blue")) +
  scale_shape_manual(name= "",
                      values =c(15,1))

p_spl1
```

```{r, warning=FALSE,message=FALSE}
old.names <- str_c("V",1:10)
new.names <- str_c("n",1:10)
sample1_t<- sample1 %>% 
  t(.) %>% as_tibble(.) %>% 
  rename_at(vars(old.names), ~ new.names) %>%
  add_column(var=c("X","Y"), .before = "n1") 

kable(sample1_t)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬ä¸€ä»½éšæœºæ ·æœ¬ï¼šæ•°æ®

```{r, fig.height=6}
p_spl_base<- ggplot(sample1, aes(X, Y)) +
  geom_blank() +
  scale_x_continuous(breaks=seq(80,260, length=10)) +
  scale_y_continuous(breaks=seq(50,150, length=3)) +
  labs(x="å®¶åº­æ”¶å…¥X", y="å®¶åº­æ”¯å‡ºY") +
  theme(text=element_text(size=16))

p_spl1_alone <- p_spl_base +
  geom_point(aes(shape="sample1"), color="black",size=3)+
  scale_y_continuous(breaks=seq(50,150, length=3)) +
  scale_shape_manual(name= "",
                      values =c(15))

p_spl1_alone
```

```{r}
kable(sample1_t)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬ä¸€ä»½éšæœºæ ·æœ¬ï¼šSRL

```{r, warning=F}
mod_spl <- formula("Y~X")
coef_mod1<- fun_lm_coef(lm.mod = mod_spl, lm.dt = sample1)
```


```{r, fig.height=6, warning=F}
p_spl1_SRL<- p_spl1_alone +
  geom_abline( intercept = coef_mod1$coef[1], slope= coef_mod1$coef[2], color="black") +
  geom_text(aes(x=120,y=170),
             label=TeX("$\\hat{Y_i}=\\hat{\\beta}_1+\\hat{\\beta}_2X_i$"),size=5) +
  geom_text(aes(x=120,y=160),
             label=TeX("$\\hat{Y}=17.81+0.62X_i$"),size=5) 
p_spl1_SRL  
```

```{r}
kable(sample1_t)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬ä¸€ä»½éšæœºæ ·æœ¬ï¼šSRF

æ ¹æ®ç¬¬ä¸€ä»½éšæœºæ ·æœ¬æ‹Ÿåˆå¾—åˆ°çš„**æ ·æœ¬å›å½’å‡½æ•°**SRFï¼š

```{r ,results="asis"}
fun_report_eq(lm.mod = mod_spl, lm.dt = sample1,
              lm.simple=TRUE,lm.n = 2)
```

æ ·æœ¬æ•°æ®å¦‚ä¸‹ï¼š

```{r}
kable(sample1_t)
```


---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬äºŒä»½éšæœºæ ·æœ¬ï¼šæŠ½æ ·

```{r, warning=FALSE,message=FALSE}
sample2_t<- sample2 %>% 
  t(.) %>% as_tibble(.) %>% 
  rename_at(vars(old.names), ~ new.names) %>%
  add_column(var=c("X","Y"), .before = "n1")
```

```{r, fig.height=6}
p_spl2 <- p1 +
  geom_point(data = sample2, 
         aes(x=X, y=Y, shape="sample2", color="sample2"),size=3)+
  scale_colour_manual(name= "",
                      values =c("purple","blue")) +
  scale_shape_manual(name= "",
                      values =c(17,1))

p_spl2
```

```{r}
kable(sample2_t)
```


---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬äºŒä»½éšæœºæ ·æœ¬ï¼šæ•°æ®


```{r, fig.height=6}
p_spl2_alone <- p_spl_base +
geom_point(data=sample2,aes(shape="sample2"), color="purple",size=3)+
  scale_y_continuous(breaks=seq(50,150, length=3)) +
  scale_shape_manual(name= "",
                      values =c(17))

p_spl2_alone
```

```{r}
kable(sample2_t)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬äºŒä»½éšæœºæ ·æœ¬ï¼šSRL

```{r, warning=F}
coef_mod2<- fun_lm_coef(lm.mod = mod_spl, lm.dt = sample2)
```


```{r, fig.height=6, warning=F}
p_spl2_SRL<- p_spl2_alone +
  geom_abline( intercept = coef_mod2$coef[1], slope= coef_mod2$coef[2], color="purple") +
  geom_text(aes(x=120,y=170),
             label=TeX("$\\hat{Y_i}=\\hat{\\beta}_1+\\hat{\\beta}_2X_i$"),size=5) +
  geom_text(aes(x=120,y=160),
             label=TeX("$\\hat{Y}=7.12+0.65X_i$"),size=5) 
p_spl2_SRL  
```

```{r}
kable(sample2_t)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ç¬¬äºŒä»½éšæœºæ ·æœ¬ï¼šSRF

æ ¹æ®ç¬¬äºŒä»½éšæœºæ ·æœ¬æ‹Ÿåˆå¾—åˆ°çš„**æ ·æœ¬å›å½’å‡½æ•°**SRFï¼š


```{r, results="asis"}
fun_report_eq(lm.mod = mod_spl, lm.dt = sample2,
              lm.simple = TRUE)
```


æ ·æœ¬æ•°æ®å¦‚ä¸‹ï¼š

```{r}
kable(sample2_t)
```

---

### ï¼ˆç¤ºä¾‹ï¼‰ä¸¤ä»½æ ·æœ¬åŒæ—¶å‡ºç°ï¼š

```{r,warning=FALSE}
sample_all<- rbind(sample1, sample2) %>%
  add_column(cat= rep(c("sample1", "sample2"), c(10,10)),
             .before = "X")
```

```{r, fig.height=6,warning=FALSE}
p_sample_all<- p2 + 
  geom_point(data = sample1, 
             aes(x=X, y=Y),color="black", shape=15)+
  geom_point(data = sample2, 
             aes(x=X, y=Y),color="purple", shape=17)+
  geom_abline( intercept = coef_mod1$coef[1], slope= coef_mod1$coef[2], color="black",lty="dashed") +
  geom_abline( intercept = coef_mod2$coef[1], slope= coef_mod2$coef[2], color="red",lty="dashed") +
  geom_abline( intercept = 17, slope= 0.6, color="purple") +
  geom_text(aes(x=120,y=180),
             label=TeX("$SRL1:\\hat{Y}=17.81+0.62X_i$"), color="black",size=5)+
  geom_text(aes(x=120,y=170),
             label=TeX("$SRL2:\\hat{Y}=7.12+0.65X_i$"), color="purple",size=5) +
  geom_text(aes(x=120,y=160),
             label=TeX("$PRL:\\hat{Y}=17+0.6X_i$"), color="red",size=5) 
  
  
p_sample_all
```


---

## é‡è¦æ¦‚å¿µï¼šæ ·æœ¬å›å½’æ¨¡å‹ï¼ˆSRMï¼‰

æ ·æœ¬å›å½’æ¨¡å‹ï¼ˆSample Regression Modelï¼ŒSRMï¼‰ï¼šæŠŠæ ·æœ¬å›å½’å‡½æ•°è¡¨ç°ä¸º**â€œéšæœºâ€**å½¢å¼ã€‚

- å¦‚æœæ ·æœ¬å›å½’å‡½æ•°ä¸ºéšå‡½æ•°ï¼Œåˆ™æ ·æœ¬å›å½’æ¨¡å‹å¯è®°ä¸ºï¼š

$$\begin{align}
Y_i &= g(X_i) +e_i 
\end{align}$$

- å¦‚æœæ ·æœ¬å›å½’å‡½æ•°è¡¨ç°ä¸ºç›´çº¿ï¼Œåˆ™æ ·æœ¬å›å½’æ¨¡å‹å¯è®°ä¸ºï¼š

$$\begin{align}
Y_i &= \hat{\beta}_1 +\hat{\beta}_2X_i +e_i && \text{(SRM_L)}
\end{align}$$

å…¶ä¸­ï¼Œ
$e_i$è¡¨ç¤ºæ®‹å·®ï¼ˆResidualï¼‰

---

## é‡è¦æ¦‚å¿µï¼šæ®‹å·®

æ®‹å·®ï¼ˆResidualï¼‰ï¼š

- å®šä¹‰ï¼šæ˜¯æ ·æœ¬å›å½’å‡½æ•°ä¸Yçš„æ ·æœ¬è§‚æµ‹å€¼ä¹‹é—´çš„ç¦»å·®ã€‚

- è®°å·ï¼š

$$\begin{align}
e_i  &= Y_i - \hat{Y}_i \\
     &= Y_i - (\hat{\beta}_1 +\hat{\beta}_2X_i) 
\end{align}$$

---

## é‡è¦æ¦‚å¿µï¼šç†è§£SRFå’ŒSRMçš„å…³ç³»

```{r, warning=FALSE, message=FALSE}
x_spc_spl2 <- 240
Y_spc_spl2 <- sample2$Y[which(sample2$X==x_spc_spl2)]
lm.spl2 <- lm(formula = mod_spl, data = sample2)
Y_spc_fit <- round(lm.spl2$fitted.values[which(sample2$X==x_spc_spl2)],1)

p_SRL_SRF <- p_spl2_SRL +
  geom_vline(aes(xintercept = x_spc_spl2), lty="dashed") +
  geom_hline(aes(yintercept = Y_spc_spl2), lty="dashed")+
  geom_hline(aes(yintercept = Y_spc_fit), lty="dashed") +
  geom_point(aes(x=x_spc_spl2, y= Y_spc_fit), shape=1, size=3,color="red") +
  geom_text(aes(x=x_spc_spl2+15, y=Y_spc_spl2-5), 
            label=  paste0("(",x_spc_spl2,"," ,Y_spc_spl2-5,")"),size=5)+
  geom_text(aes(x=x_spc_spl2+15, y=Y_spc_fit, 
            label= paste0("(",x_spc_spl2,"," ,Y_spc_fit,")")),size=5)

p_SRL_SRF 

```

ç»™å®š
$x_i=$ `r x_spc_spl2`ï¼Œæ ·æœ¬2çš„è§‚æµ‹å€¼
$Y_i=$ `r x_spc_spl2`ï¼›æ‹Ÿåˆå€¼
$\hat{Y}_i=$ `r Y_spc_fit`ï¼›æ®‹å·®
$e_i=Y_i- \hat{Y}_i=$ `r Y_spc_spl2 -Y_spc_fit`ã€‚

---

## é‡è¦æ¦‚å¿µï¼šæ ·æœ¬å›å½’ä¸æ€»ä½“å›å½’çš„æ¯”è¾ƒ

```{r}
include_graphics("../pic/chpt2-1-PRL-SRL.png", dpi=120)
```

--

ä¸ºä½•ä¸åŒï¼Ÿç»§æ‰¿æ€§å’Œå˜å¼‚æ€§


---

## é‡è¦æ¦‚å¿µï¼šæ ·æœ¬å›å½’ä¸æ€»ä½“å›å½’çš„æ¯”è¾ƒ

.pull-left[
æ€»ä½“å›å½’å‡½æ•°PRF:

$$\begin{align}
E(Y|X_i) &= \beta_1 +\beta_2X_i && \text{(PRF)}
\end{align}$$

æ€»ä½“å›å½’æ¨¡å‹PRM:

$$\begin{align}
Y_i &=  \beta_1 +\beta_2X_i + u_i && \text{(PRM)}
\end{align}$$

]


.pull-right[
æ ·æœ¬å›å½’å‡½æ•°SRF:

$$\begin{align}
\hat{Y}_i =\hat{\beta}_1 + \hat{\beta}_2X_i && \text{(SRF)}
\end{align}$$

æ ·æœ¬å›å½’æ¨¡å‹SRM:

$$\begin{align}
Y_i &= \hat{\beta}_1 + \hat{\beta}_2X_i +e_i && \text{(SRM)}
\end{align}$$

]

--

æ€è€ƒï¼š

- PRFæ— æ³•ç›´æ¥è§‚æµ‹ï¼Œåªèƒ½ç”¨SRFè¿‘ä¼¼æ›¿ä»£

- ä¼°è®¡å€¼ä¸è§‚æµ‹å€¼ä¹‹é—´å­˜åœ¨åå·®

- SRFåˆæ˜¯æ€æ ·å†³å®šçš„å‘¢?


---

## é‡è¦æ¦‚å¿µï¼šæ ·æœ¬å›å½’ä¸æ€»ä½“å›å½’çš„æ¯”è¾ƒ


æ€»ç»“ï¼š

- éšæœºæŠ½æ ·æ•°æ®ç»§æ‰¿äº†æ€»ä½“çš„ç‰¹å¾ã€‚

- åˆ©ç”¨éšæœºæ ·æœ¬è¿›è¡Œæ•°æ®æ‹Ÿåˆæ˜¯å¯¹æ€»ä½“è§„å¾‹çš„â€œåå‘è¿½è¸ªâ€ã€‚

- æ ·æœ¬å›å½’æ¨¡å‹ä¸­çš„æ®‹å·®æ˜¯æ‹Ÿåˆä¸å®Œå…¨çš„äº§ç‰©ã€‚

--

æ€è€ƒï¼š

- æ€æ ·æ¥åˆ¤å®šå¯¹éšæœºæ ·æœ¬çš„ä¸€æ¬¡æ•°æ®æ‹Ÿåˆæ˜¯æ›´ä¼˜çš„ï¼Ÿ

- å­˜ä¸å­˜åœ¨ä¸€ç§â€œæœ€ä¼˜â€çš„æ‹Ÿåˆæ–¹æ³•ï¼Ÿ

--

è¯¾åä½œä¸šï¼š

- è¯·æŠŠ162ååŒå­¦çš„æ‹Ÿåˆçº¿è¿›è¡Œå¹³å‡åŒ–å¤„ç†ï¼ˆæˆªè·å’Œæ–œç‡å–å‡å€¼ï¼‰ï¼Œç»˜åˆ¶å¾—åˆ°ä¸€æ¡â€œå›å½’çº¿â€ã€‚

- ä½ è®¤ä¸ºæ˜¯è¿™æ ¹å¹³å‡åŒ–çš„â€œå›å½’çº¿â€ä¸çœŸç›¸æ›´é€¼è¿‘ä¹ˆï¼Ÿ


---
layout:false
background-image: url("../pic/thank-you-gif-funny-fan.gif")
class: inverse,center
# æœ¬ç« ç»“æŸ

